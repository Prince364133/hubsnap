module.exports=[42387,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(20237);a.i(69387);var e=a.i(60574);a.i(9912);var f=a.i(94318),g=a.i(62067),h=a.i(94988),i=a.i(96438),j=a.i(60246),k=a.i(24669),l=a.i(90669),m=a.i(73570);function n(){let[a,f]=(0,c.useState)(null),[h,i]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{let a=async()=>{try{let a=await (0,e.getDoc)((0,e.doc)(d.db,"admin_stats","user_management"));a.exists()&&f(a.data())}catch(a){console.error("Error fetching admin stats:",a)}i(!1)};a();let b=setInterval(a,3e4);return()=>clearInterval(b)},[]),h)return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(a=>(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200 animate-pulse",children:[(0,b.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/2 mb-2"}),(0,b.jsx)("div",{className:"h-8 bg-slate-200 rounded w-3/4"})]},a))});if(!a)return null;let n=[{label:"New Users Today",value:a.usersJoinedToday,subtext:`${a.usersJoinedThisWeek} this week`,icon:j.Users,color:"text-blue-600",bgColor:"bg-blue-100",trend:a.usersJoinedToday>0?"up":"neutral",trendValue:a.usersJoinedThisWeek>0?`+${Math.round(a.usersJoinedToday/(a.usersJoinedThisWeek/7)*100)}%`:"0%"},{label:"Active Users",value:a.activeUsersToday,subtext:`${a.activeUsersThisWeek} this week`,icon:l.Activity,color:"text-green-600",bgColor:"bg-green-100",trend:a.activeUsersToday>a.activeUsersThisWeek/7?"up":"down",trendValue:a.activeUsersThisWeek>0?`${Math.round((a.activeUsersToday/(a.activeUsersThisWeek/7)-1)*100)}%`:"0%"},{label:"Retention Rate",value:`${a.retentionRate7d}%`,subtext:`${a.retentionRate30d}% (30d)`,icon:k.TrendingUp,color:"text-purple-600",bgColor:"bg-purple-100",trend:a.retentionRate7d>=50?"up":a.retentionRate7d>=30?"neutral":"down",trendValue:a.retentionRate7d>=a.retentionRate30d?"Improving":"Declining"},{label:"At Risk Users",value:a.churnWarnings,subtext:`${a.statusDistribution.inactive} inactive`,icon:m.AlertTriangle,color:"text-orange-600",bgColor:"bg-orange-100",trend:a.churnWarnings>10?"down":"up",trendValue:`${Math.round(a.churnWarnings/a.totalUsers*100)}% of total`}];return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n.map((a,c)=>{let d=a.icon,e="up"===a.trend?"â†‘":"down"===a.trend?"â†“":"â†’",f="up"===a.trend?"text-green-600":"down"===a.trend?"text-red-600":"text-slate-600";return(0,b.jsx)(g.Card,{className:"p-6 border-slate-200 hover:shadow-md transition-shadow",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-slate-600 mb-1",children:a.label}),(0,b.jsx)("p",{className:"text-3xl font-bold text-slate-900 mb-1",children:a.value}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"text-xs text-slate-500",children:a.subtext}),(0,b.jsxs)("span",{className:`text-xs font-medium ${f} flex items-center gap-1`,children:[(0,b.jsx)("span",{className:"text-base",children:e}),a.trendValue]})]})]}),(0,b.jsx)("div",{className:`${a.bgColor} ${a.color} p-3 rounded-lg`,children:(0,b.jsx)(d,{className:"size-6"})})]})},c)})})}var o=a.i(33508),p=a.i(46842),q=a.i(41710),r=a.i(39761),s=a.i(21161),t=a.i(24987),u=a.i(1631);function v({user:a,onClose:e}){let[h,j]=(0,c.useState)("overview"),[l,m]=(0,c.useState)([]),[n,v]=(0,c.useState)(!1),w=[{id:"overview",label:"Overview",icon:p.User},{id:"timeline",label:"Timeline",icon:q.Clock},{id:"analytics",label:"Analytics",icon:r.BarChart3},{id:"actions",label:"Actions",icon:s.Settings}];(0,c.useEffect)(()=>{"timeline"===h&&0===l.length&&x()},[h]);let x=async()=>{v(!0);try{let b=(0,f.getFunctions)(d.app),c=(0,f.httpsCallable)(b,"getUserActivityTimeline"),e=await c({userId:a.id,limit:50});m(e.data.events||[])}catch(a){console.error("Error fetching timeline:",a)}v(!1)},y=a=>a?(a.toDate?a.toDate():new Date(a)).toLocaleString():"N/A";return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,b.jsxs)("div",{className:"border-b border-slate-200 p-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"size-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg uppercase",children:a.name?.[0]||a.email?.[0]||"?"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:a.name||"Unknown User"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:a.email})]})]}),(0,b.jsx)("button",{onClick:e,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:(0,b.jsx)(o.X,{className:"size-5 text-slate-600"})})]}),(0,b.jsx)("div",{className:"border-b border-slate-200 px-6",children:(0,b.jsx)("nav",{className:"-mb-px flex space-x-8",children:w.map(a=>{let c=a.icon,d=h===a.id;return(0,b.jsxs)("button",{onClick:()=>j(a.id),className:`
                                        group inline-flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                                        ${d?"border-sky-500 text-sky-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"}
                                    `,children:[(0,b.jsx)(c,{className:`size-4 ${d?"text-sky-500":"text-slate-400 group-hover:text-slate-500"}`}),a.label]},a.id)})})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:["overview"===h&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)(g.Card,{className:"p-4 border-slate-200",children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Engagement Score"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:a.activitySummary?.engagementScore||0}),(0,b.jsx)("div",{className:"mt-2 bg-slate-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-sky-500 h-2 rounded-full",style:{width:`${a.activitySummary?.engagementScore||0}%`}})})]}),(0,b.jsxs)(g.Card,{className:"p-4 border-slate-200",children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Total Sessions"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:a.activitySummary?.totalSessions||0}),(0,b.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:[a.metrics?.sessionCount7d||0," in last 7 days"]})]}),(0,b.jsxs)(g.Card,{className:"p-4 border-slate-200",children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Avg Session"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-slate-900",children:[Math.round((a.activitySummary?.avgSessionDuration||0)/60),"m"]}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Duration"})]})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-900 mb-4",children:"User Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Status"}),(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"highly_active"===a.status?"bg-green-100 text-green-700":"active"===a.status?"bg-blue-100 text-blue-700":"at_risk"===a.status?"bg-orange-100 text-orange-700":"bg-slate-100 text-slate-600"}`,children:a.status?.replace("_"," ").toUpperCase()||"INACTIVE"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Plan"}),(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"pro_plus"===a.plan?"bg-purple-100 text-purple-700":"pro"===a.plan?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600"}`,children:"pro_plus"===a.plan?"Pro+":a.plan?.toUpperCase()||"FREE"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Wallet Balance"}),(0,b.jsxs)("p",{className:"font-mono font-medium text-slate-900",children:["â‚¹",a.walletBalance||0]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Referral Code"}),(0,b.jsx)("code",{className:"bg-slate-100 px-2 py-1 rounded text-xs text-slate-900",children:a.referralCode||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Joined"}),(0,b.jsx)("p",{className:"text-slate-900",children:a.createdAt?y(a.createdAt):"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-600 mb-1",children:"Last Active"}),(0,b.jsx)("p",{className:"text-slate-900",children:y(a.activitySummary?.lastActive)})]})]})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200",children:[(0,b.jsxs)("h3",{className:"font-bold text-slate-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(k.TrendingUp,{className:"size-5"}),"Activity Trend"]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:`px-3 py-2 rounded-lg ${a.metrics?.activityTrend==="growing"?"bg-green-100 text-green-700":a.metrics?.activityTrend==="declining"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"}`,children:a.metrics?.activityTrend?.toUpperCase()||"STABLE"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"text-sm text-slate-600",children:["Most visited: ",(0,b.jsx)("span",{className:"font-medium text-slate-900",children:a.activitySummary?.mostVisitedPage||"N/A"})]}),(0,b.jsxs)("p",{className:"text-sm text-slate-600 mt-1",children:["Device: ",(0,b.jsx)("span",{className:"font-medium text-slate-900",children:a.activitySummary?.deviceType||"Unknown"})]})]})]})]})]}),"timeline"===h&&(0,b.jsx)("div",{className:"space-y-4",children:n?(0,b.jsx)("p",{className:"text-center text-slate-500 py-8",children:"Loading timeline..."}):0===l.length?(0,b.jsx)("p",{className:"text-center text-slate-500 py-8",children:"No activity recorded yet."}):(0,b.jsx)("div",{className:"space-y-3",children:l.map((a,c)=>(0,b.jsx)(g.Card,{className:"p-4 border-slate-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"size-8 rounded-full bg-sky-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(q.Clock,{className:"size-4 text-sky-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:a.type?.replace("_"," ").toUpperCase()}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:a.page||"Unknown page"}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:y(a.timestamp)})]})]})},c))})}),"analytics"===h&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-900 mb-4",children:"Session Metrics"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Last 7 Days"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:a.metrics?.sessionCount7d||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Last 30 Days"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:a.metrics?.sessionCount30d||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Total Page Views"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:a.activitySummary?.totalPageViews||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Avg Session Duration"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-slate-900",children:[Math.round((a.activitySummary?.avgSessionDuration||0)/60),"m"]})]})]})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200",children:[(0,b.jsxs)("h3",{className:"font-bold text-slate-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(u.Smartphone,{className:"size-5"}),"Device & Location"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Primary Device"}),(0,b.jsx)("p",{className:"text-slate-900 font-medium capitalize",children:a.activitySummary?.deviceType||"Unknown"})]}),a.activitySummary?.location&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm text-slate-600 mb-1 flex items-center gap-1",children:[(0,b.jsx)(t.MapPin,{className:"size-4"}),"Location"]}),(0,b.jsx)("p",{className:"text-slate-900 font-medium",children:a.activitySummary.location.state?`${a.activitySummary.location.state}, ${a.activitySummary.location.country}`:a.activitySummary.location.country})]})]})]})]}),"actions"===h&&(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)(g.Card,{className:"p-6 border-slate-200",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-900 mb-4",children:"User Actions"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(i.Button,{className:"w-full",variant:"outline",children:"Send Notification"}),(0,b.jsx)(i.Button,{className:"w-full",variant:"outline",children:"Adjust Wallet Balance"}),(0,b.jsx)(i.Button,{className:"w-full",variant:"outline",children:"Change Plan"}),(0,b.jsx)(i.Button,{className:"w-full text-red-600 border-red-600 hover:bg-red-50",variant:"outline",children:"Suspend Account"})]})]})})]})]})})}var w=a.i(24569),x=a.i(92e3);function y({selectedUsers:a,onClose:f,onComplete:g}){let[h,j]=(0,c.useState)(new Set),[k,l]=(0,c.useState)("free"),[m,n]=(0,c.useState)("active"),[p,q]=(0,c.useState)(0),[r,s]=(0,c.useState)("add"),[t,u]=(0,c.useState)(!1),v=a=>{let b=new Set(h);b.has(a)?b.delete(a):b.add(a),j(b)},y=async()=>{if(0===h.size)return void alert("Please select at least one field to update");if(confirm(`Update ${a.length} users? This action cannot be undone.`)){u(!0);try{let b=(0,e.writeBatch)(d.db),c=0;for(let f of a){if(!f.id)continue;let a={};if(h.has("plan")&&(a.plan=k),h.has("status")&&(a.status=m),h.has("wallet")){let b=f.walletBalance||0;"add"===r?a.walletBalance=b+p:"subtract"===r?a.walletBalance=Math.max(0,b-p):a.walletBalance=p}b.update((0,e.doc)(d.db,"users",f.id),a),++c>=500&&(await b.commit(),c=0)}c>0&&await b.commit(),alert(`Successfully updated ${a.length} users`),g(),f()}catch(a){alert(`Update failed: ${a.message}`)}u(!1)}};return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"size-10 rounded-lg bg-indigo-100 flex items-center justify-center",children:(0,b.jsx)(w.Edit,{className:"size-5 text-indigo-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Bulk Edit Users"}),(0,b.jsxs)("p",{className:"text-sm text-slate-600",children:["Update ",a.length," selected users"]})]})]}),(0,b.jsx)("button",{onClick:f,className:"text-slate-400 hover:text-slate-600",children:(0,b.jsx)(o.X,{className:"size-6"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 flex gap-3",children:[(0,b.jsx)(x.AlertCircle,{className:"size-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-sm text-orange-800",children:[(0,b.jsx)("strong",{children:"Warning:"})," This will update all ",a.length," selected users. This action cannot be undone. Please review carefully before proceeding."]})]}),(0,b.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-3 mb-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:h.has("plan"),onChange:()=>v("plan"),className:"rounded border-slate-300"}),(0,b.jsx)("span",{className:"font-medium text-slate-900",children:"Update Plan"})]}),h.has("plan")&&(0,b.jsx)("div",{className:"ml-7",children:(0,b.jsxs)("select",{value:k,onChange:a=>l(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md",children:[(0,b.jsx)("option",{value:"free",children:"Free"}),(0,b.jsx)("option",{value:"pro",children:"Pro"}),(0,b.jsx)("option",{value:"pro_plus",children:"Pro+"})]})})]}),(0,b.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-3 mb-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:h.has("status"),onChange:()=>v("status"),className:"rounded border-slate-300"}),(0,b.jsx)("span",{className:"font-medium text-slate-900",children:"Update Status"})]}),h.has("status")&&(0,b.jsx)("div",{className:"ml-7",children:(0,b.jsxs)("select",{value:m,onChange:a=>n(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md",children:[(0,b.jsx)("option",{value:"highly_active",children:"Highly Active"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"at_risk",children:"At Risk"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]})})]}),(0,b.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-3 mb-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:h.has("wallet"),onChange:()=>v("wallet"),className:"rounded border-slate-300"}),(0,b.jsx)("span",{className:"font-medium text-slate-900",children:"Adjust Wallet Balance"})]}),h.has("wallet")&&(0,b.jsxs)("div",{className:"ml-7 space-y-3",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"px-3 py-2 border border-slate-300 rounded-md",children:[(0,b.jsx)("option",{value:"add",children:"Add"}),(0,b.jsx)("option",{value:"subtract",children:"Subtract"}),(0,b.jsx)("option",{value:"set",children:"Set to"})]}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",children:"â‚¹"}),(0,b.jsx)("input",{type:"number",value:p,onChange:a=>q(parseFloat(a.target.value)||0),className:"w-full pl-8 pr-3 py-2 border border-slate-300 rounded-md",placeholder:"0",min:"0"})]})]}),(0,b.jsxs)("p",{className:"text-sm text-slate-600",children:["add"===r&&`Add â‚¹${p} to each user's wallet`,"subtract"===r&&`Subtract â‚¹${p} from each user's wallet`,"set"===r&&`Set each user's wallet to â‚¹${p}`]})]})]}),h.size>0&&(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Changes to be applied:"}),(0,b.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[h.has("plan")&&(0,b.jsxs)("li",{children:["â€¢ Plan will be changed to: ",(0,b.jsx)("strong",{children:k.toUpperCase()})]}),h.has("status")&&(0,b.jsxs)("li",{children:["â€¢ Status will be changed to: ",(0,b.jsx)("strong",{children:m.replace("_"," ").toUpperCase()})]}),h.has("wallet")&&(0,b.jsxs)("li",{children:["â€¢ Wallet balance will be ","set"===r?"set to":"add"===r?"increased by":"decreased by",": ",(0,b.jsxs)("strong",{children:["â‚¹",p]})]})]})]})]}),(0,b.jsxs)("div",{className:"border-t border-slate-200 p-6 flex items-center justify-between bg-slate-50",children:[(0,b.jsx)(i.Button,{onClick:f,variant:"outline",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:y,disabled:t||0===h.size,children:t?"Updating...":`Update ${a.length} Users`})]})]})})}let z={welcome:{subject:"Welcome to HubSnap! ðŸŽ‰",body:`Hi {{name}},

Welcome to HubSnap! We're thrilled to have you on board.

Your account has been successfully created and you're all set to start creating amazing content.

**Your Account Details:**
- Plan: {{plan}}
- Wallet Balance: â‚¹{{walletBalance}}
- Referral Code: {{referralCode}}

If you have any questions, feel free to reach out to our support team.

Best regards,
The HubSnap Team`},planUpgrade:{subject:"Your Plan Has Been Upgraded! ðŸš€",body:`Hi {{name}},

Great news! Your HubSnap plan has been upgraded to {{plan}}.

You now have access to all premium features including:
- Advanced analytics
- Priority support
- Unlimited content generation
- And much more!

Start exploring your new features today.

Best regards,
The HubSnap Team`},walletCredit:{subject:"Wallet Credit Added! ðŸ’°",body:`Hi {{name}},

â‚¹{{amount}} has been added to your HubSnap wallet!

**Your New Balance:** â‚¹{{walletBalance}}

You can use your wallet balance for:
- Premium features
- Content generation
- Tool upgrades

Thank you for being a valued member of HubSnap.

Best regards,
The HubSnap Team`},custom:{subject:"",body:""}};function A(a,b){let c=a;for(let[a,d]of Object.entries(b))c=c.replace(RegExp(`{{${a}}}`,"g"),String(d));return c}var B=a.i(92258),C=a.i(92759);function D({selectedUsers:a,onClose:d,onSend:e}){let[f,g]=(0,c.useState)("custom"),[h,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),r=async()=>{if(!h.trim()||!k.trim())return void alert("Please fill in both subject and body");if(confirm(`Send email to ${a.length} users?`)){n(!0);try{await e(h,k),alert(`Email sent to ${a.length} users successfully!`),d()}catch(a){alert(`Failed to send emails: ${a.message}`)}n(!1)}},s=(()=>{if(0===a.length)return{subject:"",body:""};let b=a[0];return{subject:A(h,{name:b.name||"User",plan:b.plan||"free",walletBalance:b.walletBalance||0,referralCode:b.referralCode||"N/A",amount:0}),body:A(k,{name:b.name||"User",plan:b.plan||"free",walletBalance:b.walletBalance||0,referralCode:b.referralCode||"N/A",amount:0})}})();return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"size-10 rounded-lg bg-indigo-100 flex items-center justify-center",children:(0,b.jsx)(B.Mail,{className:"size-5 text-indigo-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Send Bulk Email"}),(0,b.jsxs)("p",{className:"text-sm text-slate-600",children:["Compose email for ",a.length," recipients"]})]})]}),(0,b.jsx)("button",{onClick:d,className:"text-slate-400 hover:text-slate-600",children:(0,b.jsx)(o.X,{className:"size-6"})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Template"}),(0,b.jsxs)("select",{value:f,onChange:a=>{var b;let c;return g(b=a.target.value),void(j((c=z[b]).subject),l(c.body))},className:"w-full px-3 py-2 border border-slate-300 rounded-md",children:[(0,b.jsx)("option",{value:"custom",children:"Custom Message"}),(0,b.jsx)("option",{value:"welcome",children:"Welcome Email"}),(0,b.jsx)("option",{value:"planUpgrade",children:"Plan Upgrade"}),(0,b.jsx)("option",{value:"walletCredit",children:"Wallet Credit"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Subject"}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>j(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md",placeholder:"Email subject..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Message Body"}),(0,b.jsx)("textarea",{value:k,onChange:a=>l(a.target.value),rows:12,className:"w-full px-3 py-2 border border-slate-300 rounded-md font-mono text-sm",placeholder:"Email body... Use {{name}}, {{plan}}, {{walletBalance}}, {{referralCode}} for personalization"})]}),(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Available Variables:"}),(0,b.jsxs)("div",{className:"text-xs text-blue-700 space-y-0.5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{{name}}"})," - User's name"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{{plan}}"})," - User's plan"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{{walletBalance}}"})," - Wallet balance"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{{referralCode}}"})," - Referral code"]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700",children:"Preview (First Recipient)"}),(0,b.jsxs)("button",{onClick:()=>q(!p),className:"text-sm text-indigo-600 hover:text-indigo-700",children:[p?"Hide":"Show"," Preview"]})]}),p&&(0,b.jsxs)("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-200",children:[(0,b.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"To:"}),(0,b.jsx)("div",{className:"text-sm font-medium text-slate-900",children:a[0]?.email||"user@example.com"})]}),(0,b.jsxs)("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-200",children:[(0,b.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"Subject:"}),(0,b.jsx)("div",{className:"text-sm font-medium text-slate-900",children:s.subject||"(No subject)"})]}),(0,b.jsx)("div",{className:"p-4 bg-white",children:(0,b.jsx)("div",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:s.body||"(No content)"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Recipients (",a.length,")"]}),(0,b.jsxs)("div",{className:"border border-slate-200 rounded-lg max-h-64 overflow-y-auto",children:[a.slice(0,50).map(a=>(0,b.jsxs)("div",{className:"px-4 py-2 border-b border-slate-100 last:border-0",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-slate-900",children:a.name||"Unknown"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:a.email})]},a.id)),a.length>50&&(0,b.jsxs)("div",{className:"px-4 py-2 text-sm text-slate-500 bg-slate-50",children:["+ ",a.length-50," more recipients"]})]})]})]})]})}),(0,b.jsxs)("div",{className:"border-t border-slate-200 p-6 flex items-center justify-between bg-slate-50",children:[(0,b.jsx)(i.Button,{onClick:d,variant:"outline",children:"Cancel"}),(0,b.jsxs)(i.Button,{onClick:r,disabled:m||!h.trim()||!k.trim(),children:[(0,b.jsx)(C.Send,{className:"size-4 mr-2"}),m?"Sending...":`Send to ${a.length} Users`]})]})]})})}var E=a.i(70194),F=a.i(55486),G=a.i(96221),H=a.i(67453),I=a.i(70106);let J=(0,I.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var K=a.i(28790),L=a.i(56711);function M({open:a,onOpenChange:f}){let[g,h]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),l=async()=>{k(!0);try{let a=(0,e.query)((0,e.collection)(d.db,"emailLogs"),(0,e.orderBy)("sentAt","desc"),(0,e.limit)(50)),b=(await (0,e.getDocs)(a)).docs.map(a=>({id:a.id,...a.data()}));h(b)}catch(a){console.error("Error fetching email logs:",a)}finally{k(!1)}};return(0,c.useEffect)(()=>{a&&l()},[a]),(0,b.jsx)(E.Dialog,{open:a,onOpenChange:f,children:(0,b.jsxs)(E.DialogContent,{className:"max-w-4xl max-h-[80vh] flex flex-col",children:[(0,b.jsx)(E.DialogHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between mr-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(E.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(B.Mail,{className:"size-5"}),"Email History"]}),(0,b.jsx)(E.DialogDescription,{children:"View status and results of recent bulk email campaigns."})]}),(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:l,disabled:j,children:(0,b.jsx)(K.RefreshCcw,{className:`size-4 ${j?"animate-spin":""}`})})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto pr-4",children:j&&0===g.length?(0,b.jsxs)("div",{className:"flex items-center justify-center p-8 text-muted-foreground",children:[(0,b.jsx)(G.Loader2,{className:"size-8 animate-spin mb-2"}),(0,b.jsx)("p",{children:"Loading history..."})]}):0===g.length?(0,b.jsxs)("div",{className:"text-center p-8 text-muted-foreground bg-muted/20 rounded-lg border border-dashed",children:[(0,b.jsx)(B.Mail,{className:"size-12 mx-auto mb-3 opacity-20"}),(0,b.jsx)("p",{children:"No email history found"})]}):(0,b.jsx)("div",{className:"space-y-4",children:g.map(a=>(0,b.jsxs)("div",{className:"border rounded-lg p-4 bg-card hover:bg-muted/5 transition-colors",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-base",children:a.subject}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,L.format)(a.sentAt.toDate(),"PPP p")})]}),(0,b.jsx)(F.Badge,{variant:(a=>{switch(a){case"completed":return"success";case"sending":return"warning";case"failed":return"destructive";default:return"secondary"}})(a.status),children:a.status.toUpperCase()})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm mt-3 pt-3 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(B.Mail,{className:"size-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.recipientCount})," Recipients"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,b.jsx)(H.CheckCircle2,{className:"size-4"}),(0,b.jsx)("span",{className:"font-medium",children:a.results?.sent||0})," Sent"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,b.jsx)(J,{className:"size-4"}),(0,b.jsx)("span",{className:"font-medium",children:a.results?.failed||0})," Failed"]})]}),a.error&&(0,b.jsxs)("div",{className:"mt-3 p-2 bg-destructive/10 text-destructive text-sm rounded flex items-center gap-2",children:[(0,b.jsx)(x.AlertCircle,{className:"size-4"}),a.error]})]},a.id))})})]})})}var N=a.i(83556),O=a.i(26497),P=a.i(81560),Q=a.i(15618),R=a.i(41675);let S=(0,I.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var T=a.i(23292);function U({onClose:a}){let[f,g]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)({name:"",frequency:"daily",filters:{},emailRecipients:[],enabled:!0}),[p,q]=(0,c.useState)("");(0,c.useEffect)(()=>{r()},[]);let r=async()=>{k(!0);try{let a=(0,e.query)((0,e.collection)(d.db,"exportSchedules")),b=(await (0,e.getDocs)(a)).docs.map(a=>({id:a.id,...a.data()}));g(b)}catch(a){console.error("Error fetching schedules:",a),T.toast.error("Failed to load schedules")}k(!1)},s=async()=>{if(!n.name)return void T.toast.error("Name is required");try{let a={...n,emailRecipients:n.emailRecipients||[],updatedAt:(0,e.serverTimestamp)()};n.id?(await (0,e.updateDoc)((0,e.doc)(d.db,"exportSchedules",n.id),a),T.toast.success("Schedule updated")):(await (0,e.addDoc)((0,e.collection)(d.db,"exportSchedules"),{...a,createdAt:(0,e.serverTimestamp)(),nextRun:(0,e.serverTimestamp)()}),T.toast.success("Schedule created")),m(!1),r()}catch(a){console.error("Error saving schedule:",a),T.toast.error("Failed to save schedule")}},t=async a=>{if(confirm("Are you sure you want to delete this schedule?"))try{await (0,e.deleteDoc)((0,e.doc)(d.db,"exportSchedules",a)),T.toast.success("Schedule deleted"),r()}catch(a){console.error("Error deleting schedule:",a),T.toast.error("Failed to delete schedule")}},u=()=>{if(!p||!p.includes("@"))return;let a=n.emailRecipients||[];o({...n,emailRecipients:[...a,p]}),q("")};return(0,b.jsx)(E.Dialog,{open:!0,onOpenChange:a,children:(0,b.jsxs)(E.DialogContent,{className:"max-w-3xl",children:[(0,b.jsx)(E.DialogHeader,{children:(0,b.jsx)(E.DialogTitle,{children:"Export Schedules"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[!l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(i.Button,{onClick:()=>{o({name:"",frequency:"daily",filters:{},emailRecipients:[],enabled:!0}),m(!0)},children:[(0,b.jsx)(Q.Plus,{className:"size-4 mr-2"}),"New Schedule"]})}),(0,b.jsx)("div",{className:"border rounded-md divide-y",children:j?(0,b.jsx)("div",{className:"p-4 text-center text-slate-500",children:"Loading..."}):0===f.length?(0,b.jsx)("div",{className:"p-4 text-center text-slate-500",children:"No active schedules"}):f.map(a=>(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between hover:bg-slate-50",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[a.name,(0,b.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${a.enabled?"bg-green-100 text-green-700":"bg-slate-100 text-slate-600"}`,children:a.enabled?"Active":"Disabled"})]}),(0,b.jsxs)("div",{className:"text-sm text-slate-500 flex gap-4 mt-1",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(R.Calendar,{className:"size-3"})," ",a.frequency]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(B.Mail,{className:"size-3"})," ",a.emailRecipients?.length||0," recipients"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{o(a),m(!0)},children:(0,b.jsx)(S,{className:"size-4"})}),(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>t(a.id),className:"text-red-500 hover:text-red-700",children:(0,b.jsx)(P.Trash2,{className:"size-4"})})]})]},a.id))})]}),l&&(0,b.jsxs)("div",{className:"space-y-4 border p-4 rounded-md bg-slate-50",children:[(0,b.jsx)("h3",{className:"font-medium",children:n.id?"Edit Schedule":"New Schedule"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(N.Label,{children:"Schedule Name"}),(0,b.jsx)(h.Input,{value:n.name,onChange:a=>o({...n,name:a.target.value}),placeholder:"e.g. Monthly Active Users"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(N.Label,{children:"Frequency"}),(0,b.jsxs)("select",{value:n.frequency,onChange:a=>o({...n,frequency:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-md bg-white",children:[(0,b.jsx)("option",{value:"daily",children:"Daily"}),(0,b.jsx)("option",{value:"weekly",children:"Weekly"}),(0,b.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(N.Label,{children:"Filters (Optional)"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("select",{value:n.filters?.plan||"all",onChange:a=>o({...n,filters:{...n.filters,plan:"all"===a.target.value?void 0:a.target.value}}),className:"w-full px-3 py-2 border border-slate-300 rounded-md bg-white",children:[(0,b.jsx)("option",{value:"all",children:"All Plans"}),(0,b.jsx)("option",{value:"free",children:"Free"}),(0,b.jsx)("option",{value:"pro",children:"Pro"}),(0,b.jsx)("option",{value:"pro_plus",children:"Pro Plus"})]}),(0,b.jsxs)("select",{value:n.filters?.status||"all",onChange:a=>o({...n,filters:{...n.filters,status:"all"===a.target.value?void 0:a.target.value}}),className:"w-full px-3 py-2 border border-slate-300 rounded-md bg-white",children:[(0,b.jsx)("option",{value:"all",children:"All Statuses"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(N.Label,{children:"Email Recipients"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Input,{value:p,onChange:a=>q(a.target.value),placeholder:"Enter email address",onKeyDown:a=>"Enter"===a.key&&u()}),(0,b.jsx)(i.Button,{onClick:u,type:"button",variant:"outline",children:"Add"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:n.emailRecipients?.map(a=>(0,b.jsxs)("span",{className:"bg-white border px-2 py-1 rounded-md text-sm flex items-center gap-1",children:[a,(0,b.jsx)("button",{onClick:()=>{let b;return b=n.emailRecipients||[],void o({...n,emailRecipients:b.filter(b=>b!==a)})},className:"text-slate-400 hover:text-red-500",children:(0,b.jsx)(P.Trash2,{className:"size-3"})})]},a))})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(O.Checkbox,{id:"enabled",checked:n.enabled,onCheckedChange:a=>o({...n,enabled:a})}),(0,b.jsx)(N.Label,{htmlFor:"enabled",children:"Enable Schedule"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(i.Button,{variant:"ghost",onClick:()=>m(!1),children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:s,children:"Save Schedule"})]})]})]}),(0,b.jsx)(E.DialogFooter,{children:!l&&(0,b.jsx)(i.Button,{onClick:a,variant:"outline",children:"Close"})})]})})}function V(a,b="users-export.csv"){let c=new Blob([["ID,Name,Email,Plan,Status,Wallet Balance,Referral Code,Last Active,Total Sessions,Engagement Score,Sessions (7d),Device Type,Joined Date",...a.map(a=>[a.id||"",a.name||"",a.email||"",a.plan||"free",a.status||"inactive",a.walletBalance?.toString()||"0",a.referralCode||"",a.activitySummary?.lastActive?.toDate?.().toISOString()||"",a.activitySummary?.totalSessions?.toString()||"0",a.activitySummary?.engagementScore?.toString()||"0",a.metrics?.sessionCount7d?.toString()||"0",a.activitySummary?.deviceType||"",a.createdAt?"string"==typeof a.createdAt?a.createdAt:a.createdAt.toDate?.().toISOString()||"":""]).map(a=>a.map(a=>`"${a}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c);d.setAttribute("href",e),d.setAttribute("download",b),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}var W=a.i(87532),X=a.i(84505),Y=a.i(5784),Z=a.i(90166);function $(){let a=a=>{if(!a)return"-";if("function"==typeof a?.toDate)return a.toDate().toLocaleDateString();try{return new Date(a).toLocaleDateString()}catch(a){return"-"}},[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(!0),[o,p]=(0,c.useState)(""),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(new Set),[x,z]=(0,c.useState)(!1),[A,C]=(0,c.useState)("all"),[E,F]=(0,c.useState)("all"),[G,H]=(0,c.useState)("newest"),[I,J]=(0,c.useState)({start:"",end:""}),[K,L]=(0,c.useState)({min:0,max:1e4}),[N,O]=(0,c.useState)(!1),[Q,S]=(0,c.useState)(!1),[T,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(null),[af,ag]=(0,c.useState)(!0);(0,c.useEffect)(()=>{ah()},[A,E,G]);let ah=async(a=!1)=>{m(!0);try{let b=[];switch("all"!==A&&b.push((0,e.where)("status","==",A)),"all"!==E&&b.push((0,e.where)("plan","==",E)),G){case"last_active":b.push((0,e.orderBy)("activitySummary.lastActive","desc"));break;case"most_active":b.push((0,e.orderBy)("activitySummary.engagementScore","desc"));break;case"highest_value":b.push((0,e.orderBy)("walletBalance","desc"));break;default:b.push((0,e.orderBy)("createdAt","desc"))}let c=!!o||N,f=c?100:25;a&&ad&&!c&&b.push((0,e.startAfter)(ad)),b.push((0,e.limit)(f));let g=(0,e.query)((0,e.collection)(d.db,"users"),...b),h=await (0,e.getDocs)(g),i=h.docs.map(a=>({id:a.id,...a.data()}));a?k(a=>[...a,...i]):k(i),ae(h.docs[h.docs.length-1]||null),ag(h.docs.length===f)}catch(a){console.error("Error fetching users:",a)}m(!1)},ai=j.filter(a=>{if(o){let b=o.toLowerCase();if(!(a.name?.toLowerCase().includes(b)||a.email?.toLowerCase().includes(b)||a.referralCode?.toLowerCase().includes(b)))return!1}if(I.start&&a.createdAt&&(a.createdAt.toDate?a.createdAt.toDate():new Date(a.createdAt))<new Date(I.start)||I.end&&a.createdAt&&(a.createdAt.toDate?a.createdAt.toDate():new Date(a.createdAt))>new Date(I.end))return!1;let b=a.walletBalance||0;return!(b<K.min)&&!(b>K.max)}),aj=async()=>{if(confirm(`Delete ${t.size} users? This action cannot be undone.`)){z(!0);try{let a=(0,e.writeBatch)(d.db);t.forEach(b=>{a.delete((0,e.doc)(d.db,"users",b))}),await a.commit(),k(a=>a.filter(a=>!t.has(a.id))),u(new Set),alert("Users deleted successfully")}catch(a){console.error("Error deleting users:",a),alert("Failed to delete users")}z(!1)}},ak=async(a,b)=>{z(!0);try{let c=j.filter(a=>t.has(a.id)).map(a=>a.id),e=(0,f.httpsCallable)(d.functions,"sendBulkEmail");await e({userIds:c,subject:a,body:b}),alert("Emails queued successfully!"),$(!1),u(new Set)}catch(a){console.error("Error sending emails:",a),alert("Failed to send emails")}finally{z(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"User Management & Intelligence"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Advanced user analytics and behavioral insights"})]}),(0,b.jsx)(n,{}),(0,b.jsx)(g.Card,{className:"p-4 border-slate-200",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(W.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-slate-400"}),(0,b.jsx)(h.Input,{placeholder:"Search by name, email, or referral code...",value:o,onChange:a=>p(a.target.value),className:"pl-10"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:A,onChange:a=>C(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md text-sm",children:[(0,b.jsx)("option",{value:"all",children:"All Status"}),(0,b.jsx)("option",{value:"highly_active",children:"Highly Active"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"at_risk",children:"At Risk"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:E,onChange:a=>F(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md text-sm",children:[(0,b.jsx)("option",{value:"all",children:"All Plans"}),(0,b.jsx)("option",{value:"free",children:"Free"}),(0,b.jsx)("option",{value:"pro",children:"Pro"}),(0,b.jsx)("option",{value:"pro_plus",children:"Pro+"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:G,onChange:a=>H(a.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md text-sm",children:[(0,b.jsx)("option",{value:"newest",children:"Newest First"}),(0,b.jsx)("option",{value:"last_active",children:"Last Active"}),(0,b.jsx)("option",{value:"most_active",children:"Most Active"}),(0,b.jsx)("option",{value:"highest_value",children:"Highest Value"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)(i.Button,{onClick:()=>O(!N),variant:"outline",className:"w-full",children:["Advanced",(0,b.jsx)(Y.ChevronDown,{className:`size-4 ml-2 transition-transform ${N?"rotate-180":""}`})]})})]}),N&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-200",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"text-sm font-medium text-slate-700 mb-2 flex items-center gap-2",children:[(0,b.jsx)(R.Calendar,{className:"size-4"}),"Joined Date Range"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Input,{type:"date",value:I.start,onChange:a=>J(b=>({...b,start:a.target.value})),className:"flex-1"}),(0,b.jsx)("span",{className:"self-center text-slate-500",children:"to"}),(0,b.jsx)(h.Input,{type:"date",value:I.end,onChange:a=>J(b=>({...b,end:a.target.value})),className:"flex-1"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"text-sm font-medium text-slate-700 mb-2 flex items-center gap-2",children:[(0,b.jsx)(Z.DollarSign,{className:"size-4"}),"Wallet Balance: â‚¹",K.min," - â‚¹",K.max]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(h.Input,{type:"number",value:K.min,onChange:a=>L(b=>({...b,min:parseInt(a.target.value)||0})),className:"flex-1",placeholder:"Min"}),(0,b.jsx)(h.Input,{type:"number",value:K.max,onChange:a=>L(b=>({...b,max:parseInt(a.target.value)||1e4})),className:"flex-1",placeholder:"Max"})]})]})]}),t.size>0&&(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200",children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-slate-700",children:[t.size," selected"]}),(0,b.jsxs)(i.Button,{onClick:()=>{V(j.filter(a=>t.has(a.id)),`users-export-${new Date().toISOString().split("T")[0]}.csv`)},variant:"outline",size:"sm",disabled:x,children:[(0,b.jsx)(X.Download,{className:"size-4 mr-2"}),"Export Selected"]}),(0,b.jsxs)(i.Button,{onClick:()=>S(!0),variant:"outline",size:"sm",disabled:x,children:[(0,b.jsx)(w.Edit,{className:"size-4 mr-2"}),"Bulk Edit"]}),(0,b.jsxs)(i.Button,{onClick:()=>$(!0),variant:"outline",size:"sm",disabled:x,children:[(0,b.jsx)(B.Mail,{className:"size-4 mr-2"}),"Send Email"]}),(0,b.jsxs)(i.Button,{onClick:aj,variant:"outline",size:"sm",disabled:x,className:"text-red-600 border-red-600 hover:bg-red-50",children:[(0,b.jsx)(P.Trash2,{className:"size-4 mr-2"}),"Delete Selected"]}),(0,b.jsx)(i.Button,{onClick:()=>u(new Set),variant:"outline",size:"sm",children:"Clear Selection"})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(i.Button,{onClick:()=>aa(!0),variant:"outline",size:"sm",children:[(0,b.jsx)(q.Clock,{className:"size-4 mr-2"}),"Scheduled Exports"]}),(0,b.jsxs)(i.Button,{onClick:()=>ac(!0),variant:"outline",size:"sm",children:[(0,b.jsx)(B.Mail,{className:"size-4 mr-2"}),"Email History"]})]}),(0,b.jsxs)(i.Button,{onClick:()=>{V(ai,`all-users-${new Date().toISOString().split("T")[0]}.csv`)},variant:"outline",size:"sm",children:[(0,b.jsx)(X.Download,{className:"size-4 mr-2"}),"Export All (",ai.length,")"]})]})]})}),(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-left text-sm whitespace-nowrap",children:[(0,b.jsx)("thead",{className:"bg-slate-50 border-b border-slate-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3",children:(0,b.jsx)("input",{type:"checkbox",checked:t.size===ai.length&&ai.length>0,onChange:()=>{t.size===ai.length?u(new Set):u(new Set(ai.map(a=>a.id)))},className:"rounded border-slate-300"})}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"User"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Plan"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Last Active"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Sessions (7d)"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Engagement"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Wallet"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Referral Code"}),(0,b.jsx)("th",{className:"px-4 py-3 font-medium text-slate-600",children:"Joined"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-slate-100",children:l&&0===j.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:10,className:"px-4 py-8 text-center text-slate-500",children:"Loading users..."})}):0===ai.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:10,className:"px-4 py-8 text-center text-slate-500",children:"No users found"})}):ai.map(c=>{var d,e;let f,g,h,i;return(0,b.jsxs)("tr",{className:"hover:bg-slate-50 cursor-pointer",children:[(0,b.jsx)("td",{className:"px-4 py-3",onClick:a=>a.stopPropagation(),children:(0,b.jsx)("input",{type:"checkbox",checked:t.has(c.id),onChange:()=>{var a;let b;return a=c.id,void((b=new Set(t)).has(a)?b.delete(a):b.add(a),u(b))},className:"rounded border-slate-300"})}),(0,b.jsx)("td",{className:"px-4 py-3",onClick:()=>s(c),children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-slate-900",children:c.name||"Unknown"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:c.email})]})}),(0,b.jsx)("td",{className:"px-4 py-3",onClick:()=>s(c),children:(d=c.status,g=(f={highly_active:{label:"Highly Active",color:"bg-green-100 text-green-700"},active:{label:"Active",color:"bg-blue-100 text-blue-700"},at_risk:{label:"At Risk",color:"bg-orange-100 text-orange-700"},inactive:{label:"Inactive",color:"bg-slate-100 text-slate-600"}})[d]||f.inactive,(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${g.color}`,children:g.label}))}),(0,b.jsx)("td",{className:"px-4 py-3",onClick:()=>s(c),children:(e=c.plan,i=(h={pro_plus:{label:"Pro+",color:"bg-indigo-100 text-indigo-700"},pro:{label:"Pro",color:"bg-violet-100 text-violet-700"},free:{label:"Free",color:"bg-slate-100 text-slate-600"}})[e||"free"]||h.free,(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${i.color}`,children:i.label}))}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-600",onClick:()=>s(c),children:"-"===a(c.activitySummary?.lastActive)?"Never":a(c.activitySummary?.lastActive)}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-600",onClick:()=>s(c),children:c.metrics?.sessionCount7d||0}),(0,b.jsx)("td",{className:"px-4 py-3",onClick:()=>s(c),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-16",children:(0,b.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${Math.min(100,10*(c.activitySummary?.engagementScore||0))}%`}})}),(0,b.jsx)("span",{className:"text-xs text-slate-600",children:c.activitySummary?.engagementScore||0})]})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-slate-600",onClick:()=>s(c),children:["â‚¹",c.walletBalance||0]}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-600",onClick:()=>s(c),children:c.referralCode||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-600",onClick:()=>s(c),children:a(c.createdAt)})]},c.id)})})]})}),af&&ai.length>0&&(0,b.jsxs)("div",{className:"flex items-center justify-center gap-4 p-4 border-t border-slate-200",children:[(0,b.jsxs)("p",{className:"text-sm text-slate-600",children:["Showing ",ai.length," users"]}),(0,b.jsxs)(i.Button,{onClick:()=>ah(!0),disabled:l,variant:"outline",size:"sm",children:[l?"Loading...":"Load More",(0,b.jsx)(Y.ChevronDown,{className:"size-4 ml-2"})]})]})]}),r&&(0,b.jsx)(v,{user:r,onClose:()=>s(null)}),Q&&(0,b.jsx)(y,{selectedUsers:j.filter(a=>t.has(a.id)),onClose:()=>S(!1),onComplete:()=>{S(!1),ah()}}),T&&(0,b.jsx)(D,{selectedUsers:j.filter(a=>t.has(a.id)),onClose:()=>$(!1),onSend:ak}),ab&&(0,b.jsx)(M,{open:ab,onOpenChange:ac}),_&&(0,b.jsx)(U,{onClose:()=>aa(!1)})]})}a.s(["default",()=>$],42387)}];

//# sourceMappingURL=src_app_website_admin_pannel_users_page_tsx_d370a107._.js.map