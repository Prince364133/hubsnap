module.exports=[37294,(e,t,r)=>{"use strict";var n,i,s;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=r.Propagate=r.LogVerbosity=r.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(r.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(i||(r.LogVerbosity=i={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(s||(r.Propagate=s={})),r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},91200,(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(r,"__esModule",{value:!0}),r.isTracerEnabled=r.trace=r.log=r.setLoggerVerbosity=r.setLogger=r.getLogger=void 0;let o=e.r(37294),l=e.r(5365),c=e.r(17887).version,u={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}r.getLogger=()=>u,r.setLogger=e=>{u=e},r.setLoggerVerbosity=e=>{h=e},r.log=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=u.debug;break;case o.LogVerbosity.INFO:r=u.info;break;case o.LogVerbosity.ERROR:r=u.error}r||(r=u.error),r&&r.bind(u)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let m=f.has("all");function g(e,t,n){y(t)&&(0,r.log)(e,new Date().toISOString()+" | v"+c+" "+l.pid+" | "+t+" | "+n)}function y(e){return!p.has(e)&&(m||f.has(e))}r.trace=g,r.isTracerEnabled=y},40646,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorCode=r.getErrorMessage=void 0,r.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},r.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},73155,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;let n=e.r(91200),i=e.r(37294),s=e.r(40646),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function c(e){return o.test(e)}function u(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(u(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!c(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new p;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{u(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}r.Metadata=p;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},31364,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CallCredentials=void 0;let n=e.r(73155);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{e?n(e):t?r(t):n(Error("Headers not set by metadata plugin"))})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}r.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},84049,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultRootsData=r.CIPHER_SUITES=void 0;let n=e.r(22734);r.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;r.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},83106,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelCredentials=void 0;let n=e.r(55004),i=e.r(31364),s=e.r(84049);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new c((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new c(e,null!=t?t:{})}static createInsecure(){return new l}}r.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class c extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new u(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class u extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new u(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},24521,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.isLoadBalancerNameRegistered=r.createLoadBalancer=r.registerDefaultLoadBalancerType=r.registerLoadBalancerType=r.createChildChannelControlHelper=void 0,r.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,c,u,h;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(c=null==(l=t.addChannelzChild)?void 0:l.bind(t))?c:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(u=t.removeChannelzChild)?void 0:u.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},i=null;r.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},r.registerDefaultLoadBalancerType=function(e){i=e},r.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},r.isLoadBalancerNameRegistered=function(e){return e in n},r.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&i?new n[i].LoadBalancingConfig:null},r.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},59807,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAndSelectServiceConfig=r.validateServiceConfig=r.validateRetryThrottling=void 0;let n=e.r(46786),i=e.r(37294),s=e.r(24521),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=c(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=u(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=p(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}r.validateRetryThrottling=d,r.validateServiceConfig=f,r.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}},95653,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(r.ConnectivityState=n={}))},28835,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uriToString=r.splitHostPort=r.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;r.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let i=/^\d+$/;r.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}},r.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},23359,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapUriDefaultScheme=r.getDefaultAuthority=r.createResolver=r.registerDefaultScheme=r.registerResolver=void 0;let n=e.r(28835),i={},s=null;r.registerResolver=function(e,t){i[e]=t},r.registerDefaultScheme=function(e){s=e},r.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},r.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},r.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},87080,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.QueuePicker=r.UnavailablePicker=r.PickResultType=void 0;let i=e.r(73155),s=e.r(37294);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(r.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}r.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}r.QueuePicker=o},38644,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BackoffTimeout=void 0;let n=1e3,i=1.6,s=12e4,a=.2;function o(e,t){return Math.random()*(t-e)+e}class l{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=i,this.maxDelay=s,this.jitter=a,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}r.BackoffTimeout=l},6279,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChildLoadBalancerHandler=void 0;let n=e.r(24521),i=e.r(95653),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}r.ChildLoadBalancerHandler=a},61693,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingLoadBalancer=void 0;let n=e.r(24521),i=e.r(59807),s=e.r(95653),a=e.r(23359),o=e.r(87080),l=e.r(38644),c=e.r(37294),u=e.r(73155),h=e.r(91200),d=e.r(37294),f=e.r(28835),p=e.r(6279),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function S(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}}class w{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:c.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new u.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:S(d))},onError:e=>{this.handleResolutionFailure(e)}},r);const f={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}r.ResolvingLoadBalancer=w},87147,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.channelOptionsEqual=r.recognizedOptions=void 0,r.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},r.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},46801,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.stringToSubchannelAddress=r.subchannelAddressToString=r.subchannelAddressEqual=r.isTcpSubchannelAddress=void 0;let n=e.r(4446);function i(e){return"port"in e}r.isTcpSubchannelAddress=i,r.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},r.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;r.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},81800,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAdminServicesToServer=r.registerAdminService=void 0;let n=[];r.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},r.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},82169,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClientDuplexStreamImpl=r.ClientWritableStreamImpl=r.ClientReadableStreamImpl=r.ClientUnaryCallImpl=r.callErrorFromStatus=void 0;let n=e.r(27699),i=e.r(88947),s=e.r(37294);r.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}r.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}r.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientWritableStreamImpl=l;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientDuplexStreamImpl=c},2590,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InterceptingListenerImpl=r.isInterceptingListener=void 0,r.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}r.InterceptingListenerImpl=n},89452,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getInterceptingCall=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.InterceptorConfigurationError=void 0;let n=e.r(73155),i=e.r(2590),s=e.r(37294),a=e.r(40646);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}r.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}r.ListenerBuilder=l;class c{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}r.RequesterBuilder=c;let u=(e,t)=>{t(e)},h=(e,t)=>{t(e)},d=(e,t)=>{t(e)},f={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class p{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:f.start,sendMessage:null!=(n=t.sendMessage)?n:f.sendMessage,halfClose:null!=(i=t.halfClose)?i:f.halfClose,cancel:null!=(s=t.cancel)?s:f.cancel}:this.requester=f}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let c={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,c,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:u,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:h,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:d};a=new i.InterceptingListenerImpl(e,c)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function m(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,c=r.credentials,u=e.createCall(t,s,a,o,l);return c&&u.setCredentials(c),u}r.InterceptingCall=p;class g{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class y extends g{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class v extends g{}function b(e,t,r){let n=m(e,r.path,t);return r.responseStream?new v(n,r):new y(n,r)}r.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>b(n,e,t))(s)}},4681,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;let n=e.r(82169),i=e.r(75917),s=e.r(95653),a=e.r(37294),o=e.r(73155),l=e.r(89452),c=Symbol(),u=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[u]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[h]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[u].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[c]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[c]=n(e,t,r)}else this[c]=new i.ChannelImplementation(e,t,r)}close(){this[c].close()}getChannel(){return this[c]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[c].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[c].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,f){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[c],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let S=b.call,w={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(m=b.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=b.callOptions.interceptor_providers)?g:[]},T=(0,l.getInterceptingCall)(w,b.methodDefinition,b.callOptions,b.channel);S.call=T;let C=null,E=!1,_=Error();return T.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==C&&T.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK)if(null===C){let t=p(_);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,C);else{let t=p(_);b.callback((0,n.callErrorFromStatus)(e,t))}_=null,S.emit("status",e)}}}),T.sendMessage(i),T.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[c],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let T=null,C=!1,E=Error();return w.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==T&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),T=e},onReceiveStatus(e){if(!C){if(C=!0,e.code===a.Status.OK)if(null===T){let t=p(E);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,T);else{let t=p(E);v.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[c],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let T=!1,C=Error();return w.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!T){if(T=!0,b.push(null),e.code!==a.Status.OK){let t=p(C);b.emit("error",(0,n.callErrorFromStatus)(e,t))}C=null,b.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,f;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[c],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let w=!1,T=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!w){if(w=!0,v.push(null),e.code!==a.Status.OK){let t=p(T);v.emit("error",(0,n.callErrorFromStatus)(e,t))}T=null,v.emit("status",e)}}}),v}}r.Client=m},55779,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadPackageDefinition=r.makeClientConstructor=void 0;let n=e.r(4681),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,c=n.responseDeserialize,u=o(i[r],n.path,l,c);a.prototype[t]=u,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}r.makeClientConstructor=a,r.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],c=t;for(let e of i.slice(0,-1))c[e]||(c[e]={}),c=c[e];l(n)?c[o]=n:c[o]=a(n,o,{})}return t}},16702,(e,t,r)=>{var n=1/0,i="[object Symbol]",s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o="\\ud800-\\udfff",l="\\u0300-\\u036f\\ufe20-\\ufe23",c="\\u20d0-\\u20f0",u="\\u2700-\\u27bf",h="a-z\\xdf-\\xf6\\xf8-\\xff",d="A-Z\\xc0-\\xd6\\xd8-\\xde",f="\\ufe0e\\ufe0f",p="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",m="['â€™]",g="["+o+"]",y="["+p+"]",v="["+l+c+"]",b="\\d+",S="["+u+"]",w="["+h+"]",T="[^"+o+p+b+u+h+d+"]",C="\\ud83c[\\udffb-\\udfff]",E="[^"+o+"]",_="(?:\\ud83c[\\udde6-\\uddff]){2}",I="[\\ud800-\\udbff][\\udc00-\\udfff]",k="["+d+"]",R="\\u200d",A="(?:"+w+"|"+T+")",x="(?:"+k+"|"+T+")",D="(?:"+m+"(?:d|ll|m|re|s|t|ve))?",O="(?:"+m+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+v+"|"+C+")?",P="["+f+"]?",M="(?:"+R+"(?:"+[E,_,I].join("|")+")"+P+N+")*",L=P+N+M,F="(?:"+[S,_,I].join("|")+")"+L,B="(?:"+[E+v+"?",v,_,I,g].join("|")+")",j=RegExp(m,"g"),U=RegExp(v,"g"),V=RegExp(C+"(?="+C+")|"+B+L,"g"),q=RegExp([k+"?"+w+"+"+D+"(?="+[y,k,"$"].join("|")+")",x+"+"+O+"(?="+[y,k+A,"$"].join("|")+")",k+"?"+A+"+"+D,k+"+"+O,b,F].join("|"),"g"),z=RegExp("["+R+o+l+c+f+"]"),$=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,K={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},H=e.g&&e.g.Object===Object&&e.g,G="object"==typeof self&&self&&self.Object===Object&&self,W=H||G||Function("return this")();function Q(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function J(e){return e.split("")}function Y(e){return e.match(s)||[]}var X=function(e){return function(t){return null==e?void 0:e[t]}}(K);function Z(e){return z.test(e)}function ee(e){return $.test(e)}function et(e){return Z(e)?er(e):J(e)}function er(e){return e.match(V)||[]}function en(e){return e.match(q)||[]}var ei=Object.prototype.toString,es=W.Symbol,ea=es?es.prototype:void 0,eo=ea?ea.toString:void 0;function el(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function ec(e){if("string"==typeof e)return e;if(ef(e))return eo?eo.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}function eu(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:el(e,t,r)}function eh(e){return function(t){var r=Z(t=ep(t))?et(t):void 0,n=r?r[0]:t.charAt(0),i=r?eu(r,1).join(""):t.slice(1);return n[e]()+i}}function ed(e){return!!e&&"object"==typeof e}function ef(e){return"symbol"==typeof e||ed(e)&&ei.call(e)==i}function ep(e){return null==e?"":ec(e)}var em=function(e){return function(t){return Q(eb(ey(t).replace(j,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?eg(t):t)});function eg(e){return ev(ep(e).toLowerCase())}function ey(e){return(e=ep(e))&&e.replace(a,X).replace(U,"")}var ev=eh("toUpperCase");function eb(e,t,r){return(e=ep(e),void 0===(t=r?void 0:t))?ee(e)?en(e):Y(e):e.match(t)||[]}t.exports=em},86590,(e,t,r)=>{"use strict";t.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},67789,(e,t,r)=>{"use strict";var n=r;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=Array(64),s=Array(123),a=0;a<64;)s[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,s=null,a=[],o=0,l=0;t<r;){var c=e[t++];switch(l){case 0:a[o++]=i[c>>2],n=(3&c)<<4,l=1;break;case 1:a[o++]=i[n|c>>4],n=(15&c)<<2,l=2;break;case 2:a[o++]=i[n|c>>6],a[o++]=i[63&c],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=i[n],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var o="invalid encoding";n.decode=function(e,t,r){for(var n,i=r,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=s[c]))throw Error(o);switch(a){case 0:n=c,a=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,a=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,a=3;break;case 3:t[r++]=(3&n)<<6|c,a=0}}if(1===a)throw Error(o);return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},89767,(e,t,r)=>{"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},23758,(e,t,r)=>{"use strict";function n(e){return"u">typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,o)}(),"u">typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function r(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,c=0x100000000*(1048575&a)+s;return 2047===l?c?NaN:1/0*o:0===l?5e-324*o*c:o*Math.pow(2,l-1075)*(c+0x10000000000000)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function s(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},56492,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},32518,(e,t,r)=>{"use strict";var n=r;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},97554,(e,t,r)=>{"use strict";t.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},94659,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(20841);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},20841,(e,t,r)=>{"use strict";var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=e.r(86590),n.base64=e.r(67789),n.EventEmitter=e.r(89767),n.float=e.r(23758),n.inquire=e.r(56492),n.utf8=e.r(32518),n.pool=e.r(97554),n.LongBits=e.r(94659),n.isNode=!!(e.g&&e.g.process&&e.g.process.versions&&e.g.process.versions.node),n.global=n.isNode&&e.g||"u">typeof self&&self||e.e,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"u"<typeof Uint8Array?e:new Uint8Array(e)},n.Array="u">typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},88443,(e,t,r)=>{"use strict";t.exports={}},22805,(e,t,r)=>{"use strict";function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=s();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),c=0;c<a.length;)o[c]=a[c],l[c]=e[a[c++]];return o[c]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var u=Array(arguments.length-1),h=0;h<u.length;)u[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=u[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==u.length)throw Error("parameter count mismatch");return r.push(e),i}function s(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}t.exports=n,n.verbose=!1},41702,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(86590),i=e.r(56492)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"u">typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"u">typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},21491,(e,t,r)=>{"use strict";var n=r,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return n+t.join("/")};n.resolve=function(e,t,r){return(r||(t=s(t)),i(t))?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},35170,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(20453);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=e.r(52265),l=e.r(6067),c=e.r(29294);function u(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=u,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof c||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},76854,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(52265);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e.r(93467),s=e.r(6067);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},30300,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(20453);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=e.r(6067);function s(e,t,r,s,a,o,l,c,u){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=c,this.parsedOptions=u}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},31664,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(20841);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},88919,(e,t,r)=>{"use strict";r.Service=e.r(31664)},583,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(35170);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=e.r(30300),s=e.r(6067),a=e.r(88919);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},96376,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(20841);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},69351,(e,t,r)=>{"use strict";t.exports=l;var n,i=e.r(20841),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c="u">typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++])return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},5307,(e,t,r)=>{"use strict";t.exports=h;var n,i=e.r(20841),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function f(e,t,r){t[r]=255&e}function p(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},68305,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(54203),i=e.r(93467),s=e.r(6067);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,c="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",c)("%s={}",c)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',c):t("%s[k]=value",c)):o.repeated?(t("if(!(%s&&%s.length))",c,c)("%s=[]",c),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",c,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",c,r):t("%s.push(r.%s())",c,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",c,r):t("%s=r.%s()",c,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var u=e._fieldsArray[r];u.required&&t("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})",a(u))}return t("return m")}},11165,(e,t,r)=>{"use strict";t.exports=l;var n=e.r(54203),i=e.r(6067);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var c=e._fieldsArray[l].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",s(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),o(t,c,"k[i]"),a(t,c,l,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",s(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,l,u+"[i]")("}");else{if(c.partOf){var h=i.safeProp(c.partOf.name);1===n[c.partOf.name]&&t("if(p%s===1)",h)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,t("p%s=1",h)}a(t,c,l,u)}c.optional&&t("}")}return t("return null")}},32038,(e,t,r)=>{"use strict";var n=r,i=e.r(54203),s=e.r(6067);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,c)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],c=0;c<t.length;++c)t[c].partOf||(t[c].resolve().repeated?n:t[c].map?a:l).push(t[c]);if(n.length){for(r("if(o.arrays||o.defaults){"),c=0;c<n.length;++c)r("d%s=[]",s.safeProp(n[c].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),c=0;c<a.length;++c)r("d%s={}",s.safeProp(a[c].name));r("}")}if(l.length){for(r("if(o.defaults){"),c=0;c<l.length;++c){var u=l[c],h=s.safeProp(u.name);if(u.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,u.resolvedType.valuesById[u.typeDefault],u.typeDefault);else if(u.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,u.typeDefault.toString(),u.typeDefault.toNumber());else if(u.bytes){var d="["+Array.prototype.slice.call(u.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,u.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,u.typeDefault)}r("}")}var f=!1;for(c=0;c<t.length;++c){var u=t[c],p=e._fieldsArray.indexOf(u),h=s.safeProp(u.name);u.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,u,p,h+"[ks2[j]]")("}")):u.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,u,p,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,u.name),o(r,u,p,h),u.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(u.partOf.name),u.name)),r("}")}return r("return d")}},30964,(e,t,r)=>{"use strict";var n=r,i=e.r(96376);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},21520,(e,t,r)=>{"use strict";t.exports=v;var n=e.r(35170);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=e.r(54203),s=e.r(29294),a=e.r(52265),o=e.r(76854),l=e.r(583),c=e.r(96376),u=e.r(69351),h=e.r(5307),d=e.r(6067),f=e.r(18153),p=e.r(68305),m=e.r(11165),g=e.r(32038),y=e.r(30964);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof c||((e.prototype=new c).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,c,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var c=Object.keys(t.fields),u=0;u<c.length;++u)r.add((void 0!==t.fields[c[u]].keyType?o.fromJSON:a.fromJSON)(c[u],t.fields[c[u]]));if(t.oneofs)for(c=Object.keys(t.oneofs),u=0;u<c.length;++u)r.add(s.fromJSON(c[u],t.oneofs[c[u]]));if(t.nested)for(c=Object.keys(t.nested),u=0;u<c.length;++u){var h=t.nested[c[u]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(c[u],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:u,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof u||(e=u.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},48476,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(35170);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=e.r(52265),l=e.r(54203),c=e.r(29294),u=e.r(6067);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=u.path.resolve,h.prototype.fetch=u.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return u.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function c(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(u.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),u.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=c(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=c(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=c(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var r;try{r=u.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++p,a.fetch(e,function(r,i){if(--p,n){if(r)return void(t?p||l(null,a):l(r));h(e,i)}})}}var p=0;u.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&f(m);return o?a.resolveAll():p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!u.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof c)){if(e instanceof n)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},6067,(e,t,r)=>{"use strict";var n,i,s=t.exports=e.r(20841),a=e.r(88443);s.codegen=e.r(22805),s.fetch=e.r(41702),s.path=e.r(21491),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var c=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(c,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(t,r){if(t.$type)return r&&t.$type.name!==r&&(s.decorateRoot.remove(t.$type),t.$type.name=r,s.decorateRoot.add(t.$type)),t.$type;n||(n=e.r(21520));var i=new n(r||t.name);return s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var u=0;s.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e.r(54203));var r=new i("Enum"+u++,t);return s.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e.r(48476)))}})},93467,(e,t,r)=>{"use strict";var n=r,i=e.r(6067),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},52265,(e,t,r)=>{"use strict";t.exports=c;var n,i=e.r(20453);((c.prototype=Object.create(i.prototype)).constructor=c).className="Field";var s=e.r(54203),a=e.r(93467),o=e.r(6067),l=/^required|optional|repeated$/;function c(e,t,r,n,s,c,u){if(o.isObject(n)?(u=s,c=n,n=s=void 0):o.isObject(s)&&(u=c,c=s,s=void 0),i.call(this,e,c),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=u}c.fromJSON=function(e,t){var r=new c(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(c.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(c.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(c.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(c.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(c.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),c.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},c.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},c.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},c.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},c.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},c.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new c(s,e,t,r,{default:n}))}},c._configure=function(e){n=e}},29294,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(20453);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e.r(52265),s=e.r(6067);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},20453,(e,t,r)=>{"use strict";t.exports=c,c.className="ReflectionObject";let n=e.r(29294);var i,s=e.r(6067),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function c(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(c.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),c.prototype.toJSON=function(){throw Error()},c.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},c.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},c.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},c.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},c.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},c.prototype._inferLegacyProtoFeatures=function(){return{}},c.prototype.getOption=function(e){if(this.options)return this.options[e]},c.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},c.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},c.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},c.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},c.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},c._configure=function(e){i=e}},54203,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(20453);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e.r(35170),s=e.r(6067);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},18153,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(54203),i=e.r(93467),s=e.r(6067);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var c=l[t].resolve(),u=e._fieldsArray.indexOf(c),h=c.resolvedType instanceof n?"int32":c.type,d=i.basic[h];r="m"+s.safeProp(c.name),c.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,c.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(c.id<<3|2)>>>0,8|i.mapKey[c.keyType],c.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",u,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):c.repeated?(o("if(%s!=null&&%s.length){",r,r),c.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(c.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,c,u,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(c.id<<3|d)>>>0,h,r)),o("}")):(c.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,c.name),void 0===d?a(o,c,u,r):o("w.uint32(%i).%s(%s)",(c.id<<3|d)>>>0,h,r))}return o("return w")}},66685,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(5307);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(20841);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},81246,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(69351);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(20841);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},90562,(e,t,r)=>{"use strict";var n=r;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=e.r(5307),n.BufferWriter=e.r(66685),n.Reader=e.r(69351),n.BufferReader=e.r(81246),n.util=e.r(20841),n.rpc=e.r(88919),n.roots=e.r(88443),n.configure=i,i()},5982,(e,t,r)=>{"use strict";var n=t.exports=e.r(90562);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=e.r(18153),n.decoder=e.r(68305),n.verifier=e.r(11165),n.converter=e.r(32038),n.ReflectionObject=e.r(20453),n.Namespace=e.r(35170),n.Root=e.r(48476),n.Enum=e.r(54203),n.Type=e.r(21520),n.Field=e.r(52265),n.OneOf=e.r(29294),n.MapField=e.r(76854),n.Service=e.r(583),n.Method=e.r(30300),n.Message=e.r(96376),n.wrappers=e.r(30964),n.types=e.r(93467),n.util=e.r(6067),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},14386,(e,t,r)=>{"use strict";t.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,o=/^\s*\*?\/*/,l=/\n/g,c=/\s/,u=/\\(.?)/g,h={0:"\0",r:"\r",n:"\n",t:"	"};function d(e){return e.replace(u,function(e,t){switch(t){case"\\":case"":return t;default:return h[t]||""}})}function f(e,t){e=e.toString();var r=0,u=e.length,h=1,f=0,p={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?s:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw y("string");return r=t.lastIndex,E(g),g=null,d(n[1])}function b(t){return e.charAt(t)}function S(r,n,i){var s,c={type:e.charAt(r++),lineEmpty:!1,leading:i},u=r-(t?2:3);do if(--u<0||"\n"===(s=e.charAt(u))){c.lineEmpty=!0;break}while(" "===s||"	"===s)for(var d=e.substring(r,n).split(l),m=0;m<d.length;++m)d[m]=d[m].replace(t?o:a,"").trim();c.text=d.join("\n").trim(),p[h]=c,f=h}function w(t){var r=T(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function T(e){for(var t=e;t<u&&"\n"!==b(t);)t++;return t}function C(){if(m.length>0)return m.shift();if(g)return v();var i,s,a,o,l,d=0===r;do{if(r===u)return null;for(i=!1;c.test(a=b(r));)if("\n"===a&&(d=!0,++h),++r===u)return null;if("/"===b(r)){if(++r===u)throw y("comment");if("/"===b(r))if(t){if(o=r,l=!1,w(r-1)){l=!0;do if((r=T(r))===u||(r++,!d))break;while(w(r))}else r=Math.min(u,T(r)+1);l&&(S(o,r,d),d=!0),h++,i=!0}else{for(l="/"===b(o=r+1);"\n"!==b(++r);)if(r===u)return null;++r,l&&(S(o,r-1,d),d=!0),++h,i=!0}else{if("*"!==(a=b(r)))return"/";o=r+1,l=t||"*"===b(o);do{if("\n"===a&&++h,++r===u)throw y("comment");s=a,a=b(r)}while("*"!==s||"/"!==a)++r,l&&(S(o,r-2,d),d=!0),i=!0}}}while(i)var f=r;if(n.lastIndex=0,!n.test(b(f++)))for(;f<u&&!n.test(b(f));)++f;var p=e.substring(r,r=f);return('"'===p||"'"===p)&&(g=p),p}function E(e){m.push(e)}function _(){if(!m.length){var e=C();if(null===e)return null;E(e)}return m[0]}function I(e,t){var r=_();if(r===e)return C(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function k(e){var r,n=null;return void 0===e?(r=p[h-1],delete p[h-1],r&&(t||"*"===r.type||r.lineEmpty)&&(n=r.leading?r.text:null)):(f<e&&_(),r=p[e],delete p[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(n=r.leading?null:r.text)),n}return Object.defineProperty({next:C,peek:_,push:E,skip:I,cmnt:k},"line",{get:function(){return h}})}f.unescape=d},80904,(e,t,r)=>{"use strict";t.exports=E,E.filename=null,E.defaults={keepCase:!1};var n=e.r(14386),i=e.r(48476),s=e.r(21520),a=e.r(52265),o=e.r(76854),l=e.r(29294),c=e.r(54203),u=e.r(583),h=e.r(30300),d=e.r(20453),f=e.r(93467),p=e.r(6067),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,S=/^-?0[0-7]+$/,w=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,T=/^[a-zA-Z_][a-zA-Z_0-9]*$/,C=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function E(e,t,r){t instanceof i||(r=t,t=new i),r||(r=E.defaults);var _,I,k,R,A=r.preferTrailingComment||!1,x=n(e,r.alternateCommentMode||!1),D=x.next,O=x.push,N=x.peek,P=x.skip,M=x.cmnt,L=!0,F="proto2",B=t,j=[],U={},V=r.keepCase?function(e){return e}:p.camelCase;function q(){j.forEach(e=>{e._edition=F,Object.keys(U).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,U[t],!0)})})}function z(e,t,r){var n=E.filename;return r||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+x.line+")")}function $(){var e,t=[];do{if('"'!==(e=D())&&"'"!==e)throw z(e);t.push(D()),P(e),e=N()}while('"'===e||"'"===e)return t.join("")}function K(e){var t=D();switch(t){case"'":case'"':return O(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(t,!0)}catch(r){if(e&&C.test(t))return t;throw z(t,"value")}}function H(e,t){do if(t&&('"'===(r=N())||"'"===r)){var r,n,i=$();if(e.push(i),F>=2023)throw z(i,"id")}else try{e.push([n=W(D()),P("to",!0)?W(D()):n])}catch(n){if(t&&C.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0))var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)})}function G(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(w.test(e))return r*parseFloat(e);throw z(e,"number",t)}function W(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw z(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(S.test(e))return parseInt(e,8);throw z(e,"id")}function Q(){if(void 0!==I)throw z("package");if(I=D(),!C.test(I))throw z(I,"name");B=B.define(I),P(";")}function J(){var e,t=N();switch(t){case"weak":e=R||(R=[]),D();break;case"public":D();default:e=k||(k=[])}t=$(),P(";"),e.push(t)}function Y(){if(P("="),(F=$())<2023)throw z(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=$()))throw z(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=x.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=E.filename),P("{",!0)){for(;"}"!==(n=D());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||A)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!T.test(t=D()))throw z(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw z(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw z(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":H(r.extensions||(r.extensions=[]));break;case"reserved":H(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!C.test(e))throw z(e);O(e),er(r,"optional")}}),e.add(r),e===B&&j.push(r)}function er(e,t,r){var n=D();if("group"===n)return void en(e,t);for(;n.endsWith(".")||N().startsWith(".");)n+=D();if(!C.test(n))throw z(n,"type");var i=D();if(!T.test(i))throw z(i,"name");i=V(i),P("=");var s=new a(i,W(D()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&j.push(s)}function en(e,t){if(F>=2023)throw z("group");var r=D();if(!T.test(r))throw z(r,"name");var n=p.lcFirst(r);r===n&&(r=p.ucFirst(r)),P("=");var i=W(D()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=E.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":H(o.reserved||(o.reserved=[]),!0);break;default:throw z(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=D();if(void 0===f.mapKey[t])throw z(t,"type");P(",");var r=D();if(!C.test(r))throw z(r,"type");P(">");var n=D();if(!T.test(n))throw z(n,"name");P("=");var i=new o(V(n),W(D()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw z(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!T.test(t=D()))throw z(t,"name");var r=new l(V(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!T.test(t=D()))throw z(t,"name");var r=new c(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":H(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&j.push(r)}function eo(e,t){if(!T.test(t))throw z(t,"name");P("=");var r=W(D(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw z(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=D());"="!==t;){if("("===t){var s=D();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=D()}var o=ec(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function ec(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!T.test(_=D()))throw z(_,"name");if(null===_)throw z(_,"end of input");var n,i,s=_;if(P(":",!0),"{"===N())n=ec(e,t+"."+_);else if("["===N()){if(n=[],P("[",!0)){do i=K(!0),n.push(i);while(P(",",!0))P("]"),void 0!==i&&eu(e,t+"."+_,i)}}else n=K(!0),eu(e,t+"."+_,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=K(!0);return eu(e,t,o),o}function eu(e,t,r){if(B===e&&/^features\./.test(t)){U[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0))P("]")}return e}function ef(e,t){if(!T.test(t=D()))throw z(t,"service name");var r=new u(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ep(r,e);else throw z(e)}),e.add(r),e===B&&j.push(r)}function ep(e,t){var r=M(),n=t;if(!T.test(t=D()))throw z(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!C.test(t=D())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!C.test(t=D())))throw z(t);a=t,P(")");var c=new h(l,n,i,a,s,o);c.comment=r,ee(c,function(e){if("option"===e)el(c,e),P(";");else throw z(e)}),e.add(c)}function em(e,t){if(!C.test(t=D()))throw z(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!C.test(t))throw z(t);O(t),er(e,"optional",r)}})}for(;null!==(_=D());)switch(_){case"package":if(!L)throw z(_);Q();break;case"import":if(!L)throw z(_);J();break;case"syntax":if(!L)throw z(_);Y();break;case"edition":if(!L)throw z(_);X();break;case"option":el(B,_),P(";",!0);break;default:if(Z(B,_)){L=!1;continue}throw z(_)}return q(),E.filename=null,{package:I,imports:k,weakImports:R,root:t}}},30496,(e,t,r)=>{"use strict";t.exports=s;var n,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:n}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},48368,(e,t,r)=>{"use strict";var n=t.exports=e.r(5982);n.build="full",n.tokenize=e.r(14386),n.parse=e.r(80904),n.common=e.r(30496),n.Root._configure(n.Type,n.parse,n.common)},56735,(e,t,r)=>{"use strict";t.exports=e.r(48368)},23751,(e,t,r)=>{"use strict";var n=e.r(56735);t.exports=r=n.descriptor=n.Root.fromJSON(e.r(85565)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,c=n.MapField,u=n.OneOf,h=n.Service,d=n.Method;function f(e,t,n){var c=r.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});x(n,c),e instanceof s||(c.package=e.fullName.substring(1));for(var u,d=0;d<e.nestedArray.length;++d)(u=e._nestedArray[d])instanceof o?c.messageType.push(u.toDescriptor(n)):u instanceof a?c.enumType.push(u.toDescriptor()):u instanceof l?c.extension.push(u.toDescriptor(n)):u instanceof h?c.service.push(u.toDescriptor()):u instanceof i&&f(u,t,n);c.options=I(e.options,r.FileOptions),c.messageType.length+c.enumType.length+c.extension.length+c.service.length&&t.push(c)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=r.FileDescriptorSet.decode(e));var t=new s;if(e.file)for(var n,i,c,u=0;u<e.file.length;++u){i=t,(n=e.file[u]).package&&n.package.length&&(i=t.define(n.package));var d=A(n);if(n.name&&n.name.length&&t.files.push(i.filename=n.name),n.messageType)for(c=0;c<n.messageType.length;++c)i.add(o.fromDescriptor(n.messageType[c],d));if(n.enumType)for(c=0;c<n.enumType.length;++c)i.add(a.fromDescriptor(n.enumType[c],d));if(n.extension)for(c=0;c<n.extension.length;++c)i.add(l.fromDescriptor(n.extension[c],d));if(n.service)for(c=0;c<n.service.length;++c)i.add(h.fromDescriptor(n.service[c],d));var f=E(n.options,r.FileOptions);if(f){var p=Object.keys(f);for(c=0;c<p.length;++c)i.setOption(p[c],f[p[c]])}}return t.resolveAll()},s.prototype.toDescriptor=function(e){var t=r.FileDescriptorSet.create();return f(this,t.file,e),t};var p=0;o.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+p++,E(e.options,r.MessageOptions));if(n||(s._edition=t),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(u.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var c=l.fromDescriptor(e.field[i],t,!0);s.add(c),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(c)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],t,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],t,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var t,n,i=r.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(t=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof c){var s=T(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),u=T(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===u||14===u?this._fieldsArray[n].resolvedType&&k(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(r.DescriptorProto.create({name:t.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:u,typeName:h})],options:r.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,r.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,t,n){if("number"==typeof e.length&&(e=r.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=t),o.options=E(e.options,r.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var c=e.defaultValue;switch(c){case"true":case"TRUE":c=!0;break;case"false":case"FALSE":c=!1;break;default:m.exec(c)&&(c=parseInt(c))}o.setOption("default",c)}return w(e.type)&&("proto3"===t?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||"proto2"===t)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var t=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=n.util.ucFirst(this.name),t.label=3;else{switch(t.type=T(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?k(this.parent,this.resolvedType):this.type}"repeated"===this.rule?t.label=3:this.required&&"proto2"===e?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=I(this.options,r.FieldOptions),null!=this.options.default&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),"proto3"===e?this.packed||((t.options||(t.options=r.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((t.options||(t.options=r.FieldOptions.create())).packed=!0),t};var g=0;a.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var c=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,E(e.options,r.EnumOptions));return n||(c._edition=t),c},a.prototype.toDescriptor=function(){for(var e=[],t=0,n=Object.keys(this.values);t<n.length;++t)e.push(r.EnumValueDescriptorProto.create({name:n[t],number:this.values[n[t]]}));return r.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,r.EnumOptions)})};var y=0;u.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.OneofDescriptorProto.decode(e)),new u(e.name&&e.name.length?e.name:"oneof"+y++)},u.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,E(e.options,r.ServiceOptions));if(n||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,r.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function w(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function T(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function C(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=R(n);r.resolvedType instanceof o?i[l]=C(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function E(e,t){if(e)return C(t.toObject(e),t)}function _(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var c=t.fields[l];c.resolvedType instanceof o?r[l]=_(e[a],c.resolvedType):r[l]=e[a],c.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(_(e,t))}function k(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var c=t.lookup(r[a++],!0);if(null!==c&&c!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function R(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function A(e){if("editions"===e.syntax)if(e.edition===r.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function x(e,t){if(e)if("proto2"===e||"proto3"===e)t.syntax=e;else if(t.syntax="editions","2023"===e)t.edition=r.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,E(e.options,r.MethodOptions))},d.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,r.MethodOptions)})}},99040,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addCommonProtos=r.loadProtosWithOptionsSync=r.loadProtosWithOptions=void 0;let n=e.r(22734),i=e.r(14747),s=e.r(56735);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}r.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},r.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},r.addCommonProtos=function(){let t=e.r(58950),r=e.r(85565),n=e.r(48109),i=e.r(95685);s.common("api",t.nested.google.nested.protobuf.nested),s.common("descriptor",r.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},54960,(e,t,r)=>{!function(n,i){function s(e){return e.default||e}if("function"==typeof define&&define.amd){let t;void 0!==(t=function(){var e={};return i(e),s(e)}())&&e.v(t)}else i(r),t.exports=s(r)}("u">typeof globalThis?globalThis:"u">typeof self?self:e.e,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=c(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=c(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return C}else{if(e<=-m)return E;if(e+1>=m)return T}return e<0?l(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=c;var u=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(u(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(u(r,o));s=s.mul(d).add(l(c))}else s=(s=s.mul(i)).add(l(c))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var S=o(1,!0);r.UONE=S;var w=o(-1);r.NEG_ONE=w;var T=c(-1,0x7fffffff,!1);r.MAX_VALUE=T;var C=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=C;var E=c(0,-0x80000000,!1);r.MIN_VALUE=E;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(E))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(u(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),c=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},_.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(1&this.low)==1},_.isEven=function(){return(1&this.low)==0},_.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return 0>this.comp(e)},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return 0>=this.comp(e)},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},_.neg=_.negate,_.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,u=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,m=0;return t=0+((r=0+(o+f))>>>16),r&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+u,p+=m>>>16,m&=65535,p+=i+l,c(t<<16|r,(p&=65535)<<16|m,this.unsigned)},_.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,u=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,m=65535&e.low,b=0,S=0;return r=0+((i=0+u*m)>>>16),i&=65535,r+=o*m,S+=r>>>16,r&=65535,r+=u*p,S+=r>>>16,r&=65535,S+=a*m,b+=S>>>16,S&=65535,S+=o*p,b+=S>>>16,S&=65535,S+=u*f,b+=S>>>16,S&=65535,b+=s*m+a*p+o*f+u*h,c(r<<16|i,(b&=65535)<<16|S,this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(E))if(e.eq(b)||e.eq(w))return E;else return e.eq(E)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:w:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:u(2,a-48),h=l(r),f=h.mul(e);f.isNegative()||f.gt(i);)r-=o,f=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},_.div=_.divide,_.modulo=function(e){return(n(e)||(e=d(e)),t)?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return c(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(e){return n(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return n(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return n(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?c(this.high,0,this.unsigned):c(this.high>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,c(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,c(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return c(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},_.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},45262,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.loadFileDescriptorSetFromObject=r.loadFileDescriptorSetFromBuffer=r.fromJSON=r.loadSync=r.load=r.IdempotencyLevel=r.isAnyExtension=r.Long=void 0;let i=e.r(16702),s=e.r(56735),a=e.r(23751),o=e.r(99040);r.Long=e.r(54960),r.isAnyExtension=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(n=r.IdempotencyLevel||(r.IdempotencyLevel={}));let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function u(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let r=c(t,e.name);return u(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function m(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:n.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function g(e,t,r,n){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,r),responseSerialize:p(a),responseDeserialize:f(a,r),originalName:i(e.name),requestType:v(s,n),responseType:v(a,n),options:m(e.parsedOptions)}}function y(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,r,n);return i}function v(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function S(e,t,r,n){if(e instanceof s.Service)return y(e,t,r,n);if(e instanceof s.Type)return v(e,n);if(e instanceof s.Enum)return b(e,n);throw Error("Type mismatch in reflection object handling")}function w(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))r[i]=S(s,i,t,n);return r}function T(e,t){t=t||{};let r=s.Root.fromDescriptor(e);return r.resolveAll(),w(r,t)}r.load=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>w(e,t))},r.loadSync=function(e,t){return w((0,o.loadProtosWithOptionsSync)(e,t),t)},r.fromJSON=function(e,t){t=t||{};let r=s.Root.fromJSON(e);return r.resolveAll(),w(r,t)},r.loadFileDescriptorSetFromBuffer=function(e,t){return T(a.FileDescriptorSet.decode(e),t)},r.loadFileDescriptorSetFromObject=function(e,t){return T(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},1534,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.getChannelzServiceDefinition=r.getChannelzHandlers=r.unregisterChannelzRef=r.registerChannelzSocket=r.registerChannelzServer=r.registerChannelzSubchannel=r.registerChannelzChannel=r.ChannelzCallTracker=r.ChannelzChildrenTracker=r.ChannelzTrace=void 0;let n=e.r(4446),i=e.r(95653),s=e.r(37294),a=e.r(46801),o=e.r(81800),l=e.r(55779);function c(e){return{channel_id:e.id,name:e.name}}function u(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:k(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:k(e.timestamp),channel_ref:e.childChannel?c(e.childChannel):null,subchannel_ref:e.childSubchannel?u(e.childSubchannel):null}))}}}r.ChannelzTrace=p;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}r.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}r.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],S=[],w=[],T=[];function C(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function E(e){return""===e?[]:[].concat(...e.split(":").map(e=>C(e)))}function _(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(E(t)),s=Buffer.from(E(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function I(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function k(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function R(e){let t=e.getInfo();return{ref:c(e.ref),data:{target:t.target,state:I(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>c(e)),subchannel_ref:t.children.subchannels.map(e=>u(e))}}function A(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r}):t(null,{channel:R(n)})}function x(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(R(e)),n.length>=r))break}t(null,{channel:n,end:i>=w.length})}function D(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function O(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r}):t(null,{server:D(n)})}function N(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<w.length;i++){let e=w[i];if(void 0!==e&&(n.push(D(e)),n.length>=r))break}t(null,{server:n,end:i>=w.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:u(n.ref),data:{target:i.target,state:I(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:k(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=_(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),c=T[l];if(void 0===c)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let u=c.getInfo(),h=u.security?{model:"tls",tls:{cipher_suite:u.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=u.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=u.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=u.security.localCertificate)?i:void 0,remote_certificate:null!=(a=u.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(c.ref),local:u.localAddress?M(u.localAddress):null,remote:u.remoteAddress?M(u.remoteAddress):null,remote_name:null!=(o=u.remoteName)?o:void 0,security:h,data:{keep_alives_sent:u.keepAlivesSent,streams_started:u.streamsStarted,streams_succeeded:u.streamsSucceeded,streams_failed:u.streamsFailed,last_local_stream_created_timestamp:k(u.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:k(u.lastRemoteStreamCreatedTimestamp),messages_received:u.messagesReceived,messages_sent:u.messagesSent,last_message_received_timestamp:k(u.lastMessageReceivedTimestamp),last_message_sent_timestamp:k(u.lastMessageSentTimestamp),local_flow_control_window:u.localFlowControlWindow?{value:u.localFlowControlWindow}:null,remote_flow_control_window:u.remoteFlowControlWindow?{value:u.remoteFlowControlWindow}:null}}})}function F(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],c=0;for(;c<o.length&&(!(o[c].id>=i)||(l.push(d(o[c])),!(l.length>=a)));c++);t(null,{socket_ref:l,end:c>=o.length})}function B(){return{GetChannel:A,GetTopChannels:x,GetServer:O,GetServers:N,GetSubchannel:P,GetSocket:L,GetServerSockets:F}}r.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i},r.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(S[n]={ref:i,getInfo:t}),i},r.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(w[r]={ref:n,getInfo:e}),n},r.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(T[n]={ref:i,getInfo:t}),i},r.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete w[e.id];return;case"socket":delete T[e.id];return}},r.getChannelzHandlers=B;let j=null;function U(){if(j)return j;let t=(0,e.r(45262).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/node_modules/@grpc/grpc-js/build/src/../../proto"]});return j=(0,l.loadPackageDefinition)(t).grpc.channelz.v1.Channelz.service}r.getChannelzServiceDefinition=U,r.setup=function(){(0,o.registerAdminService)(U,B)}},6312,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Subchannel=void 0;let n=e.r(95653),i=e.r(38644),s=e.r(91200),a=e.r(37294),o=e.r(28835),l=e.r(46801),c=e.r(1534),u="subchannel",h=0x7fffffff;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new c.ChannelzCallTracker,this.childrenTracker=new c.ChannelzChildrenTracker,this.streamTracker=new c.ChannelzCallTracker;const u={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},u),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new c.ChannelzTrace,this.channelzRef=(0,c.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,u,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,c.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}r.Subchannel=d},60702,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.DEFAULT_PORT=void 0;let n=e.r(23359),i=e.r(79594),s=e.r(24361),a=e.r(59807),o=e.r(37294),l=e.r(73155),c=e.r(91200),u=e.r(37294),h=e.r(28835),d=e.r(4446),f=e.r(38644),p="dns_resolver";function m(e){c.trace(u.LogVerbosity.DEBUG,p,e)}r.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class S{constructor(e,t,n){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));const c=(0,h.splitHostPort)(e.path);null===c?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(c.host)||(0,d.isIPv6)(c.host)?(this.ipResult=[{host:c.host,port:null!=(i=c.port)?i:r.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=c.host,this.port=null!=(s=c.port)?s:r.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};const u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}r.setup=function(){(0,n.registerResolver)("dns",S),(0,n.registerDefaultScheme)("dns")}},52776,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProxiedConnection=r.mapProxyName=void 0;let n=e.r(91200),i=e.r(37294),s=e.r(23359),a=e.r(21517),o=e.r(55004),l=e.r(91200),c=e.r(46801),u=e.r(28835),h=e.r(92509),d=e.r(60702),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}r.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,u.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,u.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,u.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},r.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,u.parseUri)(h);if(null===f)return Promise.resolve({});let m=(0,u.splitHostPort)(f.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,c.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,c.subchannelAddressToString)(e);return p("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,c,h)=>{var d;if(l.removeAllListeners(),c.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(f),i=(0,u.splitHostPort)(n),a=null!=(d=null==i?void 0:i.host)?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:c},r),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:c,realTarget:f});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}},23754,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class i{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}r.StreamDecoder=i},56791,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelCall=void 0;let n=e.r(25328),i=e.r(46786),s=e.r(37294),a=e.r(73155),o=e.r(23754),l=e.r(91200),c=e.r(37294),u="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var c;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const u=null!=(c=i.getOptions()["grpc.max_receive_message_length"])?c:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(u),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(c.LogVerbosity.DEBUG,u,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}r.Http2SubchannelCall=d},62152,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCallNumber=void 0;let n=0;r.getNextCallNumber=function(){return n++}},36673,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelConnector=void 0;let n=e.r(25328),i=e.r(55004),s=e.r(1534),a=e.r(37294),o=e.r(52776),l=e.r(91200),c=e.r(23359),u=e.r(46801),h=e.r(28835),d=e.r(4446),f=e.r(56791),p=e.r(62152),m="transport",g="transport_flowctrl",y=e.r(17887).version,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:w,HTTP2_HEADER_TE:T,HTTP2_HEADER_USER_AGENT:C}=n.constants,E=2e4,_=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,u.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(_)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,u.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,u.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[C]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[w]=r,l[T]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,n,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class k{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,u.subchannelAddressToString)(e)));let g=(0,c.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(g))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,c.getDefaultAuthority)(null!=(n=(0,h.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}r.Http2SubchannelConnector=k},75971,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSubchannelPool=r.SubchannelPool=void 0;let n=e.r(87147),i=e.r(6312),s=e.r(46801),a=e.r(28835),o=e.r(36673),l=1e4;class c{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let c=(0,a.uriToString)(e);if(c in this.pool){for(let e of this.pool[c])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let u=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return c in this.pool||(this.pool[c]=[]),this.pool[c].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:u}),u.ref(),u}}r.SubchannelPool=c;let u=new c;r.getSubchannelPool=function(e){return e?u:new c}},31702,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FilterStackFactory=r.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}r.FilterStack=n;class i{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new i([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}r.FilterStackFactory=i},43138,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(r.CompressionAlgorithms=n={}))},74e3,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}r.BaseFilter=n},69355,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionFilterFactory=r.CompressionFilter=void 0;let n=e.r(6461),i=e.r(43138),s=e.r(37294),a=e.r(74e3),o=e.r(91200),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class c{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class u extends c{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends c{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new u;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new u,this.receiveCompression=new u,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){const e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new u,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof u)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}r.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}r.CompressionFilterFactory=g},24064,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deadlineToString=r.getRelativeTimeout=r.getDeadlineTimeoutString=r.minDeadline=void 0,r.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];r.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let i=0x7fffffff;r.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>i?1/0:t},r.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},14040,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.restrictControlPlaneStatusCode=void 0;let n=e.r(37294),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];r.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},27806,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoadBalancingCall=void 0;let n=e.r(95653),i=e.r(37294),s=e.r(24064),a=e.r(73155),o=e.r(87080),l=e.r(28835),c=e.r(91200),u=e.r(14040),h=e.r(25328),d="load_balancing_call";class f{constructor(e,t,r,n,i,s,a){var o,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const u=this.methodName.split("/");let h="";u.length>=2&&(h=u[1]);const d=null!=(c=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?c:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){c.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,c;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let u=this.metadata.clone();if(u.merge(e),u.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&u.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(u,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(c=r.onCallStarted)||c.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,u.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:c,details:d}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:c,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}r.LoadBalancingCall=f},45514,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingCall=void 0;let n=e.r(37294),i=e.r(24064),s=e.r(73155),a=e.r(91200),o=e.r(14040),l="resolving_call";class c{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}r.ResolvingCall=c},88622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryingCall=r.MessageBufferTracker=r.RetryThrottler=void 0;let n=e.r(37294),i=e.r(73155),s=e.r(91200),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}r.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}r.MessageBufferTracker=l;let c="grpc-previous-rpc-attempts";class u{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;"RETRY"!==this.state?t(!1):(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(c,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(c,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(c,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}r.RetryingCall=u},36927,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}r.BaseSubchannelWrapper=n},37158,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalChannel=void 0;let n=e.r(83106),i=e.r(61693),s=e.r(75971),a=e.r(87080),o=e.r(37294),l=e.r(31702),c=e.r(69355),u=e.r(23359),h=e.r(91200),d=e.r(52776),f=e.r(28835),p=e.r(95653),m=e.r(1534),g=e.r(27806),y=e.r(24064),v=e.r(45514),b=e.r(62152),S=e.r(14040),w=e.r(88622),T=e.r(36927),C=0x7fffffff,E=1e3,_=18e5,I=new Map,k=0x1000000,R=1048576;class A extends T.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class x{constructor(e,t,r){var g,y,v,b,T,x,D,O;if(this.credentials=t,this.options=r,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const N=(0,f.parseUri)(e);if(null===N)throw Error(`Could not parse target name "${e}"`);const P=(0,u.mapUriDefaultScheme)(N);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},C),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,u.getDefaultAuthority)(P);const M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new w.MessageBufferTracker(null!=(b=r["grpc.retry_buffer_size"])?b:k,null!=(T=r["grpc.per_rpc_retry_buffer_size"])?T:R),this.keepaliveTime=null!=(x=r["grpc.keepalive_time_ms"])?x:-1,this.idleTimeoutMs=Math.max(null!=(D=r["grpc.client_idle_timeout_ms"])?D:_,E);const L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new A(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new w.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,S.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new c.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(O=F.stack)?void 0:O.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new w.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}r.InternalChannel=x},75917,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelImplementation=void 0;let n=e.r(83106),i=e.r(37158);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}r.ChannelImplementation=s},17755,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2ServerCallStream=r.ServerDuplexStreamImpl=r.ServerWritableStreamImpl=r.ServerReadableStreamImpl=r.ServerUnaryCallImpl=void 0;let n=e.r(27699),i=e.r(25328),s=e.r(88947),a=e.r(6461),o=e.r(37294),l=e.r(73155),c=e.r(23754),u=e.r(91200),h=e.r(40646),d="server_call";function f(e){u.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},S={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},w={waitForTrailers:!0};class T extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerUnaryCallImpl=T;class C extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerReadableStreamImpl=C;class E extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerWritableStreamImpl=E;class _ extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerDuplexStreamImpl=_,_.prototype._read=C.prototype._read,_.prototype._write=E.prototype._write,_.prototype._final=E.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},S),b),t);this.stream.respond(r,w)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);u.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(k,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function c(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function u(l){if(n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);Buffer.isBuffer(f)?t(s.deserializeMessageWithInternalError(f)):f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[p]:encodeURI(e.details)},S),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new c.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function k(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}r.Http2ServerCallStream=I},1255,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerCredentials=void 0;let n=e.r(84049);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}r.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},2622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Server=void 0;let n=e.r(25328),i=e.r(37294),s=e.r(17755),a=e.r(1255),o=e.r(23359),l=e.r(91200),c=e.r(46801),u=e.r(28835),h=e.r(1534),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:d,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,c.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,c.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,u.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(f,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,c.subchannelAddressToString)(e)),r=(0,c.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,c.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,c.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)?p(Error(`No addresses resolved for port ${e}`),0):(s=(0,c.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),p(Error(r),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)w(e,t,i,s);else if("clientStream"===a)T(e,t,i,s);else if("serverStream"===a)C(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let c=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+c),this.sessionChildrenTracker.refChild(o));let u=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;u=null==(i=(r=setTimeout(()=>{var t,r;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+c);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let m=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+c),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+c),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),u&&clearTimeout(u),f&&clearTimeout(f),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function T(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function C(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}r.Server=S},75347,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}r.StatusBuilder=n},27005,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDuration=r.durationToMs=r.msToDuration=void 0,r.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},r.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},r.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},87591,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.OutlierDetectionLoadBalancer=r.OutlierDetectionLoadBalancingConfig=void 0;let i=e.r(95653),s=e.r(37294),a=e.r(27005),o=e.r(62746),l=e.r(24521),c=e.r(6279),u=e.r(87080),h=e.r(46801),d=e.r(36927),f=e.r(91200),p="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let g="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function w(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function T(e,t,r){let n=r?`${r}.${t}`:t;if(S(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class C{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new C(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(w(e,"interval"),w(e,"base_ejection_time"),w(e,"max_ejection_time"),T(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),T(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");T(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),T(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new C(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}r.OutlierDetectionLoadBalancingConfig=C;class E extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function _(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=_(),this.inactiveBucket=_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class k{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==u.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class R{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new c.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new E(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new k(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof C))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}r.OutlierDetectionLoadBalancer=R,r.setup=function(){y&&(0,o.registerLoadBalancerType)(g,R,C)}},62746,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OutlierDetectionLoadBalancingConfig=r.BaseSubchannelWrapper=r.registerAdminService=r.FilterStackFactory=r.BaseFilter=r.PickResultType=r.QueuePicker=r.UnavailablePicker=r.ChildLoadBalancerHandler=r.subchannelAddressToString=r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.registerLoadBalancerType=r.createChildChannelControlHelper=r.BackoffTimeout=r.durationToMs=r.uriToString=r.createResolver=r.registerResolver=r.log=r.trace=void 0;var n=e.r(91200);Object.defineProperty(r,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(r,"log",{enumerable:!0,get:function(){return n.log}});var i=e.r(23359);Object.defineProperty(r,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(r,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=e.r(28835);Object.defineProperty(r,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=e.r(27005);Object.defineProperty(r,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=e.r(38644);Object.defineProperty(r,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=e.r(24521);Object.defineProperty(r,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(r,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(r,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(r,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var c=e.r(46801);Object.defineProperty(r,"subchannelAddressToString",{enumerable:!0,get:function(){return c.subchannelAddressToString}});var u=e.r(6279);Object.defineProperty(r,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return u.ChildLoadBalancerHandler}});var h=e.r(87080);Object.defineProperty(r,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(r,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(r,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=e.r(74e3);Object.defineProperty(r,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=e.r(31702);Object.defineProperty(r,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=e.r(81800);Object.defineProperty(r,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var m=e.r(36927);Object.defineProperty(r,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=e.r(87591);Object.defineProperty(r,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},87988,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(23359);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}r.setup=function(){(0,n.registerResolver)("unix",i)}},22268,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(4446),i=e.r(37294),s=e.r(73155),a=e.r(23359),o=e.r(28835),l=e.r(91200),c="ip_resolver";function u(e){l.trace(i.LogVerbosity.DEBUG,c,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,u("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:f})}this.addresses=l,u("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}r.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},36980,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.PickFirstLoadBalancer=r.shuffled=r.PickFirstLoadBalancingConfig=void 0;let n=e.r(24521),i=e.r(95653),s=e.r(87080),a=e.r(91200),o=e.r(37294),l="pick_first";function c(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let u="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return u}toJsonObject(){return{[u]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}r.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}r.shuffled=p;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(c("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(c("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return u}}r.PickFirstLoadBalancer=m,r.setup=function(){(0,n.registerLoadBalancerType)(u,m,d),(0,n.registerDefaultLoadBalancerType)(u)}},43250,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.RoundRobinLoadBalancer=void 0;let n=e.r(24521),i=e.r(95653),s=e.r(87080),a=e.r(46801),o=e.r(91200),l=e.r(37294),c="round_robin";function u(e){o.trace(l.LogVerbosity.DEBUG,c,e)}let h="round_robin";class d{getLoadBalancerName(){return h}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),u("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}r.RoundRobinLoadBalancer=p,r.setup=function(){(0,n.registerLoadBalancerType)(h,p,d)}},48834,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.experimental=r.addAdminServicesToServer=r.getChannelzHandlers=r.getChannelzServiceDefinition=r.InterceptorConfigurationError=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.StatusBuilder=r.getClientChannel=r.ServerCredentials=r.Server=r.setLogVerbosity=r.setLogger=r.load=r.loadObject=r.CallCredentials=r.ChannelCredentials=r.waitForClientReady=r.closeClient=r.Channel=r.makeGenericClientConstructor=r.makeClientConstructor=r.loadPackageDefinition=r.Client=r.compressionAlgorithms=r.propagate=r.connectivityState=r.status=r.logVerbosity=r.Metadata=r.credentials=void 0;let n=e.r(31364);Object.defineProperty(r,"CallCredentials",{enumerable:!0,get:function(){return n.CallCredentials}});let i=e.r(75917);Object.defineProperty(r,"Channel",{enumerable:!0,get:function(){return i.ChannelImplementation}});let s=e.r(43138);Object.defineProperty(r,"compressionAlgorithms",{enumerable:!0,get:function(){return s.CompressionAlgorithms}});let a=e.r(95653);Object.defineProperty(r,"connectivityState",{enumerable:!0,get:function(){return a.ConnectivityState}});let o=e.r(83106);Object.defineProperty(r,"ChannelCredentials",{enumerable:!0,get:function(){return o.ChannelCredentials}});let l=e.r(4681);Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return l.Client}});let c=e.r(37294);Object.defineProperty(r,"logVerbosity",{enumerable:!0,get:function(){return c.LogVerbosity}}),Object.defineProperty(r,"status",{enumerable:!0,get:function(){return c.Status}}),Object.defineProperty(r,"propagate",{enumerable:!0,get:function(){return c.Propagate}});let u=e.r(91200),h=e.r(55779);Object.defineProperty(r,"loadPackageDefinition",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),Object.defineProperty(r,"makeClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}}),Object.defineProperty(r,"makeGenericClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}});let d=e.r(73155);Object.defineProperty(r,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});let f=e.r(2622);Object.defineProperty(r,"Server",{enumerable:!0,get:function(){return f.Server}});let p=e.r(1255);Object.defineProperty(r,"ServerCredentials",{enumerable:!0,get:function(){return p.ServerCredentials}});let m=e.r(75347);Object.defineProperty(r,"StatusBuilder",{enumerable:!0,get:function(){return m.StatusBuilder}}),r.credentials={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},r.closeClient=e=>e.close(),r.waitForClientReady=(e,t,r)=>e.waitForReady(t,r),r.loadObject=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.load=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.setLogger=e=>{u.setLogger(e)},r.setLogVerbosity=e=>{u.setLoggerVerbosity(e)},r.getClientChannel=e=>l.Client.prototype.getChannel.call(e);var g=e.r(89452);Object.defineProperty(r,"ListenerBuilder",{enumerable:!0,get:function(){return g.ListenerBuilder}}),Object.defineProperty(r,"RequesterBuilder",{enumerable:!0,get:function(){return g.RequesterBuilder}}),Object.defineProperty(r,"InterceptingCall",{enumerable:!0,get:function(){return g.InterceptingCall}}),Object.defineProperty(r,"InterceptorConfigurationError",{enumerable:!0,get:function(){return g.InterceptorConfigurationError}});var y=e.r(1534);Object.defineProperty(r,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return y.getChannelzServiceDefinition}}),Object.defineProperty(r,"getChannelzHandlers",{enumerable:!0,get:function(){return y.getChannelzHandlers}});var v=e.r(81800);Object.defineProperty(r,"addAdminServicesToServer",{enumerable:!0,get:function(){return v.addAdminServicesToServer}}),r.experimental=e.r(62746);let b=e.r(60702),S=e.r(87988),w=e.r(22268),T=e.r(36980),C=e.r(43250),E=e.r(87591),_=e.r(1534);(()=>{b.setup(),S.setup(),w.setup(),T.setup(),C.setup(),E.setup(),_.setup()})()},97407,e=>{"use strict";let t,r,n,i,s,a;var o,l,c,u,h,d=e.i(47909),f=e.i(74017),p=e.i(96250),m=e.i(59756),g=e.i(61916),y=e.i(74677),v=e.i(69741),b=e.i(16795),S=e.i(87718),w=e.i(95169),T=e.i(47587),C=e.i(66012),E=e.i(70101),_=e.i(74838),I=e.i(10372),k=e.i(93695);e.i(52474);var R=e.i(220),A=e.i(89171);let x=()=>void 0,D={NODE_CLIENT:!1},O=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},N=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},P={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=i>>2,u=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[c],r[u],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(O(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):N(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new M;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class M extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let L=function(e){let t=O(e);return P.encodeByteArray(t,!0)},F=function(e){return L(e).replace(/\./g,"")},B=function(e){try{return P.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function j(){return"u">typeof self?self:e.g}let U=()=>j().__FIREBASE_DEFAULTS__,V=()=>{if("u"<typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},q=()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&B(e[1]);return t&&JSON.parse(t)},z=()=>{try{return x()||U()||V()||q()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},$=e=>z()?.emulatorHosts?.[e],K=e=>{let t=$(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},H=()=>z()?.config;class G{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function W(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Q(e){return(await fetch(e,{credentials:"include"})).ok}function J(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[F(JSON.stringify(r)),F(JSON.stringify(a)),o].join(".")}function Y(e,t){}function X(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Z(){return!1}function ee(){let t=z()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function et(){return er()}function er(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function en(){return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function ei(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function es(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ea(){return!ee()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eo(){return!ee()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function el(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ec(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}function eu(){return!("u"<typeof navigator)&&!!navigator.cookieEnabled}let eh="FirebaseError";class ed extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eh,Object.setPrototypeOf(this,ed.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ef.prototype.create)}}class ef{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?ep(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new ed(n,a,r)}}function ep(e,t){return e.replace(em,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let em=/\{\$([^}]+)}/g;function eg(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(ey(r)&&ey(s)){if(!eg(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ey(e){return null!==e&&"object"==typeof e}function ev(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eb(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function eS(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function ew(e,t){let r=new eT(e,t);return r.subscribe.bind(r)}class eT{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=eC(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=eE),void 0===n.error&&(n.error=eE),void 0===n.complete&&(n.complete=eE);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eC(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function eE(){}let e_=1e3,eI=2,ek=144e5,eR=.5;function eA(e,t=e_,r=eI){let n=t*Math.pow(r,e),i=Math.round(eR*n*(Math.random()-.5)*2);return Math.min(ek,n+i)}function ex(e){return e&&e._delegate?e._delegate:e}D.NODE_CLIENT=!0;class eD{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eO="[DEFAULT]";class eN{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new G;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(eM(e))try{this.getOrInitializeService({instanceIdentifier:eO})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=eO){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eO){return this.instances.has(e)}getOptions(e=eO){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:eP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=eO){return this.component?this.component.multipleInstances?e:eO:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function eP(e){return e===eO?void 0:e}function eM(e){return"EAGER"===e.instantiationMode}class eL{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eN(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eF=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));let eB={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},ej=o.INFO,eU={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},eV=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=eU[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eq{constructor(e){this.name=e,this._logLevel=ej,this._logHandler=eV,this._userLogHandler=null,eF.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}function ez(e){eF.forEach(t=>{t.setLogLevel(e)})}function e$(e,t){for(let r of eF){let n=null;t&&t.level&&(n=eB[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:o[r].toLowerCase(),message:s,args:i,type:t.name})}}}let eK=(e,t)=>t.some(t=>e instanceof t);function eH(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eG(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eW=new WeakMap,eQ=new WeakMap,eJ=new WeakMap,eY=new WeakMap,eX=new WeakMap;function eZ(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(e4(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eW.set(t,e)}).catch(()=>{}),eX.set(t,e),t}function e0(e){if(eQ.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eQ.set(e,t)}let e1={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eQ.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eJ.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return e4(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e2(e){e1=e(e1)}function e3(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?eG().includes(e)?function(...t){return e.apply(e5(this),t),e4(eW.get(this))}:function(...t){return e4(e.apply(e5(this),t))}:function(t,...r){let n=e.call(e5(this),t,...r);return eJ.set(n,t.sort?t.sort():[t]),e4(n)}}function e6(e){return"function"==typeof e?e3(e):(e instanceof IDBTransaction&&e0(e),eK(e,eH()))?new Proxy(e,e1):e}function e4(e){if(e instanceof IDBRequest)return eZ(e);if(eY.has(e))return eY.get(e);let t=e6(e);return t!==e&&(eY.set(e,t),eX.set(t,e)),t}let e5=e=>eX.get(e);function e8(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=e4(a);return n&&a.addEventListener("upgradeneeded",e=>{n(e4(a.result),e.oldVersion,e.newVersion,e4(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let e7=["get","getKey","getAll","getAllKeys","count"],e9=["put","add","delete","clear"],te=new Map;function tt(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(te.get(t))return te.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=e9.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||e7.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return te.set(t,s),s}e2(e=>({...e,get:(t,r,n)=>tt(t,r)||e.get(t,r,n),has:(t,r)=>!!tt(t,r)||e.has(t,r)}));class tr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!tn(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function tn(e){let t=e.getComponent();return t?.type==="VERSION"}let ti="@firebase/app",ts="0.14.7",ta=new eq("@firebase/app"),to="12.8.0",tl="[DEFAULT]",tc={[ti]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tu=new Map,th=new Map,td=new Map;function tf(e,t){try{e.container.addComponent(t)}catch(r){ta.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function tp(e,t){e.container.addOrOverwriteComponent(t)}function tm(e){let t=e.name;if(td.has(t))return ta.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(td.set(t,e),tu.values()))tf(r,e);for(let t of th.values())tf(t,e);return!0}function tg(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function ty(e,t,r=tl){tg(e,t).clearInstance(r)}function tv(e){return void 0!==e.options}function tb(e){return!tv(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tS(e){return null!=e&&void 0!==e.settings}function tw(){td.clear()}let tT=new ef("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tC{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new eD("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tT.create("app-deleted",{appName:this._name})}}function tE(e,t){let r=B(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class t_ extends tC{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&tE(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tE(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tO(ti,ts,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tD(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tT.create("server-app-deleted")}}let tI=to;function tk(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:tl,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw tT.create("bad-app-name",{appName:String(i)});if(r||(r=H()),!r)throw tT.create("no-options");let s=tu.get(i);if(s)if(eg(r,s.options)&&eg(n,s.config))return s;else throw tT.create("duplicate-app",{appName:i});let a=new eL(i);for(let e of td.values())a.addComponent(e);let o=new tC(r,n,a);return tu.set(i,o),o}function tR(e,t={}){let r;if(et()&&!er())throw tT.create("invalid-server-app-environment");let n=t||{};if(e&&(tv(e)?r=e.options:tb(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=H()),!r)throw tT.create("no-options");let i={...n,...r};void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;let s=e=>[...e].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0);if(void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw tT.create("finalization-registry-not-supported",{});let a=""+s(JSON.stringify(i)),o=th.get(a);if(o)return o.incRefCount(n.releaseOnDeref),o;let l=new eL(a);for(let e of td.values())l.addComponent(e);let c=new t_(r,n,a,l);return th.set(a,c),c}function tA(e=tl){let t=tu.get(e);if(!t&&e===tl&&H())return tk();if(!t)throw tT.create("no-app",{appName:e});return t}function tx(){return Array.from(tu.values())}async function tD(e){let t=!1,r=e.name;tu.has(r)?(t=!0,tu.delete(r)):th.has(r)&&0>=e.decRefCount()&&(th.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tO(e,t,r){let n=tc[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ta.warn(e.join(" "));return}tm(new eD(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tN(e,t){if(null!==e&&"function"!=typeof e)throw tT.create("invalid-log-argument");e$(e,t)}function tP(e){ez(e)}let tM="firebase-heartbeat-database",tL=1,tF="firebase-heartbeat-store",tB=null;function tj(){return tB||(tB=e8(tM,tL,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tF)}catch(e){console.warn(e)}}}).catch(e=>{throw tT.create("idb-open",{originalErrorMessage:e.message})})),tB}async function tU(e){try{let t=(await tj()).transaction(tF),r=await t.objectStore(tF).get(tq(e));return await t.done,r}catch(e){if(e instanceof ed)ta.warn(e.message);else{let t=tT.create("idb-get",{originalErrorMessage:e?.message});ta.warn(t.message)}}}async function tV(e,t){try{let r=(await tj()).transaction(tF,"readwrite"),n=r.objectStore(tF);await n.put(t,tq(e)),await r.done}catch(e){if(e instanceof ed)ta.warn(e.message);else{let t=tT.create("idb-set",{originalErrorMessage:e?.message});ta.warn(t.message)}}}function tq(e){return`${e.name}!${e.options.appId}`}let tz=1024,t$=30;class tK{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tW(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tH();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>t$){let e=tJ(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ta.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tH(),{heartbeatsToSend:t,unsentEntries:r}=tG(this._heartbeatsCache.heartbeats),n=F(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return ta.warn(e),""}}}function tH(){return new Date().toISOString().substring(0,10)}function tG(e,t=tz){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tQ(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tQ(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class tW{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!el()&&ec().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tU(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tV(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tV(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tQ(e){return F(JSON.stringify({version:2,heartbeats:e})).length}function tJ(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){tm(new eD("platform-logger",e=>new tr(e),"PRIVATE")),tm(new eD("heartbeat",e=>new tK(e),"PRIVATE")),tO(ti,ts,""),tO(ti,ts,"esm2020"),tO("fire-js","")})(""),e.s(["SDK_VERSION",()=>tI,"_DEFAULT_ENTRY_NAME",()=>tl,"_addComponent",()=>tf,"_addOrOverwriteComponent",()=>tp,"_apps",()=>tu,"_clearComponents",()=>tw,"_components",()=>td,"_getProvider",()=>tg,"_isFirebaseApp",()=>tv,"_isFirebaseServerApp",()=>tS,"_isFirebaseServerAppSettings",()=>tb,"_registerComponent",()=>tm,"_removeServiceInstance",()=>ty,"_serverApps",()=>th,"deleteApp",()=>tD,"getApp",()=>tA,"getApps",()=>tx,"initializeApp",()=>tk,"initializeServerApp",()=>tR,"onLog",()=>tN,"registerVersion",()=>tO,"setLogLevel",()=>tP],15710),tO("firebase","12.8.0","app"),e.i(15710);var tY="u">typeof globalThis?globalThis:e.g,tX={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&e<128?r(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return g(o(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new n(t,0)}function u(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return g(u(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=o(Math.pow(t,8)),n=h;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=o(Math.pow(t,i)),n=n.j(i).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var h=a(0),d=a(1),f=a(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function b(e,t){this.g=e,this.h=t}function S(e,t){if(p(t))throw Error("division by zero");if(p(e))return new b(h,h);if(m(e))return t=S(g(e),t),new b(g(t.g),g(t.h));if(m(t))return t=S(e,g(t)),new b(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=w(r),n=w(n);var i=T(r,1),s=T(n,1);for(n=T(n,2),r=T(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=T(n,1),r=T(r,1)}return t=y(e,i.j(t)),new b(i,t)}for(i=h;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=o(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(s=o(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new b(i,e)}function w(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function T(e,t){let r=t>>5;t%=32;let i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=o(Math.pow(e,6));var r=this;let n="";for(;;){let i=S(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return m(e=y(this,e))?-1:+!p(e)},i.abs=function(){return m(this)?g(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(p(this)||p(e))return h;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return o(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let n=this.i(i)>>>16,s=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);r[2*i+2*t]+=s*o,v(r,2*i+2*t),r[2*i+2*t+1]+=n*o,v(r,2*i+2*t+1),r[2*i+2*t+1]+=s*a,v(r,2*i+2*t+1),r[2*i+2*t+2]+=n*a,v(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return S(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,c=tX.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=u,l=tX.Integer=n}).apply(void 0!==tY?tY:"u">typeof self?self:{});var tZ=e.i(24361),t0=e.i(54799),t1=e.i(48834),t2=e.i(45262);class t3{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}t3.UNAUTHENTICATED=new t3(null),t3.GOOGLE_CREDENTIALS=new t3("google-credentials-uid"),t3.FIRST_PARTY=new t3("first-party-uid"),t3.MOCK_USER=new t3("mock-user");let t6="12.8.0";function t4(e){t6=e}function t5(e){return(0,tZ.inspect)(e,{depth:100})}let t8=new eq("@firebase/firestore");function t7(){return t8.logLevel}function t9(e,...t){if(t8.logLevel<=o.DEBUG){let r=t.map(rr);t8.debug(`Firestore (${t6}): ${e}`,...r)}}function re(e,...t){if(t8.logLevel<=o.ERROR){let r=t.map(rr);t8.error(`Firestore (${t6}): ${e}`,...r)}}function rt(e,...t){if(t8.logLevel<=o.WARN){let r=t.map(rr);t8.warn(`Firestore (${t6}): ${e}`,...r)}}function rr(e){if("string"==typeof e)return e;try{return t5(e)}catch(t){return e}}function rn(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,ri(e,n,r)}function ri(e,t,r){let n=`FIRESTORE (${t6}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw re(n),Error(n)}function rs(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||ri(t,i,n)}function ra(e,t){return e}let ro="ok",rl="cancelled",rc="unknown",ru="invalid-argument",rh="deadline-exceeded",rd="not-found",rf="already-exists",rp="permission-denied",rm="unauthenticated",rg="resource-exhausted",ry="failed-precondition",rv="aborted",rb="out-of-range",rS="unimplemented",rw="internal",rT="unavailable",rC="data-loss";class rE extends ed{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class r_{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(t3.UNAUTHENTICATED))}shutdown(){}}class rR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rA{constructor(e){this.authProvider=e,this.currentUser=t3.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){rs(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new r_;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new r_,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{t9("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(t9("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new r_)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(t9("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rs("string"==typeof t.accessToken,31837,{tokenData:t}),new rI(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return rs(null===e||"string"==typeof e,2055,{currentUid:e}),new t3(e)}}class rx{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=t3.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rD{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new rx(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(t3.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rN{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tS(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){rs(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&t9("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,t9("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{t9("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):t9("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new rO(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(rs("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new rO(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function rP(e){if(!e)return new rk;switch(e.type){case"firstParty":return new rD(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rE(ru,"makeAuthCredentialsProvider failed due to invalid credential type")}}function rM(e){return(0,t0.randomBytes)(e)}class rL{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=rM(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function rF(e,t){return e<t?-1:+(e>t)}function rB(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return rV(r)===rV(i)?rF(r,i):rV(r)?1:-1}return rF(e.length,t.length)}let rj=55296,rU=57343;function rV(e){let t=e.charCodeAt(0);return t>=rj&&t<=rU}function rq(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function rz(e){return e+"\0"}let r$="__name__";class rK{constructor(e,t,r){void 0===t?t=0:t>e.length&&rn(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&rn(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===rK.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rK?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=rK.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return rF(e.length,t.length)}static compareSegments(e,t){let r=rK.isNumericId(e),n=rK.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?rK.extractNumericId(e).compare(rK.extractNumericId(t)):rB(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return l.fromString(e.substring(4,e.length-2))}}class rH extends rK{construct(e,t,r){return new rH(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new rE(ru,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new rH(t)}static emptyPath(){return new rH([])}}let rG=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rW extends rK{construct(e,t,r){return new rW(e,t,r)}static isValidIdentifier(e){return rG.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rW.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===r$}static keyField(){return new rW([r$])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new rE(ru,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new rE(ru,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rE(ru,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new rE(ru,"Unterminated ` in path: "+e);return new rW(t)}static emptyPath(){return new rW([])}}class rQ{constructor(e){this.path=e}static fromPath(e){return new rQ(rH.fromString(e))}static fromName(e){return new rQ(rH.fromString(e).popFirst(5))}static empty(){return new rQ(rH.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rH.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rH.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rQ(new rH(e.slice()))}}function rJ(e,t,r){if(!r)throw new rE(ru,`Function ${e}() cannot be called with an empty ${t}.`)}function rY(e,t,r,n){if(!0===t&&!0===n)throw new rE(ru,`${e} and ${r} cannot be used together.`)}function rX(e){if(!rQ.isDocumentKey(e))throw new rE(ru,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rZ(e){if(rQ.isDocumentKey(e))throw new rE(ru,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function r0(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function r1(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=r2(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return rn(12329,{type:typeof e})}function r2(e){return e.constructor?e.constructor.name:null}function r3(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new rE(ru,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=r1(e);throw new rE(ru,`Expected type '${t.name}', but it was: ${r}`)}return e}function r6(e,t){if(t<=0)throw new rE(ru,`Function ${e}() requires a positive number, but it was: ${t}.`)}function r4(e,t){let r={typeString:e};return t&&(r.value=t),r}function r5(e,t){let r;if(!r0(e))throw new rE(ru,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new rE(ru,r);return!0}let r8=-0xe7791f700,r7=1e6;class r9{static now(){return r9.fromMillis(Date.now())}static fromDate(e){return r9.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*r7);return new r9(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rE(ru,"Timestamp nanoseconds out of range: "+t);if(e<r8||e>=0x3afff44180)throw new rE(ru,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/r7}_compareTo(e){return this.seconds===e.seconds?rF(this.nanoseconds,e.nanoseconds):rF(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r9._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(r5(e,r9._jsonSchema))return new r9(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-r8).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}r9._jsonSchemaVersion="firestore/timestamp/1.0",r9._jsonSchema={type:r4("string",r9._jsonSchemaVersion),seconds:r4("number"),nanoseconds:r4("number")};class ne{static fromTimestamp(e){return new ne(e)}static min(){return new ne(new r9(0,0))}static max(){return new ne(new r9(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let nt=-1,nr=0;class nn{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function ni(e){return e.fields.find(e=>2===e.kind)}function ns(e){return e.fields.filter(e=>2!==e.kind)}function na(e){let t=ns(e);return 0===t.length?0:t[t.length-1].kind}function no(e,t){let r=rF(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=nu(e.fields[n],t.fields[n])))return r;return rF(e.fields.length,t.fields.length)}function nl(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}nn.UNKNOWN_ID=-1;class nc{constructor(e,t){this.fieldPath=e,this.kind=t}}function nu(e,t){let r=rW.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:rF(e.kind,t.kind)}class nh{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new nh(nr,np.min())}}function nd(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new np(ne.fromTimestamp(1e9===n?new r9(r+1,0):new r9(r,n)),rQ.empty(),t)}function nf(e){return new np(e.readTime,e.key,nt)}class np{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new np(ne.min(),rQ.empty(),nt)}static max(){return new np(ne.max(),rQ.empty(),nt)}}function nm(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=rQ.comparator(e.documentKey,t.documentKey))?r:rF(e.largestBatchId,t.largestBatchId)}let ng="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ny{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nv(e){if(e.code===ry&&e.message===ng)t9("LocalStore","Unexpectedly lost primary lease");else throw e}class nb{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&rn(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nb((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof nb)return t;return nb.resolve(t)}catch(e){return nb.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nb.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nb.reject(t)}static resolve(e){return new nb((t,r)=>{t(e)})}static reject(e){return new nb((t,r)=>{r(e)})}static waitFor(e){return new nb((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=nb.resolve(!1);for(let r of e)t=t.next(e=>e?nb.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new nb((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new nb((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let nS="SimpleDb",nw=3;class nT{static open(e,t,r,n){try{return new nT(t,e.transaction(n,r))}catch(e){throw new nI(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new r_,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new nI(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=nD(t.target.error);this.completionDeferred.reject(new nI(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(t9(nS,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new nR(this.transaction.objectStore(e))}}class nC{static delete(e){return t9(nS,"Removing database:",e),nA(j().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!el())return!1;if(nC.isMockPersistence())return!0;let e=X(),t=nC.getIOSVersion(e),r=0<t&&t<10,n=nE(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===nC.getIOSVersion(X())&&re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(t9(nS,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new nI(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new rE(ry,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new rE(ry,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new nI(e,n))},n.onupgradeneeded=e=>{t9(nS,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{t9(nS,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=nT.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),nb.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<nw;if(t9(nS,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function nE(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class n_{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return nA(this.dbCursor.delete())}}class nI extends rE{constructor(e,t){super(rT,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nk(e){return"IndexedDbTransactionError"===e.name}class nR{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(t9(nS,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(t9(nS,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),nA(r)}add(e){return t9(nS,"ADD",this.store.name,e,e),nA(this.store.add(e))}get(e){return nA(this.store.get(e)).next(t=>(void 0===t&&(t=null),t9(nS,"GET",this.store.name,e,t),t))}delete(e){return t9(nS,"DELETE",this.store.name,e),nA(this.store.delete(e))}count(){return t9(nS,"COUNT",this.store.name),nA(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new nb((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new nb((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){t9(nS,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new nb((r,n)=>{t.onerror=e=>{n(nD(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}iterateCursor(e,t){let r=[];return new nb((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new n_(i),a=t(i.primaryKey,i.value,s);if(a instanceof nb){let e=a.catch(e=>(s.done(),nb.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>nb.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function nA(e){return new nb((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(nD(e.target.error))}})}let nx=!1;function nD(e){let t=nC.getIOSVersion(X());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rE("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nx||(nx=!0,setTimeout(()=>{throw e},0)),e}}return e}let nO="IndexBackfiller",nN=15e3,nP=6e4,nM=50;class nL{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(nN)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){t9(nO,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();t9(nO,`Documents written: ${e}`)}catch(e){nk(e)?t9(nO,"Ignoring IndexedDB error during index backfill: ",e):await nv(e)}await this.schedule(nP)})}}class nF{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=nM){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return nb.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return t9(nO,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(t9(nO,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=nf(t);nm(n,r)>0&&(r=n)}),new np(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class nB{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}nB.INVALID=-1;let nj="\x01",nU="\x01",nV="\x10",nq="\x11";function nz(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=nK(t)),t=n$(e.get(r),t);return nK(t)}function n$(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=nj+nV;break;case nj:r+=nj+nq;break;default:r+=n}}return r}function nK(e){return e+nj+nU}function nH(e){let t=e.length;if(rs(t>=2,64408,{path:e}),2===t)return rs(e.charAt(0)===nj&&e.charAt(1)===nU,56145,{path:e}),rH.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(nj,s);switch((t<0||t>r)&&rn(50515,{path:e}),e.charAt(t+1)){case nU:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case nV:i+=e.substring(s,t),i+="\0";break;case nq:i+=e.substring(s,t+1);break;default:rn(61167,{path:e})}s=t+2}return new rH(n)}let nG="remoteDocuments",nW="owner",nQ="owner",nJ="mutationQueues",nY="userId",nX="mutations",nZ="batchId",n0="userMutationsIndex",n1=["userId","batchId"];function n2(e){return[e]}function n3(e,t){return[e,nz(t)]}function n6(e,t,r){return[e,nz(t),r]}let n4={},n5="documentMutations",n8="remoteDocumentsV14",n7=["prefixPath","collectionGroup","readTime","documentId"],n9="documentKeyIndex",ie=["prefixPath","collectionGroup","documentId"],it="collectionGroupIndex",ir=["collectionGroup","readTime","prefixPath","documentId"],ii="remoteDocumentGlobal",is="remoteDocumentGlobalKey",ia="targets",io="targetId",il="queryTargetsIndex",ic=["canonicalId","targetId"],iu="targetDocuments",ih=["targetId","path"],id="documentTargetsIndex",ip=["path","targetId"],im="targetGlobalKey",ig="targetGlobal",iy="collectionParents",iv=["collectionId","parent"],ib="clientMetadata",iS="clientId",iw="bundles",iT="bundleId",iC="namedQueries",iE="name",i_="indexConfiguration",iI="indexId",ik="collectionGroupIndex",iR="collectionGroup",iA="indexState",ix=["indexId","uid"],iD="sequenceNumberIndex",iO=["uid","sequenceNumber"],iN="indexEntries",iP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iM="documentKeyIndex",iL=["indexId","uid","orderedDocumentKey"],iF="documentOverlays",iB=["userId","collectionPath","documentId"],ij="collectionPathOverlayIndex",iU=["userId","collectionPath","largestBatchId"],iV="collectionGroupOverlayIndex",iq=["userId","collectionGroup","largestBatchId"],iz="globals",i$="name",iK=[nJ,nX,n5,nG,ia,nW,ig,iu,ib,ii,iy,iw,iC],iH=[...iK,iF],iG=[nJ,nX,n5,n8,ia,nW,ig,iu,ib,ii,iy,iw,iC,iF],iW=iG,iQ=[...iW,i_,iA,iN],iJ=iQ,iY=[...iQ,iz],iX=iY;function iZ(e){return 18===e?iX:17===e?iY:16===e?iJ:15===e?iQ:14===e?iW:13===e?iG:12===e?iH:11===e?iK:void rn(60245)}class i0 extends ny{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function i1(e,t){let r=ra(e);return nC.getStore(r.simpleDbTransaction,t)}function i2(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function i3(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function i6(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function i4(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class i5{constructor(e,t){this.comparator=e,this.root=t||i7.EMPTY}insert(e,t){return new i5(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,i7.BLACK,null,null))}remove(e){return new i5(this.comparator,this.root.remove(e,this.comparator).copy(null,null,i7.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new i8(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new i8(this.root,e,this.comparator,!1)}getReverseIterator(){return new i8(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new i8(this.root,e,this.comparator,!0)}}class i8{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class i7{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:i7.RED,this.left=null!=n?n:i7.EMPTY,this.right=null!=i?i:i7.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new i7(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return i7.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return i7.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i7.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i7.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rn(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw rn(27949)}}i7.EMPTY=null,i7.RED=!0,i7.BLACK=!1;class i9{constructor(){this.size=0}get key(){throw rn(57766)}get value(){throw rn(16141)}get color(){throw rn(16727)}get left(){throw rn(29726)}get right(){throw rn(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new i7(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}i7.EMPTY=new i9;class se{constructor(e){this.comparator=e,this.data=new i5(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new st(this.data.getIterator())}getIteratorFrom(e){return new st(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof se)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new se(this.comparator);return t.data=e,t}}class st{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sr(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sn(s),l=sn(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sn(a)):t?(i(o),o=sn(s)):(o=sn(s),l=sn(a))}}function sn(e){return e.hasNext()?e.getNext():void 0}class si{constructor(e){this.fields=e,e.sort(rW.comparator)}static empty(){return new si([])}unionWith(e){let t=new se(rW.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new si(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rq(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function ss(e){return Buffer.from(e,"base64").toString("binary")}function sa(e){return Buffer.from(e,"binary").toString("base64")}class so{constructor(e){this.binaryString=e}static fromBase64String(e){return new so(ss(e))}static fromUint8Array(e){return new so(sl(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return sa(this.binaryString)}toUint8Array(){return sc(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rF(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function sl(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function sc(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}so.EMPTY_BYTE_STRING=new so("");let su=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sh(e){if(rs(!!e,39018),"string"==typeof e){let t=0,r=su.exec(e);if(rs(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sd(e.seconds),nanos:sd(e.nanos)}}function sd(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sf(e){return"string"==typeof e?so.fromBase64String(e):so.fromUint8Array(e)}let sp="server_timestamp",sm="__type__",sg="__previous_value__",sy="__local_write_time__";function sv(e){return(e?.mapValue?.fields||{})[sm]?.stringValue===sp}function sb(e,t){let r={fields:{[sm]:{stringValue:sp},[sy]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&sv(t)&&(t=sS(t)),t&&(r.fields[sg]=t),{mapValue:r}}function sS(e){let t=e.mapValue.fields[sg];return sv(t)?sS(t):t}function sw(e){let t=sh(e.mapValue.fields[sy].timestampValue);return new r9(t.seconds,t.nanos)}class sT{constructor(e,t,r,n,i,s,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c,this.apiKey=u}}let sC="(default)";class sE{constructor(e,t){this.projectId=e,this.database=t||sC}static empty(){return new sE("","")}get isDefaultDatabase(){return this.database===sC}isEqual(e){return e instanceof sE&&e.projectId===this.projectId&&e.database===this.database}}function s_(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rE(ru,'"projectId" not provided in firebase.initializeApp.');return new sE(e.options.projectId,t)}let sI=-1;function sk(e){return null==e}function sR(e){return 0===e&&1/e==-1/0}function sA(e){return"number"==typeof e&&Number.isInteger(e)&&!sR(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let sx="__type__",sD="__max__",sO={mapValue:{fields:{__type__:{stringValue:sD}}}},sN="__vector__",sP="value",sM={nullValue:"NULL_VALUE"};function sL(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sv(e)?4:au(e)?0x1fffffffffffff:al(e)?10:11:rn(28295,{value:e})}function sF(e,t){if(e===t)return!0;let r=sL(e);if(r!==sL(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sw(e).isEqual(sw(t));case 3:return sB(e,t);case 5:return e.stringValue===t.stringValue;case 6:return sU(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return sj(e,t);case 2:return sV(e,t);case 9:return rq(e.arrayValue.values||[],t.arrayValue.values||[],sF);case 10:case 11:return sq(e,t);default:return rn(52216,{left:e})}}function sB(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sh(e.timestampValue),n=sh(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function sj(e,t){return sd(e.geoPointValue.latitude)===sd(t.geoPointValue.latitude)&&sd(e.geoPointValue.longitude)===sd(t.geoPointValue.longitude)}function sU(e,t){return sf(e.bytesValue).isEqual(sf(t.bytesValue))}function sV(e,t){if("integerValue"in e&&"integerValue"in t)return sd(e.integerValue)===sd(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sd(e.doubleValue),n=sd(t.doubleValue);return r===n?sR(r)===sR(n):isNaN(r)&&isNaN(n)}return!1}function sq(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(i2(r)!==i2(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!sF(r[e],n[e])))return!1;return!0}function sz(e,t){return void 0!==(e.values||[]).find(e=>sF(e,t))}function s$(e,t){if(e===t)return 0;let r=sL(e),n=sL(t);if(r!==n)return rF(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return rF(e.booleanValue,t.booleanValue);case 2:return sK(e,t);case 3:return sH(e.timestampValue,t.timestampValue);case 4:return sH(sw(e),sw(t));case 5:return rB(e.stringValue,t.stringValue);case 6:return sQ(e.bytesValue,t.bytesValue);case 7:return sG(e.referenceValue,t.referenceValue);case 8:return sW(e.geoPointValue,t.geoPointValue);case 9:return sJ(e.arrayValue,t.arrayValue);case 10:return sY(e.mapValue,t.mapValue);case 11:return sX(e.mapValue,t.mapValue);default:throw rn(23264,{leftType:r})}}function sK(e,t){let r=sd(e.integerValue||e.doubleValue),n=sd(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function sH(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rF(e,t);let r=sh(e),n=sh(t),i=rF(r.seconds,n.seconds);return 0!==i?i:rF(r.nanos,n.nanos)}function sG(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=rF(r[e],n[e]);if(0!==t)return t}return rF(r.length,n.length)}function sW(e,t){let r=rF(sd(e.latitude),sd(t.latitude));return 0!==r?r:rF(sd(e.longitude),sd(t.longitude))}function sQ(e,t){let r=sf(e),n=sf(t);return r.compareTo(n)}function sJ(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=s$(r[e],n[e]);if(t)return t}return rF(r.length,n.length)}function sY(e,t){let r=e.fields||{},n=t.fields||{},i=r[sP]?.arrayValue,s=n[sP]?.arrayValue,a=rF(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:sJ(i,s)}function sX(e,t){if(e===sO.mapValue&&t===sO.mapValue)return 0;if(e===sO.mapValue)return 1;if(t===sO.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=rB(n[e],s[e]);if(0!==t)return t;let a=s$(r[n[e]],i[s[e]]);if(0!==a)return a}return rF(n.length,s.length)}function sZ(e){return s0(e)}function s0(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return s2(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return s1(e.bytesValue);else if("referenceValue"in e)return s6(e.referenceValue);else if("geoPointValue"in e)return s3(e.geoPointValue);else if("arrayValue"in e)return s5(e.arrayValue);else if("mapValue"in e)return s4(e.mapValue);else return rn(61005,{value:e})}function s1(e){return sf(e).toBase64()}function s2(e){let t=sh(e);return`time(${t.seconds},${t.nanos})`}function s3(e){return`geo(${e.latitude},${e.longitude})`}function s6(e){return rQ.fromName(e).toString()}function s4(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${s0(e.fields[i])}`;return r+"}"}function s5(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=s0(n);return t+"]"}function s8(e){switch(sL(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=sS(e);return t?16+s8(t):16;case 5:return 2*e.stringValue.length;case 6:return sf(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return s9(e.arrayValue);case 10:case 11:return s7(e.mapValue);default:throw rn(13486,{value:e})}}function s7(e){let t=0;return i3(e.fields,(e,r)=>{t+=e.length+s8(r)}),t}function s9(e){return(e.values||[]).reduce((e,t)=>e+s8(t),0)}function ae(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function at(e){return!!e&&"integerValue"in e}function ar(e){return!!e&&"doubleValue"in e}function an(e){return at(e)||ar(e)}function ai(e){return!!e&&"arrayValue"in e}function as(e){return!!e&&"nullValue"in e}function aa(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ao(e){return!!e&&"mapValue"in e}function al(e){return(e?.mapValue?.fields||{})[sx]?.stringValue===sN}function ac(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return i3(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ac(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=ac(e.arrayValue.values[r]);return t}}function au(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sD}let ah={mapValue:{fields:{[sx]:{stringValue:sN},[sP]:{arrayValue:{}}}}};function ad(e){if("nullValue"in e)return sM;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return ae(sE.empty(),rQ.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return rn(35942,{value:e});else return al(e)?ah:{mapValue:{}}}function af(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return ae(sE.empty(),rQ.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return ah;else if(!("mapValue"in e))return rn(61959,{value:e});else return al(e)?{mapValue:{}}:sO}function ap(e,t){let r=s$(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function am(e,t){let r=s$(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ag{constructor(e){this.value=e}static empty(){return new ag({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!ao(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ac(t)}setAll(e){let t=rW.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=ac(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());ao(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sF(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];ao(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(i3(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new ag(ac(this.value))}}function ay(e){let t=[];return i3(e.fields,(e,r)=>{let n=new rW([e]);if(ao(r)){let e=ay(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new si(t)}class av{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new av(e,0,ne.min(),ne.min(),ne.min(),ag.empty(),0)}static newFoundDocument(e,t,r,n){return new av(e,1,t,ne.min(),r,n,0)}static newNoDocument(e,t){return new av(e,2,t,ne.min(),ne.min(),ag.empty(),0)}static newUnknownDocument(e,t){return new av(e,3,t,ne.min(),ne.min(),ag.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ne.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ag.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ag.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ne.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof av&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new av(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function ab(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?s$(n,i):rn(42886)}class aS{constructor(e,t){this.position=e,this.inclusive=t}}function aw(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?rQ.comparator(rQ.fromName(a.referenceValue),r.key):s$(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function aT(e,t,r){let n=aw(e,t,r);return e.inclusive?n>=0:n>0}function aC(e,t,r){let n=aw(e,t,r);return e.inclusive?n<=0:n<0}function aE(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sF(e.position[r],t.position[r]))return!1;return!0}class a_{constructor(e,t="asc"){this.field=e,this.dir=t}}function aI(e){return e.field.canonicalString()+e.dir}function ak(e){return`${e.field.canonicalString()} (${e.dir})`}function aR(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class aA{}class ax extends aA{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new a$(e,t,r);if("array-contains"===t)return new aW(e,r);if("in"===t)return new aQ(e,r);if("not-in"===t)return new aJ(e,r);if("array-contains-any"===t)return new aY(e,r);else return new ax(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new aK(e,r):new aH(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(s$(t,this.value)):null!==t&&sL(this.value)===sL(t)&&this.matchesComparison(s$(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class aD extends aA{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new aD(e,t)}matches(e){return aO(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function aO(e){return"and"===e.op}function aN(e){return"or"===e.op}function aP(e){return aM(e)&&aO(e)}function aM(e){for(let t of e.filters)if(t instanceof aD)return!1;return!0}function aL(e){if(e instanceof ax)return e.field.canonicalString()+e.op.toString()+sZ(e.value);{if(aP(e))return e.filters.map(e=>aL(e)).join(",");let t=e.filters.map(e=>aL(e)).join(",");return`${e.op}(${t})`}}function aF(e,t){return e instanceof ax?aB(e,t):e instanceof aD?aj(e,t):void rn(19439)}function aB(e,t){return t instanceof ax&&e.op===t.op&&e.field.isEqual(t.field)&&sF(e.value,t.value)}function aj(e,t){return t instanceof aD&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&aF(r,t.filters[n]),!0)}function aU(e,t){let r=e.filters.concat(t);return aD.create(r,e.op)}function aV(e){return e instanceof ax?az(e):e instanceof aD?aq(e):"Filter"}function aq(e){return e.op.toString()+" {"+e.getFilters().map(aV).join(" ,")+"}"}function az(e){return`${e.field.canonicalString()} ${e.op} ${sZ(e.value)}`}class a$ extends ax{constructor(e,t,r){super(e,t,r),this.key=rQ.fromName(r.referenceValue)}matches(e){let t=rQ.comparator(e.key,this.key);return this.matchesComparison(t)}}class aK extends ax{constructor(e,t){super(e,"in",t),this.keys=aG("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aH extends ax{constructor(e,t){super(e,"not-in",t),this.keys=aG("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aG(e,t){return(t.arrayValue?.values||[]).map(e=>rQ.fromName(e.referenceValue))}class aW extends ax{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ai(t)&&sz(t.arrayValue,this.value)}}class aQ extends ax{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sz(this.value.arrayValue,t)}}class aJ extends ax{constructor(e,t){super(e,"not-in",t)}matches(e){if(sz(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sz(this.value.arrayValue,t)}}class aY extends ax{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!ai(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>sz(this.value.arrayValue,e))}}class aX{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function aZ(e,t=null,r=[],n=[],i=null,s=null,a=null){return new aX(e,t,r,n,i,s,a)}function a0(e){let t=ra(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>aL(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>aI(e)).join(","),sk(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>sZ(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>sZ(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function a1(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>aV(e)).join(", ")}]`),sk(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>ak(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sZ(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sZ(e)).join(",")),`Target(${t})`}function a2(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!aR(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!aF(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!aE(e.startAt,t.startAt)&&aE(e.endAt,t.endAt)}function a3(e){return rQ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function a6(e,t){return e.filters.filter(e=>e instanceof ax&&e.field.isEqual(t))}function a4(e,t){let r=ni(t);if(void 0===r)return null;for(let t of a6(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function a5(e,t){let r=new Map;for(let n of ns(t))for(let t of a6(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function a8(e,t){let r=[],n=!0;for(let i of ns(t)){let t=0===i.kind?a9(e,i.fieldPath,e.startAt):oe(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new aS(r,n)}function a7(e,t){let r=[],n=!0;for(let i of ns(t)){let t=0===i.kind?oe(e,i.fieldPath,e.endAt):a9(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new aS(r,n)}function a9(e,t,r){let n=sM,i=!0;for(let r of a6(e,t)){let e=sM,t=!0;switch(r.op){case"<":case"<=":e=ad(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sM}0>ap({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>ap({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function oe(e,t,r){let n=sO,i=!0;for(let r of a6(e,t)){let e=sO,t=!0;switch(r.op){case">=":case">":e=af(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sO}am({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];am({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ot(e){let t=new se(rW.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function or(e){return null!==e.limit}class on{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function oi(e,t,r,n,i,s,a,o){return new on(e,t,r,n,i,s,a,o)}function os(e){return new on(e)}function oa(e,t){return new on(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ol(e){let t=new se(rW.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function oc(e){return rQ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ou(e){return null!==e.collectionGroup}function oh(e){let t=ra(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";ol(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new a_(n,r))}),e.has(rW.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new a_(rW.keyField(),r))}return t.memoizedNormalizedOrderBy}function od(e){let t=ra(e);return t.memoizedTarget||(t.memoizedTarget=op(t,oh(e))),t.memoizedTarget}function of(e){let t=ra(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=op(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function op(e,t){if("F"===e.limitType)return aZ(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new a_(e.field,t)});let r=e.endAt?new aS(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new aS(e.startAt.position,e.startAt.inclusive):null;return aZ(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function om(e,t){let r=e.filters.concat([t]);return new on(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function og(e,t){let r=e.explicitOrderBy.concat([t]);return new on(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oy(e,t,r){return new on(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function ov(e,t){return new on(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function ob(e,t){return new on(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function oS(e,t){return a2(od(e),od(t))&&e.limitType===t.limitType}function ow(e){return`${a0(od(e))}|lt:${e.limitType}`}function oT(e){return`Query(target=${a1(od(e))}; limitType=${e.limitType})`}function oC(e,t){return t.isFoundDocument()&&oE(e,t)&&o_(e,t)&&oI(e,t)&&ok(e,t)}function oE(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):rQ.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function o_(e,t){for(let r of oh(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function oI(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function ok(e,t){return(!e.startAt||!!aC(e.startAt,oh(e),t))&&(!e.endAt||!!aT(e.endAt,oh(e),t))}function oR(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oA(e){return(t,r)=>{let n=!1;for(let i of oh(e)){let e=ox(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function ox(e,t,r){let n=e.field.isKeyField()?rQ.comparator(t.key,r.key):ab(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return rn(19790,{direction:e.dir})}}class oD{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){i3(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return i4(this.inner)}size(){return this.innerSize}}let oO=new i5(rQ.comparator);function oN(){return oO}let oP=new i5(rQ.comparator);function oM(...e){let t=oP;for(let r of e)t=t.insert(r.key,r);return t}function oL(){return oU()}function oF(e){let t=oP;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function oB(){return oU()}function oj(){return oU()}function oU(){return new oD(e=>e.toString(),(e,t)=>e.isEqual(t))}let oV=new i5(rQ.comparator);function oq(){return oV}let oz=new se(rQ.comparator);function o$(...e){let t=oz;for(let r of e)t=t.add(r);return t}let oK=new se(rF);function oH(){return oK}function oG(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sR(t)?"-0":t}}function oW(e){return{integerValue:""+e}}function oQ(e,t){return sA(t)?oW(t):oG(e,t)}class oJ{constructor(){this._=void 0}}function oY(e,t,r){return e instanceof o1?sb(r,t):e instanceof o2?o3(e,t):e instanceof o6?o4(e,t):o8(e,t)}function oX(e,t,r){return e instanceof o2?o3(e,t):e instanceof o6?o4(e,t):r}function oZ(e,t){return e instanceof o5?an(t)?t:{integerValue:0}:null}function o0(e,t){return e instanceof o2&&t instanceof o2||e instanceof o6&&t instanceof o6?rq(e.elements,t.elements,sF):e instanceof o5&&t instanceof o5?sF(e.operand,t.operand):e instanceof o1&&t instanceof o1}class o1 extends oJ{}class o2 extends oJ{constructor(e){super(),this.elements=e}}function o3(e,t){let r=o9(t);for(let t of e.elements)r.some(e=>sF(e,t))||r.push(t);return{arrayValue:{values:r}}}class o6 extends oJ{constructor(e){super(),this.elements=e}}function o4(e,t){let r=o9(t);for(let t of e.elements)r=r.filter(e=>!sF(e,t));return{arrayValue:{values:r}}}class o5 extends oJ{constructor(e,t){super(),this.serializer=e,this.operand=t}}function o8(e,t){let r=oZ(e,t),n=o7(r)+o7(e.operand);return at(r)&&at(e.operand)?oW(n):oG(e.serializer,n)}function o7(e){return sd(e.integerValue||e.doubleValue)}function o9(e){return ai(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class le{constructor(e,t){this.field=e,this.transform=t}}function lt(e,t){return e.field.isEqual(t.field)&&o0(e.transform,t.transform)}function lr(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rq(e,t,(e,t)=>lt(e,t))}class ln{constructor(e,t){this.version=e,this.transformResults=t}}class li{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new li}static exists(e){return new li(void 0,e)}static updateTime(e){return new li(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ls(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class la{}function lo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new lw(e.key,li.none());else return new ld(e.key,e.data,li.none());{let r=e.data,n=ag.empty(),i=new se(rW.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new lm(e.key,n,new si(i.toArray()),li.none())}}function ll(e,t,r){e instanceof ld?lf(e,t,r):e instanceof lm?lg(e,t,r):lT(e,t,r)}function lc(e,t,r,n){return e instanceof ld?lp(e,t,r,n):e instanceof lm?ly(e,t,r,n):lC(e,t,r)}function lu(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=oZ(n.transform,e||null);null!=i&&(null===r&&(r=ag.empty()),r.set(n.field,i))}return r||null}function lh(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!lr(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ld extends la{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function lf(e,t,r){let n=e.value.clone(),i=lb(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function lp(e,t,r,n){if(!ls(e.precondition,t))return r;let i=e.value.clone(),s=lS(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class lm extends la{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lg(e,t,r){if(!ls(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=lb(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(lv(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function ly(e,t,r,n){if(!ls(e.precondition,t))return r;let i=lS(e.fieldTransforms,n,t),s=t.data;return(s.setAll(lv(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function lv(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function lb(e,t,r){let n=new Map;rs(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,oX(a,o,r[i]))}return n}function lS(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,oY(e,s,t))}return n}class lw extends la{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function lT(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function lC(e,t,r){return ls(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class lE extends la{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class l_{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&ll(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oj();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=lo(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(ne.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),o$())}isEqual(e){return this.batchId===e.batchId&&rq(this.mutations,e.mutations,(e,t)=>lh(e,t))&&rq(this.baseMutations,e.baseMutations,(e,t)=>lh(e,t))}}class lI{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){rs(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=oq(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new lI(e,t,r,n)}}class lk{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lR{constructor(e,t){this.count=e,this.unchangedNames=t}}function lA(e){switch(e){case ro:return rn(64938);case rl:case rc:case rh:case rg:case rw:case rT:case rm:return!1;case ru:case rd:case rf:case rp:case ry:case rv:case rb:case rS:case rC:return!0;default:return rn(15467,{code:e})}}function lx(e){return lA(e)&&e!==rv}function lD(e){if(void 0===e)return re("GRPC error has no .code"),rc;switch(e){case u.OK:return ro;case u.CANCELLED:return rl;case u.UNKNOWN:return rc;case u.DEADLINE_EXCEEDED:return rh;case u.RESOURCE_EXHAUSTED:return rg;case u.INTERNAL:return rw;case u.UNAVAILABLE:return rT;case u.UNAUTHENTICATED:return rm;case u.INVALID_ARGUMENT:return ru;case u.NOT_FOUND:return rd;case u.ALREADY_EXISTS:return rf;case u.PERMISSION_DENIED:return rp;case u.FAILED_PRECONDITION:return ry;case u.ABORTED:return rv;case u.OUT_OF_RANGE:return rb;case u.UNIMPLEMENTED:return rS;case u.DATA_LOSS:return rC;default:return rn(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(u||(u={}));class lO extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let lN=null;function lP(e){if(lN)throw Error("a TestingHooksSpi instance is already set");lN=e}function lM(){return new tZ.TextEncoder}function lL(){return new tZ.TextDecoder("utf-8")}let lF=new l([0xffffffff,0xffffffff],0);function lB(e){let t=lM().encode(e),r=new c;return r.update(t),new Uint8Array(r.digest())}function lj(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new l([r,n],0),new l([i,s],0)]}class lU{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lV(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lV(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lV(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=l.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(l.fromNumber(r)));return 1===n.compare(lF)&&(n=new l([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=lj(lB(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new lU(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=lj(lB(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class lV extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lq{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lz.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lq(ne.min(),n,new i5(rF),oN(),o$())}}class lz{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lz(r,t,o$(),o$(),o$())}}class l${constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class lK{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class lH{constructor(e,t,r=so.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class lG{constructor(){this.pendingResponses=0,this.documentChanges=lY(),this._resumeToken=so.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=o$(),t=o$(),r=o$();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:rn(38017,{changeType:i})}}),new lz(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=lY()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,rs(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let lW="WatchChangeAggregator";class lQ{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=oN(),this.pendingDocumentUpdatesByTarget=lJ(),this.pendingDocumentTargetMapping=lJ(),this.pendingTargetResets=new i5(rF)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:rn(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(a3(i))if(0===r){let e=new rQ(i.path);this.removeDocumentFromTarget(t,e,av.newNoDocument(e,ne.min()))}else rs(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}lN?.notifyOnExistenceFilterMismatch(lX(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sf(i).toUint8Array()}catch(e){if(e instanceof lO)return rt("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new lU(t,s,a)}catch(e){return e instanceof lV?rt("BloomFilter error: ",e):rt("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&a3(i.target)){let t=new rQ(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,av.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=o$();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new lq(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=oN(),this.pendingDocumentUpdatesByTarget=lJ(),this.pendingDocumentTargetMapping=lJ(),this.pendingTargetResets=new i5(rF),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new lG,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new se(rF),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new se(rF),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||t9(lW,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new lG),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function lJ(){return new i5(rQ.comparator)}function lY(){return new i5(rQ.comparator)}function lX(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let lZ=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),l0=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),l1=(()=>{let e={};return e.and="AND",e.or="OR",e})();function l2(e,t){}class l3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function l6(e){return new rE(void 0===e.code?rc:lD(e.code),e.message||"")}function l4(e,t){return e.useProto3Json||sk(t)?t:{value:t}}function l5(e){let t;return sk(t="object"==typeof e?e.value:e)?null:t}function l8(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function l7(e){let t=sh(e);return new r9(t.seconds,t.nanos)}function l9(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ce(e,t){return e.useProto3Json?(rs(void 0===t||"string"==typeof t,58123),so.fromBase64String(t||"")):(rs(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),so.fromUint8Array(t||new Uint8Array))}function ct(e,t){return l8(e,t.toTimestamp())}function cr(e){return rs(!!e,49232),ne.fromTimestamp(l7(e))}function cn(e,t){return ci(e,t).canonicalString()}function ci(e,t){let r=ch(e).child("documents");return void 0===t?r:r.child(t)}function cs(e){let t=rH.fromString(e);return rs(ur(t),10190,{key:t.toString()}),t}function ca(e,t){return cn(e.databaseId,t.path)}function co(e,t){let r=cs(t);if(r.get(1)!==e.databaseId.projectId)throw new rE(ru,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new rE(ru,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new rQ(cd(r))}function cl(e,t){return cn(e.databaseId,t)}function cc(e){let t=cs(e);return 4===t.length?rH.emptyPath():cd(t)}function cu(e){return new rH(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ch(e){return new rH(["projects",e.projectId,"databases",e.database])}function cd(e){return rs(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cf(e,t,r){return{name:ca(e,t),fields:r.value.mapValue.fields}}function cp(e,t){return{name:ca(e,t.key),fields:t.data.value.mapValue.fields,updateTime:l8(e,t.version.toTimestamp()),createTime:l8(e,t.createTime.toTimestamp())}}function cm(e,t,r){let n=co(e,t.name),i=cr(t.updateTime),s=t.createTime?cr(t.createTime):ne.min(),a=new ag({mapValue:{fields:t.fields}}),o=av.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function cg(e,t){rs(!!t.found,43571),l2(t.found.name),l2(t.found.updateTime);let r=co(e,t.found.name),n=cr(t.found.updateTime),i=t.found.createTime?cr(t.found.createTime):ne.min(),s=new ag({mapValue:{fields:t.found.fields}});return av.newFoundDocument(r,n,i,s)}function cy(e,t){rs(!!t.missing,3894),rs(!!t.readTime,22933);let r=co(e,t.missing),n=cr(t.readTime);return av.newNoDocument(r,n)}function cv(e,t){return"found"in t?cg(e,t):"missing"in t?cy(e,t):rn(7234,{result:t})}function cb(e,t){let r;if("targetChange"in t){l2(t.targetChange);let n=cS(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=ce(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new lH(n,i,s,a&&l6(a)||null)}else if("documentChange"in t){l2(t.documentChange);let n=t.documentChange;l2(n.document),l2(n.document.name),l2(n.document.updateTime);let i=co(e,n.document.name),s=cr(n.document.updateTime),a=n.document.createTime?cr(n.document.createTime):ne.min(),o=new ag({mapValue:{fields:n.document.fields}}),l=av.newFoundDocument(i,s,a,o);r=new l$(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){l2(t.documentDelete);let n=t.documentDelete;l2(n.document);let i=co(e,n.document),s=n.readTime?cr(n.readTime):ne.min(),a=av.newNoDocument(i,s);r=new l$([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){l2(t.documentRemove);let n=t.documentRemove;l2(n.document);let i=co(e,n.document);r=new l$([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rn(11601,{change:t});l2(t.filter);let e=t.filter;l2(e.targetId);let{count:n=0,unchangedNames:i}=e,s=new lR(n,i);r=new lK(e.targetId,s)}return r}function cS(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return rn(39313,{state:e})}function cw(e){if(!("targetChange"in e))return ne.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?ne.min():cr(t.readTime)}function cT(e,t){let r;if(t instanceof ld)r={update:cf(e,t.key,t.value)};else if(t instanceof lw)r={delete:ca(e,t.key)};else if(t instanceof lm)r={update:cf(e,t.key,t.data),updateMask:ue(t.fieldMask)};else{if(!(t instanceof lE))return rn(16599,{mutationType:t.type});r={verify:ca(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>cR(e,t))),t.precondition.isNone||(r.currentDocument=cE(e,t.precondition)),r}function cC(e,t){let r=t.currentDocument?c_(t.currentDocument):li.none(),n=t.updateTransforms?t.updateTransforms.map(t=>cA(e,t)):[];if(t.update){l2(t.update.name);let i=co(e,t.update.name),s=new ag({mapValue:{fields:t.update.fields}});return t.updateMask?new lm(i,s,ut(t.updateMask),r,n):new ld(i,s,r,n)}return t.delete?new lw(co(e,t.delete),r):t.verify?new lE(co(e,t.verify),r):rn(1463,{proto:t})}function cE(e,t){return void 0!==t.updateTime?{updateTime:ct(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:rn(27497)}function c_(e){return void 0!==e.updateTime?li.updateTime(cr(e.updateTime)):void 0!==e.exists?li.exists(e.exists):li.none()}function cI(e,t){let r=e.updateTime?cr(e.updateTime):cr(t);return r.isEqual(ne.min())&&(r=cr(t)),new ln(r,e.transformResults||[])}function ck(e,t){return e&&e.length>0?(rs(void 0!==t,14353),e.map(e=>cI(e,t))):[]}function cR(e,t){let r=t.transform;if(r instanceof o1)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof o2)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof o6)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof o5)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw rn(20930,{transform:t.transform})}function cA(e,t){let r=null;return"setToServerValue"in t?(rs("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new o1):"appendMissingElements"in t?r=new o2(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new o6(t.removeAllFromArray.values||[]):"increment"in t?r=new o5(e,t.increment):rn(16584,{proto:t}),new le(rW.fromServerFormat(t.fieldPath),r)}function cx(e,t){return{documents:[cl(e,t.path)]}}function cD(e){let t=e.documents.length;return rs(1===t,1966,{count:t}),od(os(cc(e.documents[0])))}function cO(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=cl(e,r);let s=cj(t.filters);s&&(n.structuredQuery.where=s);let a=cq(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=l4(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=c$(t.startAt)),t.endAt&&(n.structuredQuery.endAt=cK(t.endAt)),{queryTarget:n,parent:r}}function cN(e,t,r,n){let{queryTarget:i,parent:s}=cO(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:c0(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:c0(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function cP(e){let t=cc(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){rs(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=cU(r.where));let a=[];r.orderBy&&(a=cz(r.orderBy));let o=null;r.limit&&(o=l5(r.limit));let l=null;r.startAt&&(l=cH(r.startAt));let c=null;return r.endAt&&(c=cG(r.endAt)),oi(t,i,a,s,o,"F",l,c)}function cM(e){return od(cP(e))}function cL(e,t){let r=cF(t.purpose);return null==r?null:{"goog-listen-tags":r}}function cF(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rn(28987,{purpose:e})}}function cB(e,t){let r,n=t.target;if((r=a3(n)?{documents:cx(e,n)}:{query:cO(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=l9(e,t.resumeToken);let n=l4(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(ne.min())>0){r.readTime=l8(e,t.snapshotVersion.toTimestamp());let n=l4(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function cj(e){if(0!==e.length)return c6(aD.create(e,"and"))}function cU(e){let t=cV(e);return t instanceof aD&&aP(t)?t.getFilters():[t]}function cV(e){return void 0!==e.unaryFilter?c8(e):void 0!==e.fieldFilter?c7(e):void 0!==e.compositeFilter?c9(e):rn(30097,{filter:e})}function cq(e){if(0!==e.length)return e.map(e=>c2(e))}function cz(e){return e.map(e=>c3(e))}function c$(e){return{before:e.inclusive,values:e.position}}function cK(e){return{before:!e.inclusive,values:e.position}}function cH(e){let t=!!e.before;return new aS(e.values||[],t)}function cG(e){let t=!e.before;return new aS(e.values||[],t)}function cW(e){return lZ[e]}function cQ(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function cJ(e){return l0[e]}function cY(e){return l1[e]}function cX(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rn(58110);default:return rn(50506)}}function cZ(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rn(1026)}}function c0(e){return{fieldPath:e.canonicalString()}}function c1(e){return rW.fromServerFormat(e.fieldPath)}function c2(e){return{field:c0(e.field),direction:cW(e.dir)}}function c3(e){return new a_(c1(e.field),cQ(e.direction))}function c6(e){return e instanceof ax?c5(e):e instanceof aD?c4(e):rn(54877,{filter:e})}function c4(e){let t=e.getFilters().map(e=>c6(e));return 1===t.length?t[0]:{compositeFilter:{op:cY(e.op),filters:t}}}function c5(e){if("=="===e.op){if(aa(e.value))return{unaryFilter:{field:c0(e.field),op:"IS_NAN"}};else if(as(e.value))return{unaryFilter:{field:c0(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aa(e.value))return{unaryFilter:{field:c0(e.field),op:"IS_NOT_NAN"}};else if(as(e.value))return{unaryFilter:{field:c0(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:c0(e.field),op:cJ(e.op),value:e.value}}}function c8(e){switch(e.unaryFilter.op){case"IS_NAN":let t=c1(e.unaryFilter.field);return ax.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=c1(e.unaryFilter.field);return ax.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=c1(e.unaryFilter.field);return ax.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=c1(e.unaryFilter.field);return ax.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rn(61313);default:return rn(60726)}}function c7(e){return ax.create(c1(e.fieldFilter.field),cX(e.fieldFilter.op),e.fieldFilter.value)}function c9(e){return aD.create(e.compositeFilter.filters.map(e=>cV(e)),cZ(e.compositeFilter.op))}function ue(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ut(e){return new si((e.fieldPaths||[]).map(e=>rW.fromServerFormat(e)))}function ur(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function un(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class ui{constructor(e,t,r,n,i=ne.min(),s=ne.min(),a=so.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ui(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ui(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ui(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ui(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class us{constructor(e){this.remoteSerializer=e}}function ua(e,t){let r;if(t.document)r=cm(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rQ.fromSegments(t.noDocument.path),n=uh(t.noDocument.readTime);r=av.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return rn(56709);let e=rQ.fromSegments(t.unknownDocument.path),n=uh(t.unknownDocument.version);r=av.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(uc(t.readTime)),r}function uo(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:ul(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=cp(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:uu(t.version)};else{if(!t.isUnknownDocument())return rn(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:uu(t.version)}}return n}function ul(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uc(e){let t=new r9(e[0],e[1]);return ne.fromTimestamp(t)}function uu(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function uh(e){let t=new r9(e.seconds,e.nanoseconds);return ne.fromTimestamp(t)}function ud(e,t,r){let n=r.baseMutations.map(t=>cT(e.remoteSerializer,t)),i=r.mutations.map(t=>cT(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function uf(e,t){let r=(t.baseMutations||[]).map(t=>cC(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>cC(e.remoteSerializer,t)),i=r9.fromMillis(t.localWriteTimeMs);return new l_(t.batchId,i,r,n)}function up(e){let t,r=uh(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?uh(e.lastLimboFreeSnapshotVersion):ne.min();return new ui(t=ug(e.query)?cD(e.query):cM(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,so.fromBase64String(e.resumeToken))}function um(e,t){let r,n=uu(t.snapshotVersion),i=uu(t.lastLimboFreeSnapshotVersion);r=a3(t.target)?cx(e.remoteSerializer,t.target):cO(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:a0(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ug(e){return void 0!==e.documents}function uy(e){return{id:e.bundleId,createTime:uh(e.createTime),version:e.version}}function uv(e){return{bundleId:e.id,createTime:uu(cr(e.createTime)),version:e.version}}function ub(e){return{name:e.name,query:uw(e.bundledQuery),readTime:uh(e.readTime)}}function uS(e){return{name:e.name,readTime:uu(cr(e.readTime)),bundledQuery:e.bundledQuery}}function uw(e){let t=cP({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?oy(t,t.limit,"L"):t}function uT(e){return{name:e.name,query:uw(e.bundledQuery),readTime:cr(e.readTime)}}function uC(e){return{id:e.id,version:e.version,createTime:cr(e.createTime)}}function uE(e,t){return new lk(t.largestBatchId,cC(e.remoteSerializer,t.overlayMutation))}function u_(e,t,r){let[n,i,s]=uI(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:cT(e.remoteSerializer,r.mutation)}}function uI(e,t){let r=t.path.lastSegment();return[e,nz(t.path.popLast()),r]}function uk(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function uR(e,t){let r=t?new nh(t.sequenceNumber,new np(uh(t.readTime),new rQ(nH(t.documentKey)),t.largestBatchId)):nh.empty(),n=e.fields.map(([e,t])=>new nc(rW.fromServerFormat(e),t));return new nn(e.indexId,e.collectionGroup,n,r)}function uA(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:uu(n.readTime),documentKey:nz(n.documentKey.path),largestBatchId:n.largestBatchId}}class ux{getBundleMetadata(e,t){return uD(e).get(t).next(e=>{if(e)return uy(e)})}saveBundleMetadata(e,t){return uD(e).put(uv(t))}getNamedQuery(e,t){return uO(e).get(t).next(e=>{if(e)return ub(e)})}saveNamedQuery(e,t){return uO(e).put(uS(t))}}function uD(e){return i1(e,iw)}function uO(e){return i1(e,iC)}class uN{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new uN(e,t.uid||"")}getOverlay(e,t){return uP(e).get(uI(this.userId,t)).next(e=>e?uE(this.serializer,e):null)}getOverlays(e,t){let r=oB();return nb.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new lk(t,i);n.push(this.saveOverlay(e,s))}),nb.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(nz(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(uP(e).deleteAll(ij,n))}),nb.waitFor(i)}getOverlaysForCollection(e,t,r){let n=oB(),i=nz(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return uP(e).loadAll(ij,s).next(e=>{for(let t of e){let e=uE(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=oB(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return uP(e).iterate({index:iV,range:a},(e,t,r)=>{let a=uE(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return uP(e).put(u_(this.serializer,this.userId,t))}}function uP(e){return i1(e,iF)}class uM{globalsStore(e){return i1(e,iz)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?so.fromUint8Array(t):so.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let uL=5,uF=10,uB=13,uj=15,uU=20,uV=25,uq=30,uz=37,u$=45,uK=50,uH=53,uG=55,uW=60,uQ=2;class uJ{writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,uL);else if("booleanValue"in e)this.writeValueTypeLabel(t,uF),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,uj),t.writeNumber(sd(e.integerValue));else if("doubleValue"in e){let r=sd(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,uB):(this.writeValueTypeLabel(t,uj),sR(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,uU),"string"==typeof r&&(r=sh(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,uq),t.writeBytes(sf(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,u$),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?au(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):al(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):rn(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,uV),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,uG),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,uH);let n=sP,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,uj),t.writeNumber(sd(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,uK),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,uz),rQ.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,uW),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(uQ)}}uJ.INSTANCE=new uJ;let uY="\uD800",uX="\uDBFF",uZ=0,u0=255,u1=1,u2=255,u3=255,u6=0,u4=64,u5=8,u8=1024;function u7(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function u9(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function he(e){let t=0;for(let r=0;r<8;++r){let n=u9(255&e[r]);if(t+=n,8!==n)break}return t}function ht(e){return Math.ceil((u4-he(e))/u5)}class hr{constructor(){this.buffer=new Uint8Array(u8),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<uY||uX<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<uY||uX<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=ht(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=ht(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(u2),this.writeEscapedByteAscending(u3)}writeInfinityDescending(){this.writeEscapedByteDescending(u2),this.writeEscapedByteDescending(u3)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=u7(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===uZ?(this.writeEscapedByteAscending(uZ),this.writeEscapedByteAscending(u0)):t===u2?(this.writeEscapedByteAscending(u2),this.writeEscapedByteAscending(u6)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===uZ?(this.writeEscapedByteDescending(uZ),this.writeEscapedByteDescending(u0)):t===u2?(this.writeEscapedByteDescending(u2),this.writeEscapedByteDescending(u6)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(uZ),this.writeEscapedByteAscending(u1)}writeSeparatorDescending(){this.writeEscapedByteDescending(uZ),this.writeEscapedByteDescending(u1)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class hn{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class hi{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class hs{constructor(){this.orderedCode=new hr,this.ascending=new hn(this.orderedCode),this.descending=new hi(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class ha{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new ha(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:hc(this._arrayValue),directionalValue:hc(this._directionalValue),orderedDocumentKey:hc(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function ho(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=hl(e._arrayValue,t._arrayValue))||0!==(r=hl(e._directionalValue,t._directionalValue))?r:rQ.comparator(e._documentKey,t._documentKey)}function hl(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function hc(e){return eo()?hh(e):e}function hu(e){return"string"!=typeof e?e:hd(e)}function hh(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function hd(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class hf{constructor(e){for(const t of(this.inequalityFilters=new se((e,t)=>rW.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(rs(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=ni(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=ns(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new se(rW.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new nc(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nc(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new nc(r.field,+("asc"!==r.dir)))));return new nn(nn.UNKNOWN_ID,this.collectionId,t,nh.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hp(e){if(rs(e instanceof ax||e instanceof aD,20012),e instanceof ax)if(!(e instanceof aQ))return e;else{let t=e.value.arrayValue?.values?.map(t=>ax.create(e.field,"==",t))||[];return aD.create(t,"or")}let t=e.filters.map(e=>hp(e));return aD.create(t,e.op)}function hm(e){if(0===e.getFilters().length)return[];let t=hS(hp(e));return(rs(hv(t),7391),hg(t)||hy(t))?[t]:t.getFilters()}function hg(e){return e instanceof ax}function hy(e){return e instanceof aD&&aP(e)}function hv(e){return hg(e)||hy(e)||hb(e)}function hb(e){if(e instanceof aD&&aN(e)){for(let t of e.getFilters())if(!hg(t)&&!hy(t))return!1;return!0}return!1}function hS(e){if(rs(e instanceof ax||e instanceof aD,34018),e instanceof ax)return e;if(1===e.filters.length)return hS(e.filters[0]);let t=e.filters.map(e=>hS(e)),r=aD.create(t,e.op);return hv(r=h_(r))?r:(rs(r instanceof aD,64498),rs(aO(r),40251),rs(r.filters.length>1,57927),r.filters.reduce((e,t)=>hw(e,t)))}function hw(e,t){let r;return rs(e instanceof ax||e instanceof aD,38388),rs(t instanceof ax||t instanceof aD,25473),h_(r=e instanceof ax?t instanceof ax?hT(e,t):hE(e,t):t instanceof ax?hE(t,e):hC(e,t))}function hT(e,t){return aD.create([e,t],"and")}function hC(e,t){if(rs(e.filters.length>0&&t.filters.length>0,48005),aO(e)&&aO(t))return aU(e,t.getFilters());let r=aN(e)?e:t,n=aN(e)?t:e,i=r.filters.map(e=>hw(e,n));return aD.create(i,"or")}function hE(e,t){if(aO(t))return aU(t,e.getFilters());{let r=t.filters.map(t=>hw(e,t));return aD.create(r,"or")}}function h_(e){if(rs(e instanceof ax||e instanceof aD,11850),e instanceof ax)return e;let t=e.getFilters();if(1===t.length)return h_(t[0]);if(aM(e))return e;let r=t.map(e=>h_(e)),n=[];return(r.forEach(t=>{t instanceof ax?n.push(t):t instanceof aD&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:aD.create(n,e.op)}class hI{constructor(){this.collectionParentIndex=new hk}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),nb.resolve()}getCollectionParents(e,t){return nb.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return nb.resolve()}deleteFieldIndex(e,t){return nb.resolve()}deleteAllFieldIndexes(e){return nb.resolve()}createTargetIndexes(e,t){return nb.resolve()}getDocumentsMatchingTarget(e,t){return nb.resolve(null)}getIndexType(e,t){return nb.resolve(0)}getFieldIndexes(e,t){return nb.resolve([])}getNextCollectionGroupToUpdate(e){return nb.resolve(null)}getMinOffset(e,t){return nb.resolve(np.min())}getMinOffsetFromCollectionGroup(e,t){return nb.resolve(np.min())}updateCollectionGroup(e,t,r){return nb.resolve()}updateIndexEntries(e,t){return nb.resolve()}}class hk{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new se(rH.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new se(rH.comparator)).toArray()}}let hR="IndexedDbIndexManager",hA=new Uint8Array(0);class hx{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new hk,this.targetToDnfSubTargets=new oD(e=>a0(e),(e,t)=>a2(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:nz(n)};return hD(e).put(i)}return nb.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[rz(t),""],!1,!0);return hD(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(nH(n.parent))}return r})}addFieldIndex(e,t){let r=hN(e),n=uk(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=hP(e);return i.next(e=>{r.put(uA(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=hN(e),n=hP(e),i=hO(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hN(e),r=hO(e),n=hP(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return nb.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new hf(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=hO(e),n=!0,i=new Map;return nb.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return nb.resolve(null);{let e=o$(),n=[];return nb.forEach(i,(i,s)=>{t9(hR,`Using index ${nl(i)} to execute ${a0(t)}`);let a=a4(s,i),o=a5(s,i),l=a8(s,i),c=a7(s,i),u=this.encodeBound(i,s,l),h=this.encodeBound(i,s,c),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,u,l.inclusive,h,c.inclusive,d);return nb.forEach(f,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=rQ.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:hm(aD.create(e.filters,"and")).map(t=>aZ(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),c=[];for(let u=0;u<o;++u){let o=t?this.encodeSingleElement(t[u/l]):hA,h=this.generateLowerBound(e,o,r[u%l],n),d=this.generateUpperBound(e,o,i[u%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));c.push(...this.createRange(h,d,f))}return c}generateLowerBound(e,t,r,n){let i=new ha(e,rQ.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new ha(e,rQ.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new hf(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return nb.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<ot(t)&&(r=1):r=0})).next(()=>or(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new hs;for(let n of ns(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);uJ.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new hs;return uJ.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new hs;return uJ.INSTANCE.writeIndexValue(ae(this.databaseId,t),r.forKind(na(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new hs);let i=0;for(let s of ns(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&ai(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);uJ.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new hs;n.seed(r.encodedBytes()),uJ.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof ax&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=hN(e),n=hP(e);return(t?r.loadAll(ik,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return nb.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(uR(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:rF(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=hN(e),i=hP(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(ik,IDBKeyRange.bound(t,t)).next(t=>nb.forEach(t,t=>i.put(uA(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return nb.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?nb.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),nb.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?nb.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return hO(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return hO(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=hO(e),i=new se(ho);return n.iterate({index:iM,range:IDBKeyRange.only([r.indexId,this.uid,hc(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new ha(r.indexId,t,hu(n.arrayValue),hu(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new se(ho),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=ni(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ai(s))for(let i of s.arrayValue.values||[])r=r.add(new ha(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new ha(t.indexId,e.key,hA,n));return r}updateEntries(e,t,r,n,i){t9(hR,"Updating index entries for document '%s'",t.key);let s=[];return sr(n,i,ho,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),nb.waitFor(s)}getNextSequenceNumber(e){let t=1;return hP(e).iterate({index:iD,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>ho(e,t)).filter((e,t,r)=>!t||0!==ho(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=ho(i,e),s=ho(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,hA,rQ.empty()),r=n[e+1].dbIndexEntryKey(this.uid,hA,rQ.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return ho(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hM)}getMinOffset(e,t){return nb.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||rn(44426))).next(hM)}}function hD(e){return i1(e,iy)}function hO(e){return i1(e,iN)}function hN(e){return i1(e,i_)}function hP(e){return i1(e,iA)}function hM(e){rs(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>nm(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new np(t.readTime,t.documentKey,r)}function hL(e,t,r){let n=e.store(nX),i=e.store(n5),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{rs(1===o,47070,{batchId:r.batchId})}));let c=[];for(let e of r.mutations){let n=n6(t,e.key.path,r.batchId);s.push(i.delete(n)),c.push(e.key)}return nb.waitFor(s).next(()=>c)}function hF(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw rn(14731);return JSON.stringify(t).length}class hB{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return rs(""!==e.uid,64387),new hB(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return hV(e).iterate({index:n0,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=hq(e),s=hV(e);return s.add({}).next(a=>{rs("number"==typeof a,49019);let o=new l_(a,t,r,n),l=ud(this.serializer,this.userId,o),c=[],u=new se((e,t)=>rF(e.canonicalString(),t.canonicalString()));for(let e of n){let t=n6(this.userId,e.key.path,a);u=u.add(e.key.path.popLast()),c.push(s.put(l)),c.push(i.put(t,n4))}return u.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),nb.waitFor(c).next(()=>o)})}lookupMutationBatch(e,t){return hV(e).get(t).next(e=>e?(rs(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),uf(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?nb.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return hV(e).iterate({index:n0,range:n},(e,t,n)=>{t.userId===this.userId&&(rs(t.batchId>=r,47524,{nextBatchId:r}),i=uf(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=sI;return hV(e).iterate({index:n0,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,sI],[this.userId,1/0]);return hV(e).loadAll(n0,t).next(e=>e.map(e=>uf(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=n3(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return hq(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,c=nH(o);return a===this.userId&&t.path.isEqual(c)?hV(e).get(l).next(e=>{if(!e)throw rn(61480,{indexKey:r,batchId:l});rs(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(uf(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se(rF),n=[];return t.forEach(t=>{let i=n3(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=hq(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=nH(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),nb.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=n3(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new se(rF);return hq(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,c=nH(o);s===this.userId&&r.isPrefixOf(c)?c.length===n&&(a=a.add(l)):i.done()}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(hV(e).get(t).next(e=>{if(null===e)throw rn(35274,{batchId:t});rs(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(uf(this.serializer,e))}))}),nb.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return hL(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),nb.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return nb.resolve();let r=IDBKeyRange.lowerBound(n2(this.userId)),n=[];return hq(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=nH(e[1]);n.push(t)}}).next(()=>{rs(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return hj(e,this.userId,t)}getMutationQueueMetadata(e){return hz(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:sI,lastStreamToken:""})}}function hj(e,t,r){let n=n3(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return hq(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function hU(e,t){let r=!1;return hz(e).iterateSerial(n=>hj(e,n,t).next(e=>(e&&(r=!0),nb.resolve(!e)))).next(()=>r)}function hV(e){return i1(e,nX)}function hq(e){return i1(e,n5)}function hz(e){return i1(e,nJ)}let h$=2;class hK{constructor(e){this.lastId=e}next(){return this.lastId+=h$,this.lastId}static forTargetCache(){return new hK(2-h$)}static forSyncEngine(){return new hK(1-h$)}}class hH{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new hK(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>ne.fromTimestamp(new r9(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>hG(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(rs(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return hG(e).iterate((s,a)=>{let o=up(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>nb.waitFor(i)).next(()=>n)}forEachTarget(e,t){return hG(e).iterate((e,r)=>{t(up(r))})}retrieveMetadata(e){return hW(e).get(im).next(e=>(rs(null!==e,2888),e))}saveMetadata(e,t){return hW(e).put(im,t)}saveTargetData(e,t){return hG(e).put(um(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=a0(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return hG(e).iterate({range:n,index:il},(e,r,n)=>{let s=up(r);a2(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=hQ(e);return t.forEach(t=>{let s=nz(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),nb.waitFor(n)}removeMatchingKeys(e,t,r){let n=hQ(e);return nb.forEach(t,t=>{let i=nz(t.path);return nb.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=hQ(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=hQ(e),i=o$();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new rQ(nH(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=nz(t.path),n=IDBKeyRange.bound([r],[rz(r)],!1,!0),i=0;return hQ(e).iterate({index:id,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return hG(e).get(t).next(e=>e?up(e):null)}}function hG(e){return i1(e,ia)}function hW(e){return i1(e,ig)}function hQ(e){return i1(e,iu)}let hJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hY=-1,hX=0x2800000;class hZ{static withCacheSize(e){return new hZ(e,hZ.DEFAULT_COLLECTION_PERCENTILE,hZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}hZ.DEFAULT_COLLECTION_PERCENTILE=10,hZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hZ.DEFAULT=new hZ(hX,hZ.DEFAULT_COLLECTION_PERCENTILE,hZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hZ.DISABLED=new hZ(hY,0,0);let h0="LruGarbageCollector",h1=1048576,h2=6e4,h3=3e5;function h6([e,t],[r,n]){let i=rF(e,r);return 0===i?rF(t,n):i}class h4{constructor(e){this.maxElements=e,this.buffer=new se(h6),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>h6(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class h5{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hY&&this.scheduleGC(h2)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){t9(h0,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nk(e)?t9(h0,"Ignoring IndexedDB error during garbage collection: ",e):await nv(e)}await this.scheduleGC(h3)})}}class h8{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nb.resolve(nB.INVALID);let r=new h4(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hY?(t9("LruGarbageCollector","Garbage collection skipped; disabled"),nb.resolve(hJ)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(t9("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hJ):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(t9("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),t7()<=o.DEBUG&&t9("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${l-a}ms
	Removed ${e} documents in ${c-l}ms
Total Duration: ${c-u}ms`),nb.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function h7(e,t){return new h8(e,t)}class h9{constructor(e,t){this.db=e,this.garbageCollector=h7(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return dr(e,r)}removeReference(e,t,r){return dr(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return dr(e,t)}isPinned(e,t){return hU(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,ne.min()),hQ(e).delete(de(s))))});n.push(t)}}).next(()=>nb.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return dr(e,t)}forEachOrphanedDocument(e,t){let r,n=hQ(e),i=nB.INVALID;return n.iterate({index:id},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==nB.INVALID&&t(new rQ(nH(r)),i),i=a,r=s):i=nB.INVALID}).next(()=>{i!==nB.INVALID&&t(new rQ(nH(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function de(e){return[0,nz(e.path)]}function dt(e,t){return{targetId:0,path:nz(e.path),sequenceNumber:t}}function dr(e,t){return hQ(e).put(dt(t,e.currentSequenceNumber))}class dn{constructor(){this.changes=new oD(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,av.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?nb.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class di{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return dc(e).put(r)}removeEntry(e,t,r){return dc(e).delete(dh(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=av.newInvalidDocument(t);return dc(e).iterate({index:n9,range:IDBKeyRange.only(du(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:av.newInvalidDocument(t)};return dc(e).iterate({index:n9,range:IDBKeyRange.only(du(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:hF(n)}}).next(()=>r)}getEntries(e,t){let r=oN();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=oN(),n=new i5(rQ.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,hF(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return nb.resolve();let n=new se(df);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(du(n.first()),du(n.last())),s=n.getIterator(),a=s.getNext();return dc(e).iterate({index:n9,range:i},(e,t,n)=>{let i=rQ.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>df(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(du(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),ul(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dc(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oN();for(let i of e){let e=this.maybeDecodeDocument(rQ.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(oC(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oN(),s=dd(t,r),a=dd(t,np.max());return dc(e).iterate({index:it,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(rQ.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new da(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return dl(e).get(is).next(e=>(rs(!!e,20021),e))}setMetadata(e,t){return dl(e).put(is,t)}maybeDecodeDocument(e,t){if(t){let e=ua(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ne.min())))return e}return av.newInvalidDocument(e)}}function ds(e){return new di(e)}class da extends dn{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new oD(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new se((e,t)=>rF(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=uo(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=hF(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=uo(this.documentCache.serializer,s.convertToNoDocument(ne.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),nb.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function dl(e){return i1(e,ii)}function dc(e){return i1(e,n8)}function du(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dh(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],ul(t),r[r.length-1]]}function dd(e,t){let r=t.documentKey.path.toArray();return[e,ul(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function df(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=rF(r[e],n[e]))return i;return(i=rF(r.length,n.length))||(i=rF(r[r.length-2],n[n.length-2]))?i:rF(r[r.length-1],n[n.length-1])}let dp=18;class dm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dg{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&lc(r.mutation,e,si.empty(),r9.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,o$()).next(()=>t))}getLocalViewOfDocuments(e,t,r=o$()){let n=oB();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=oM();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=oB();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,o$()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oN(),s=oU(),a=oL();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof lm)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),lc(a.mutation,t,a.mutation.getFieldMask(),r9.now())):s.set(t.key,si.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new dm(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oU(),n=new i5((e,t)=>e-t),i=o$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||si.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||o$()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,c=oj();l.forEach(e=>{if(!i.has(e)){let n=lo(t.get(e),r.get(e));null!==n&&c.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return nb.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return oc(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ou(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):nb.resolve(oB()),a=nt,o=i;return s.next(t=>nb.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?nb.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,o$())).next(e=>({batchId:a,changes:oF(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rQ(t)).next(e=>{let t=oM();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=oM();return this.indexManager.getCollectionParents(e,i).next(a=>nb.forEach(a,a=>{let o=oa(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,av.newInvalidDocument(n)))});let r=oM();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&lc(s.mutation,n,si.empty(),r9.now()),oC(t,n)&&(r=r.insert(e,n))}),r})}}class dy{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return nb.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,uC(t)),nb.resolve()}getNamedQuery(e,t){return nb.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,uT(t)),nb.resolve()}}class dv{constructor(){this.overlays=new i5(rQ.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return nb.resolve(this.overlays.get(t))}getOverlays(e,t){let r=oB();return nb.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),nb.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),nb.resolve()}getOverlaysForCollection(e,t,r){let n=oB(),i=t.length+1,s=new rQ(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return nb.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new i5((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=oB(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=oB(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return nb.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new lk(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=o$(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class db{constructor(){this.sessionToken=so.EMPTY_BYTE_STRING}getSessionToken(e){return nb.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nb.resolve()}}class dS{constructor(){this.refsByKey=new se(dw.compareByKey),this.refsByTarget=new se(dw.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new dw(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new dw(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new rQ(new rH([])),r=new dw(t,e),n=new dw(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new rQ(new rH([])),r=new dw(t,e),n=new dw(t,e+1),i=o$();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new dw(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class dw{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return rQ.comparator(e.key,t.key)||rF(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rF(e.targetOrBatchId,t.targetOrBatchId)||rQ.comparator(e.key,t.key)}}class dT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new se(dw.compareByKey)}checkEmpty(e){return nb.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new l_(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dw(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nb.resolve(s)}lookupMutationBatch(e,t){return nb.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return nb.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return nb.resolve(0===this.mutationQueue.length?sI:this.nextBatchId-1)}getAllMutationBatches(e){return nb.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dw(t,0),n=new dw(t,1/0),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),nb.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se(rF);return t.forEach(e=>{let t=new dw(e,0),n=new dw(e,1/0);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),nb.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;rQ.isDocumentKey(i)||(i=i.child(""));let s=new dw(new rQ(i),0),a=new se(rF);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),nb.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){rs(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return nb.forEach(t.mutations,n=>{let i=new dw(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new dw(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return nb.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,nb.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let dC="-9223372036854775808";function dE(){return new i5(rQ.comparator)}class d_{constructor(e){this.sizer=e,this.docs=dE(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return nb.resolve(r?r.document.mutableCopy():av.newInvalidDocument(t))}getEntries(e,t){let r=oN();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():av.newInvalidDocument(e))}),nb.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oN(),s=t.path,a=new rQ(s.child("__id"+dC+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=nm(nf(a),r))&&(n.has(a.key)||oC(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nb.resolve(i)}getAllFromCollectionGroup(e,t,r,n){rn(9500)}forEachDocumentKey(e,t){return nb.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new dk(this)}getSize(e){return nb.resolve(this.size)}}function dI(e){return new d_(e)}class dk extends dn{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),nb.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class dR{constructor(e){this.persistence=e,this.targets=new oD(e=>a0(e),a2),this.lastRemoteSnapshotVersion=ne.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dS,this.targetCount=0,this.targetIdGenerator=hK.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),nb.resolve()}getLastRemoteSnapshotVersion(e){return nb.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nb.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),nb.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),nb.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new hK(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,nb.resolve()}updateTargetData(e,t){return this.saveTargetData(t),nb.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,nb.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),nb.waitFor(i).next(()=>n)}getTargetCount(e){return nb.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return nb.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),nb.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),nb.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),nb.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return nb.resolve(r)}containsKey(e,t){return nb.resolve(this.references.containsKey(t))}}let dA="MemoryPersistence";class dx{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new nB(0),this._started=!1,this._started=!0,this.globalsCache=new db,this.referenceDelegate=e(this),this.targetCache=new dR(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new hI,this.remoteDocumentCache=dI(r),this.serializer=new us(t),this.bundleCache=new dy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new dT(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){t9(dA,"Starting transaction:",e);let n=new dD(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return nb.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class dD extends ny{constructor(e){super(),this.currentSequenceNumber=e}}class dO{constructor(e){this.persistence=e,this.localViewReferences=new dS,this._orphanedDocuments=null}static factory(e){return new dO(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw rn(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),nb.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),nb.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),nb.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nb.forEach(this.orphanedDocuments,r=>{let n=rQ.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,ne.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return nb.or([()=>nb.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class dN{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new oD(e=>nz(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=h7(this,t)}static factory(e,t){return new dN(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return nb.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return nb.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?nb.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,ne.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nb.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nb.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nb.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nb.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=s8(e.data.value)),t}isPinned(e,t,r){return nb.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return nb.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class dP{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new nT("createOrUpgrade",t);r<1&&n>=1&&(dL(e),dF(e),dq(e),dj(e));let s=nb.resolve();return r<3&&n>=3&&(0!==r&&(dz(e),dq(e)),s=s.next(()=>dK(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>dB(e,i))),s=s.next(()=>{dH(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(dV(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{d$(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{dG(e),dW(e)})),r<12&&n>=12&&(s=s.next(()=>{dJ(e)})),r<13&&n>=13&&(s=s.next(()=>dU(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(nG))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>dQ(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(iA).clear()}).next(()=>{t.objectStore(iN).clear()})),r<17&&n>=17&&(s=s.next(()=>{dY(e)})),r<18&&n>=18&&eo()&&(s=s.next(()=>{t.objectStore(iA).clear()}).next(()=>{t.objectStore(iN).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(nG).iterate((e,r)=>{t+=hF(r)}).next(()=>{let r={byteSize:t};return e.store(ii).put(is,r)})}removeAcknowledgedMutations(e){let t=e.store(nJ),r=e.store(nX);return t.loadAll().next(t=>nb.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,sI],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(n0,n).next(r=>nb.forEach(r,r=>{rs(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=uf(this.serializer,r);return hL(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(iu),r=e.store(nG);return e.store(ig).get(im).next(e=>{let n=r=>t.put({targetId:0,path:nz(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new rH(e),a=dM(s);i.push(t.get(a).next(e=>e?nb.resolve():n(s)))}).next(()=>nb.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(iy,{keyPath:iv});let r=t.store(iy),n=new hk,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:nz(n)})}};return t.store(nG).iterate({keysOnly:!0},(e,t)=>i(new rH(e).popLast())).next(()=>t.store(n5).iterate({keysOnly:!0},([e,t,r],n)=>i(nH(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(ia);return t.iterate((e,r)=>{let n=up(r),i=um(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(nG),n=[];return r.iterate((e,r)=>{let i=t.store(n8),s=dX(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>nb.waitFor(n))}runOverlayMigration(e,t){let r=t.store(nX),n=ds(this.serializer),i=new dx(dO.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??o$();uf(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),nb.forEach(r,(e,r)=>{let s=new t3(r),a=uN.forUser(this.serializer,s),o=i.getIndexManager(s);return new dg(n,hB.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new i0(t,nB.INVALID),e).next()})})}}function dM(e){return[0,nz(e)]}function dL(e){e.createObjectStore(nW)}function dF(e){e.createObjectStore(nJ,{keyPath:nY}),e.createObjectStore(nX,{keyPath:nZ,autoIncrement:!0}).createIndex(n0,n1,{unique:!0}),e.createObjectStore(n5)}function dB(e,t){return t.store(nX).loadAll().next(r=>{e.deleteObjectStore(nX),e.createObjectStore(nX,{keyPath:nZ,autoIncrement:!0}).createIndex(n0,n1,{unique:!0});let n=t.store(nX),i=r.map(e=>n.put(e));return nb.waitFor(i)})}function dj(e){e.createObjectStore(nG)}function dU(e){let t=e.createObjectStore(n8,{keyPath:n7});t.createIndex(n9,ie),t.createIndex(it,ir)}function dV(e){e.createObjectStore(ii)}function dq(e){e.createObjectStore(iu,{keyPath:ih}).createIndex(id,ip,{unique:!0}),e.createObjectStore(ia,{keyPath:io}).createIndex(il,ic,{unique:!0}),e.createObjectStore(ig)}function dz(e){e.deleteObjectStore(iu),e.deleteObjectStore(ia),e.deleteObjectStore(ig)}function d$(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function dK(e){let t=e.store(ig),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ne.min().toTimestamp(),targetCount:0};return t.put(im,r)}function dH(e){e.createObjectStore(ib,{keyPath:iS})}function dG(e){e.createObjectStore(iw,{keyPath:iT})}function dW(e){e.createObjectStore(iC,{keyPath:iE})}function dQ(e){e.createObjectStore(i_,{keyPath:iI,autoIncrement:!0}).createIndex(ik,iR,{unique:!1}),e.createObjectStore(iA,{keyPath:ix}).createIndex(iD,iO,{unique:!1}),e.createObjectStore(iN,{keyPath:iP}).createIndex(iM,iL,{unique:!1})}function dJ(e){let t=e.createObjectStore(iF,{keyPath:iB});t.createIndex(ij,iU,{unique:!1}),t.createIndex(iV,iq,{unique:!1})}function dY(e){e.createObjectStore(iz,{keyPath:i$})}function dX(e){return e.document?new rQ(rH.fromString(e.document.name).popFirst(5)):e.noDocument?rQ.fromSegments(e.noDocument.path):e.unknownDocument?rQ.fromSegments(e.unknownDocument.path):rn(36783)}let dZ="IndexedDbPersistence",d0=18e5,d1=5e3,d2=4e3,d3="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",d6="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",d4="firestore_zombie",d5="main";class d8{constructor(e,t,r,n,i,s,a,o,l,c,u=dp){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=c,this.schemaVersion=u,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=e=>Promise.resolve(),!d8.isAvailable())throw new rE(rS,d6);this.referenceDelegate=new h9(this,n),this.dbName=t+d5,this.serializer=new us(o),this.simpleDb=new nC(this.dbName,this.schemaVersion,new dP(this.serializer)),this.globalsCache=new uM,this.targetCache=new hH(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ds(this.serializer),this.bundleCache=new ux,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===c&&re(dZ,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rE(ry,d3);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new nB(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>d9(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(nk(e))return t9(dZ,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return t9(dZ,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return d7(e).get(nQ).next(e=>nb.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return d9(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,d0)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=i1(e,ib);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,d0),n=e.filter(e=>-1===r.indexOf(e));return nb.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",d2,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?nb.resolve(!0):d7(e).get(nQ).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,d1)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rE(ry,d3);return!1}}return!!this.networkEnabled&&!!this.inForeground||d9(e).loadAll().next(e=>void 0===this.filterActiveClients(e,d1).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&t9(dZ,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[nW,ib],e=>{let t=new i0(e,nB.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>d9(e).loadAll().next(e=>this.filterActiveClients(e,d0).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return hB.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hx(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return uN.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;t9(dZ,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=iZ(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new i0(i,this.listenSequence?this.listenSequence.next():nB.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rE(ry,ng);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return d7(e).get(nQ).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,d1)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rE(ry,d3)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return d7(e).put(nQ,t)}static isAvailable(){return nC.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=d7(e);return t.get(nQ).next(e=>this.isLocalClient(e)?(t9(dZ,"Releasing primary lease."),t.delete(nQ)):nb.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(re(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;ea()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return t9(dZ,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return re(dZ,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){re("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${d4}_${this.persistenceKey}_${e}`}}function d7(e){return i1(e,nW)}function d9(e){return i1(e,ib)}function fe(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function ft(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function fr(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let fn="LocalStore",fi=3e8;class fs{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new i5(rF),this.targetIdByTarget=new oD(e=>a0(e),a2),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dg(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function fa(e,t,r,n){return new fs(e,t,r,n)}async function fo(e,t){let r=ra(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=o$();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function fl(e,t){let r,n,i=ra(e),s=r9.now(),a=t.reduce((e,t)=>e.add(t.key),o$());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=oN(),l=o$();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=lu(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new lm(e.key,t,ay(t.value.mapValue),li.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:oF(r)}))}function fc(e,t){let r=ra(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fC(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,fu(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function fu(e){let t=o$();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function fh(e,t){let r=ra(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(rs(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function fd(e){let t=ra(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function ff(e,t){let r=ra(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(so.EMPTY_BYTE_STRING,ne.min()).withLastLimboFreeSnapshotVersion(ne.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),i=i.insert(o,c),fm(l,c,s)&&a.push(r.targetCache.updateTargetData(e,c))});let o=oN(),l=o$();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(fp(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(ne.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return nb.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function fp(e,t,r){let n=o$(),i=o$();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oN();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(ne.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):t9(fn,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function fm(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=fi)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function fg(e,t){let r=ra(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>nb.forEach(t,t=>nb.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>nb.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(nk(e))t9(fn,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function fy(e,t){let r=ra(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=sI),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function fv(e,t){let r=ra(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function fb(e,t){let r=ra(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,nb.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new ui(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function fS(e,t,r){let n=ra(e),i=n.targetIdByTarget.get(r);return void 0!==i?nb.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function fw(e,t,r){let n=ra(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(nk(e))t9(fn,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function fT(e,t,r){let n=ra(e),i=ne.min(),s=o$();return n.persistence.runTransaction("Execute query","readwrite",e=>fS(n,e,od(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:ne.min(),r?s:o$())).next(e=>(fA(n,oR(t),e),{documents:e,remoteKeys:s})))}function fC(e,t,r,n){let i=r.batch,s=i.keys(),a=nb.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);rs(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fE(e,t){let r=ra(e),n=ra(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):nb.resolve(null)))}function f_(e,t){ra(ra(e,fs).mutationQueue).removeCachedMutationKeys(t)}function fI(e){return ra(ra(e,fs).persistence).getActiveClients()}function fk(e,t){let r=ra(e),n=ra(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function fR(e,t){let r=ra(e),n=r.collectionGroupReadTime.get(t)||ne.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,nd(n,nt),Number.MAX_SAFE_INTEGER)).then(e=>(fA(r,t,e),e))}function fA(e,t,r){let n=e.collectionGroupReadTime.get(t)||ne.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function fx(e){return od(os(rH.fromString(`__bundle__/docs/${e}`)))}async function fD(e,t,r,n){let i=ra(e),s=o$(),a=oN();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await fb(i,fx(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>fp(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function fO(e,t){let r=ra(e),n=cr(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function fN(e,t){let r=ra(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function fP(e,t){let r=ra(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function fM(e,t,r=o$()){let n=await fb(e,od(uw(t.bundledQuery))),i=ra(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=cr(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(so.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function fL(e,t){let r=ra(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>ft(r,t,no,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>nb.waitFor(i)))}function fF(e,t){ra(e).queryEngine.indexAutoCreationEnabled=t}function fB(e){let t=ra(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class fj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let fU=100;function fV(){return ea()?8:nE(X())>0?6:4}class fq{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=fU,this.relativeIndexReadCostPerDocument=fV()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new fj;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(t7()<=o.DEBUG&&t9("QueryEngine","SDK will not create cache indexes for query:",oT(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),nb.resolve()):(t7()<=o.DEBUG&&t9("QueryEngine","Query:",oT(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(t7()<=o.DEBUG&&t9("QueryEngine","The SDK decides to create cache indexes for query:",oT(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,od(t))):nb.resolve()}performQueryUsingIndex(e,t){if(oo(t))return nb.resolve(null);let r=od(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=od(t=oy(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=o$(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,oy(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return oo(t)||n.isEqual(ne.min())?nb.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?nb.resolve(null):(t7()<=o.DEBUG&&t9("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oT(t)),this.appendRemainingResults(e,s,t,nd(n,nt)).next(e=>e))})}applyQuery(e,t){let r=new se(oA(e));return t.forEach((t,n)=>{oC(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return t7()<=o.DEBUG&&t9("QueryEngine","Using full collection scan to execute query:",oT(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,np.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fz="firestore_clients";function f$(e,t){return`${fz}_${e}_${t}`}let fK="firestore_mutations";function fH(e,t,r){let n=`${fK}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let fG="firestore_targets";function fW(e,t){return`${fG}_${e}_${t}`}let fQ="firestore_online_state";function fJ(e){return`${fQ}_${e}`}let fY="firestore_bundle_loaded_v2";function fX(e){return`${fY}_${e}`}let fZ="firestore_sequence_number";function f0(e){return`${fZ}_${e}`}let f1="SharedClientState";class f2{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new rE(i.error.code,i.error.message)),s)?new f2(e,t,i.state,n):(re(f1,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class f3{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rE(n.error.code,n.error.message)),i)?new f3(e,n.state,r):(re(f1,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class f6{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=oH();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sA(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new f6(e,i):(re(f1,`Failed to parse client data for instance '${e}': ${t}`),null)}}class f4{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new f4(t.clientId,t.onlineState):(re(f1,`Failed to parse online state: ${e}`),null)}}class f5{constructor(){this.activeTargetIds=oH()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class f8{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new i5(rF),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=f$(this.persistenceKey,this.localClientId),this.sequenceNumberKey=f0(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new f5),this.clientStateKeyRe=RegExp(`^${fz}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${fK}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${fG}_${s}_(\\d+)$`),this.onlineStateKey=fJ(this.persistenceKey),this.bundleLoadedKey=fX(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(f$(this.persistenceKey,e));if(t){let r=f6.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(fW(this.persistenceKey,e));if(t){let n=f3.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fW(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return t9(f1,"READ",e,t),t}setItem(e,t){t9(f1,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){t9(f1,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(t9(f1,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=f7(t.newValue);e!==nB.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new f2(this.currentUser,e,t,r),i=fH(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=fH(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=fW(this.persistenceKey,e),i=new f3(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return f6.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return f2.fromWebStorageEntry(new t3(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return f3.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return f4.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void t9(f1,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=oH();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function f7(e){let t=nB.INVALID;if(null!=e)try{let r=JSON.parse(e);rs("number"==typeof r,30636,{seqString:e}),t=r}catch(e){re(f1,"Failed to read sequence number from WebStorage",e)}return t}class f9{constructor(){this.localState=new f5,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new f5,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pe{addCallback(e){}shutdown(){}}class pt{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let pr=null;function pn(){return 0x10000000+Math.round(0x80000000*Math.random())}function pi(){return null===pr?pr=pn():pr++,"0x"+pr.toString(16)}function ps(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let pa="1.9.15",po="GrpcConnection",pl=`gl-node/${process.versions.node} fire/${t6} grpc/${pa}`;function pc(e,t,r,n,i){rs(null===t||"OAuth"===t.type,36936);let s=new t1.Metadata;return t&&t.headers.forEach((e,t)=>s.set(t,e)),r&&r.headers.forEach((e,t)=>s.set(t,e)),n&&s.set("X-Firebase-GMPID",n),s.set("X-Goog-Api-Client",pl),s.set("Google-Cloud-Resource-Prefix",e),s.set("x-goog-request-params",e),i&&s.set("X-Goog-Api-Key",i),s}class pu{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){t9(po,"Creating Firestore stub.");let e=this.databaseInfo.ssl?t1.credentials.createSsl():t1.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=pi(),a=this.ensureActiveStub(),o=pc(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),l={database:this.databasePath,...r};return ps(t=>(t9(po,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(t9(po,`RPC '${e}' ${s} failed with error:`,r),t(new rE(lD(r.code),r.message))):(t9(po,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=pi(),o=[],l=new r_;t9(po,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let c=this.ensureActiveStub(),u=pc(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),h={...r,database:this.databasePath},d=c[e](h,u),f=!1;return d.on("data",t=>{t9(po,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{t9(po,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{t9(po,`RPC '${e}' ${a} failed with error:`,t);let r=lD(t.code);l.reject(new rE(r,t.message))}),l.promise}openStream(e,t,r){let n=pi(),i=this.ensureActiveStub(),s=pc(this.databasePath,t,r,this.databaseInfo.appId,this.databaseInfo.apiKey),a=i[e](s),o=!1,l=e=>{o||(o=!0,c.callOnClose(e),a.end())},c=new pt({sendFn:t=>{if(o)t9(po,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{t9(po,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw re("Failure sending:",t),re("Error:",e),e}}},closeFn:()=>{t9(po,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),u=!1;return a.on("data",t=>{o||(t9(po,`RPC '${e}' stream ${n} received:`,t),u||(c.callOnConnected(),u=!0),c.callOnMessage(t))}),a.on("end",()=>{t9(po,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(rt(po,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new rE(lD(t.code),t.message)))}),t9(po,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{c.callOnOpen()},0),c}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let ph={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var pd={nested:ph},pf=Object.freeze({__proto__:null,nested:ph,default:pd});let pp={longs:String,enums:String,defaults:!0,oneofs:!1};function pm(){let e=t2.fromJSON(pf,pp);return t1.loadPackageDefinition(e)}function pg(e){return new pu(pm(),e)}function py(){return new pe}function pv(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function pb(){return null}function pS(e){return new l3(e,!1)}let pw="ExponentialBackoff",pT=1e3,pC=1.5,pE=6e4;class p_{constructor(e,t,r=pT,n=pC,i=pE){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&t9(pw,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let pI="PersistentStream",pk=6e4,pR=1e4;class pA{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new p_(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pk,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===rg?(re(t.toString()),re("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===rm&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new rE(rc,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pR,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return t9(pI,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(t9(pI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class px extends pA{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=cb(this.serializer,e),r=cw(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=cu(this.serializer),t.addTarget=cB(this.serializer,e);let r=cL(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=cu(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class pD extends pA{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return rs(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rs(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){rs(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=ck(e.writeResults,e.commitTime),r=cr(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=cu(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>cT(this.serializer,e))};this.sendRequest(t)}}class pO{}class pN extends pO{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rE(ry,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,ci(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rm&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rE(rc,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,ci(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rm&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rE(rc,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function pP(e,t,r,n){return new pN(e,t,r,n)}async function pM(e,t){let r=ra(e),n={writes:t.map(e=>cT(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,rH.emptyPath(),n)}async function pL(e,t){let r=ra(e),n={documents:t.map(e=>ca(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,rH.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=cv(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());rs(!!t,55234,{key:e}),a.push(t)}),a}async function pF(e,t,r){let n=ra(e),{request:i,aliasMap:s,parent:a}=cN(n.serializer,of(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);rs(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function pB(e,t,r){let n=ra(e);return n.verifyInitialized(),new pD(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function pj(e,t,r){let n=ra(e);return n.verifyInitialized(),new px(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let pU="OnlineStateTracker",pV=1,pq=1e4;class pz{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",pq,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${pq/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=pV&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${pV} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(re(t),this.shouldWarnClientIsOffline=!1):t9(pU,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let p$="RemoteStore",pK=10;class pH{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{p3(this)&&(t9(p$,"Restarting streams for network reachability change."),await mf(this))})}),this.onlineStateTracker=new pz(r,n)}}function pG(e,t,r,n,i){return new pH(e,t,r,n,i)}async function pW(e){if(p3(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function pQ(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function pJ(e){let t=ra(e);t9(p$,"RemoteStore shutting down."),t.offlineCauses.add(5),await pQ(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function pY(e,t){let r=ra(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),p2(r)?p1(r):mg(r).isOpen()&&pZ(r,t))}function pX(e,t){let r=ra(e),n=mg(r);r.listenTargets.delete(t),n.isOpen()&&p0(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():p3(r)&&r.onlineStateTracker.set("Unknown"))}function pZ(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ne.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}mg(e).watch(t)}function p0(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),mg(e).unwatch(t)}function p1(e){e.watchChangeAggregator=new lQ({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),mg(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function p2(e){return p3(e)&&!mg(e).isStarted()&&e.listenTargets.size>0}function p3(e){return 0===ra(e).offlineCauses.size}function p6(e){e.watchChangeAggregator=void 0}async function p4(e){e.onlineStateTracker.set("Online")}async function p5(e){e.listenTargets.forEach((t,r)=>{pZ(e,t)})}async function p8(e,t){p6(e),p2(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),p1(e)):e.onlineStateTracker.set("Unknown")}async function p7(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof lH&&2===t.state&&t.cause){try{await mr(e,t)}catch(r){t9(p$,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await p9(e,r)}return}if(t instanceof l$?e.watchChangeAggregator.handleDocumentChange(t):t instanceof lK?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(ne.min()))try{let t=await fd(e.localStore);r.compareTo(t)>=0&&await mt(e,r)}catch(t){t9(p$,"Failed to raise snapshot:",t),await p9(e,t)}}async function p9(e,t,r){if(nk(t))e.offlineCauses.add(1),await pQ(e),e.onlineStateTracker.set("Offline"),r||(r=()=>fd(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{t9(p$,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await pW(e)});else throw t}function me(e,t){return t().catch(r=>p9(e,r,t))}function mt(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(so.EMPTY_BYTE_STRING,n.snapshotVersion)),p0(e,t),pZ(e,new ui(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function mr(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function mn(e){let t=ra(e),r=my(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:sI;for(;mi(t);)try{let e=await fy(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,ms(t,e)}catch(e){await p9(t,e)}ma(t)&&mo(t)}function mi(e){return p3(e)&&e.writePipeline.length<pK}function ms(e,t){e.writePipeline.push(t);let r=my(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function ma(e){return p3(e)&&!my(e).isStarted()&&e.writePipeline.length>0}function mo(e){my(e).start()}async function ml(e){my(e).writeHandshake()}async function mc(e){let t=my(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function mu(e,t,r){let n=e.writePipeline.shift(),i=lI.from(n,t,r);await me(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await mn(e)}async function mh(e,t){t&&my(e).handshakeComplete&&await md(e,t),ma(e)&&mo(e)}async function md(e,t){if(lx(t.code)){let r=e.writePipeline.shift();my(e).inhibitBackoff(),await me(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await mn(e)}}async function mf(e){let t=ra(e);t.offlineCauses.add(4),await pQ(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await pW(t)}async function mp(e,t){let r=ra(e);r.asyncQueue.verifyOperationInProgress(),t9(p$,"RemoteStore received new credentials");let n=p3(r);r.offlineCauses.add(3),await pQ(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await pW(r)}async function mm(e,t){let r=ra(e);t?(r.offlineCauses.delete(2),await pW(r)):t||(r.offlineCauses.add(2),await pQ(r),r.onlineStateTracker.set("Unknown"))}function mg(e){return e.watchStream||(e.watchStream=pj(e.datastore,e.asyncQueue,{onConnected:p4.bind(null,e),onOpen:p5.bind(null,e),onClose:p8.bind(null,e),onWatchChange:p7.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),p2(e)?p1(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),p6(e))})),e.watchStream}function my(e){return e.writeStream||(e.writeStream=pB(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:ml.bind(null,e),onClose:mh.bind(null,e),onHandshakeComplete:mc.bind(null,e),onMutationResult:mu.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await mn(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(t9(p$,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let mv="AsyncQueue";class mb{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new r_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new mb(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rE(rl,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mS(e,t){if(re(mv,`${t}: ${e}`),nk(e))return new rE(rT,`${t}: ${e}`);throw e}class mw{static emptySet(e){return new mw(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||rQ.comparator(t.key,r.key):this.comparator=(e,t)=>rQ.comparator(e.key,t.key),this.keyedMap=oM(),this.sortedSet=new i5(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mw)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new mw;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class mT{constructor(){this.changeMap=new i5(rQ.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):rn(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class mC{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new mC(e,t,mw.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!oS(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class mE{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function m_(){return new mI}class mI{constructor(){this.queries=mk(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){mM(this,new rE(rv,"Firestore shutting down"))}}function mk(){return new oD(e=>ow(e),oS)}async function mR(e,t){let r=ra(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new mE,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=mS(r,`Initialization of query '${oT(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&mL(r)}async function mA(e,t){let r=ra(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function mx(e,t){let r=ra(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&mL(r)}function mD(e,t,r){let n=ra(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function mO(e,t){let r=ra(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&mL(r)}function mN(e,t){ra(e).snapshotsInSyncListeners.add(t),t.next()}function mP(e,t){ra(e).snapshotsInSyncListeners.delete(t)}function mM(e,t){let r=ra(e),n=r.queries;r.queries=mk(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function mL(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(h||(h={}));class mF{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new mC(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=mC.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==h.Cache}}class mB{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=o$(),n=o$();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new mB(e,t.fromCache,r,n)}}class mj{constructor(e){this.serializer=e}toDocumentKey(e){return co(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?cm(this.serializer,e.document,!1):av.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return cr(e)}}class mU{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=mV(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=rH.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new mj(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||o$()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await fD(e,new mj(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await fM(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function mV(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function mq(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class mz{constructor(e){this.key=e}}class m${constructor(e){this.key=e}}class mK{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=o$(),this.mutatedKeys=o$(),this.docComparator=oA(e),this.documentSet=new mw(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new mT,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let c=n.get(e),u=oC(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(r.track({type:3,doc:u}),f=!0):!this.shouldWaitForSyncedDocument(c,u)&&(r.track({type:2,doc:u}),f=!0,(o&&this.docComparator(u,o)>0||l&&0>this.docComparator(u,l))&&(a=!0)):!c&&u?(r.track({type:0,doc:u}),f=!0):c&&!u&&(r.track({type:1,doc:c}),f=!0,(o||l)&&(a=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>mH(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new mC(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new mT,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=o$(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new m$(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new mz(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=o$();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return mC.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function mH(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rn(20277,{change:e})}};return r(e)-r(t)}let mG="SyncEngine";class mW{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class mQ{constructor(e){this.key=e,this.receivedDocument=!1}}class mJ{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new oD(e=>ow(e),oS),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new i5(rQ.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dS,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=hK.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function mY(e,t,r,n,i,s,a){let o=new mJ(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function mX(e,t,r=!0){let n,i=gC(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await m0(i,t,r,!0),n}async function mZ(e,t){let r=gC(e);await m0(r,t,!0,!1)}async function m0(e,t,r,n){let i,s=await fb(e.localStore,od(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await m1(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&pY(e.remoteStore,s),i}async function m1(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>gu(e,t,r,n);let s=await fT(e.localStore,t,!0),a=new mK(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=lz.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,l);ga(e,r,c.limboChanges);let u=new mW(t,r,a);return e.queryViewsByQuery.set(t,u),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),c.snapshot}async function m2(e,t,r){let n=ra(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!oS(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await fw(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&pX(n.remoteStore,i.targetId),gi(n,i.targetId)}).catch(nv)):(gi(n,i.targetId),await fw(n.localStore,i.targetId,!0))}async function m3(e,t){let r=ra(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),pX(r.remoteStore,n.targetId))}async function m6(e,t,r){let n=gE(e);try{let e=await fl(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),gr(n,e.batchId,r),await gc(n,e.changes),await mn(n.remoteStore)}catch(t){let e=mS(t,"Failed to persist write");r.reject(e)}}async function m4(e,t){let r=ra(e);try{let e=await ff(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(rs(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?rs(n.receivedDocument,14607):e.removedDocuments.size>0&&(rs(n.receivedDocument,42227),n.receivedDocument=!1))}),await gc(r,e,t)}catch(e){await nv(e)}}function m5(e,t,r){let n=ra(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),mO(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function m8(e,t,r){let n=ra(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new i5(rQ.comparator);e=e.insert(s,av.newNoDocument(s,ne.min()));let r=o$().add(s),i=new lq(ne.min(),new Map,new i5(rF),e,r);await m4(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),gl(n)}else await fw(n.localStore,t,!1).then(()=>gi(n,t,r)).catch(nv)}async function m7(e,t){let r=ra(e),n=t.batch.batchId;try{let e=await fc(r.localStore,t);gn(r,n,null),ge(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await gc(r,e)}catch(e){await nv(e)}}async function m9(e,t,r){let n=ra(e);try{let e=await fh(n.localStore,t);gn(n,t,r),ge(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await gc(n,e)}catch(e){await nv(e)}}function ge(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function gt(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rE(rl,t))})}),e.pendingWritesCallbacks.clear()}function gr(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new i5(rF)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function gn(e,t,r){let n=ra(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function gi(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||gs(e,t)})}function gs(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(pX(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),gl(e))}function ga(e,t,r){for(let n of r)n instanceof mz?(e.limboDocumentRefs.addReference(n.key,t),go(e,n)):n instanceof m$?(t9(mG,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||gs(e,n.key)):rn(19791,{limboChange:n})}function go(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(t9(mG,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),gl(e))}function gl(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new rQ(rH.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new mQ(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),pY(e.remoteStore,new ui(od(os(r.path)),n,"TargetPurposeLimboResolution",nB.INVALID))}}async function gc(e,t,r){let n=ra(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=mB.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await fg(n.localStore,s))}async function gu(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await fT(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return ga(e,t.targetId,o.limboChanges),o.snapshot}async function gh(e,t){let r=ra(e);if(!r.currentUser.isEqual(t)){t9(mG,"User change. New user:",t.toKey());let e=await fo(r.localStore,t);r.currentUser=t,gt(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await gc(r,e.affectedDocuments)}}function gd(e,t){let r=ra(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return o$().add(n.key);{let e=o$(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function gf(e,t){let r=ra(e),n=await fT(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&ga(r,t.targetId,i.limboChanges),i}async function gp(e,t){let r=ra(e);return fR(r.localStore,t).then(e=>gc(r,e))}async function gm(e,t,r,n){let i=ra(e),s=await fE(i.localStore,t);null===s?t9(mG,"Cannot apply mutation batch with id: "+t):("pending"===r?await mn(i.remoteStore):"acknowledged"===r||"rejected"===r?(gn(i,t,n||null),ge(i,t),f_(i.localStore,t)):rn(6720,"Unknown batchState",{batchState:r}),await gc(i,s))}async function gg(e,t){let r=ra(e);if(gC(r),gE(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await gv(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await mm(r.remoteStore,!0),t))pY(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(gi(r,i),fw(r.localStore,i,!0))),pX(r.remoteStore,i)}),await t,await gv(r,e),gy(r),r._isPrimaryClient=!1,await mm(r.remoteStore,!1)}}function gy(e){let t=ra(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{pX(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new i5(rQ.comparator)}async function gv(e,t,r){let n=ra(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await fb(n.localStore,od(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await gf(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await fk(n.localStore,e);t=await fb(n.localStore,r),await m1(n,gb(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function gb(e){return oi(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gS(e){return fI(ra(e).localStore)}async function gw(e,t,r,n){let i=ra(e);if(i._isPrimaryClient)return void t9(mG,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await fR(i.localStore,oR(s[0])),n=lq.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,so.EMPTY_BYTE_STRING);await gc(i,e,n);break}case"rejected":await fw(i.localStore,t,!0),gi(i,t,n);break;default:rn(64155,r)}}async function gT(e,t,r){let n=gC(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){t9(mG,"Adding an already active target "+e);continue}let t=await fk(n.localStore,e),r=await fb(n.localStore,t);await m1(n,gb(t),r.targetId,!1,r.resumeToken),pY(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await fw(n.localStore,e,!1).then(()=>{pX(n.remoteStore,e),gi(n,e)}).catch(nv)}}function gC(e){let t=ra(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=m4.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=gd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=m8.bind(null,t),t.syncEngineListener.onWatchChange=mx.bind(null,t.eventManager),t.syncEngineListener.onWatchError=mD.bind(null,t.eventManager),t}function gE(e){let t=ra(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=m7.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=m9.bind(null,t),t}function g_(e,t,r){let n=ra(e);gI(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function gI(e,t,r){try{let n=await t.getMetadata();if(await fO(e.localStore,n))return await t.close(),r._completeWith(mq(n)),Promise.resolve(new Set);r._updateProgress(mV(n));let i=new mU(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await gc(e,a.changedDocs,void 0),await fN(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return rt(mG,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class gk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pS(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return fa(this.persistence,new fq,e.initialUser,this.serializer)}createPersistence(e){return new dx(dO.factory,this.serializer)}createSharedClientState(e){return new f9}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gk.provider={build:()=>new gk};class gR extends gk{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return rs(this.persistence.referenceDelegate instanceof dN,46915),new h5(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?hZ.withCacheSize(this.cacheSizeBytes):hZ.DEFAULT;return new dx(e=>dN.factory(e,t),this.serializer)}}class gA extends gk{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await gE(this.onlineComponentProvider.syncEngine),await mn(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return fa(this.persistence,new fq,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new h5(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nF(t,this.persistence);return new nL(e.asyncQueue,r)}createPersistence(e){let t=fe(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?hZ.withCacheSize(this.cacheSizeBytes):hZ.DEFAULT;return new d8(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,pv(),pb(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new f9}}class gx extends gA{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof f8&&(this.sharedClientState.syncEngine={applyBatchState:gm.bind(null,t),applyTargetState:gw.bind(null,t),applyActiveTargetsChange:gT.bind(null,t),getActiveClients:gS.bind(null,t),synchronizeWithChangedDocuments:gp.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await gg(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=pv();if(!f8.isAvailable(t))throw new rE(rS,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=fe(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new f8(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class gD{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>m5(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gh.bind(null,this.syncEngine),await mm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return m_()}createDatastore(e){let t=pS(e.databaseInfo.databaseId),r=pg(e.databaseInfo);return pP(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return pG(this.localStore,this.datastore,e.asyncQueue,e=>m5(this.syncEngine,e,0),py())}createSyncEngine(e,t){return mY(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await pJ(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}gD.provider={build:()=>new gD};let gO=10240;function gN(e,t=gO){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function gP(e,t){if(!(e instanceof Uint8Array))throw new rE(ru,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${r1(e)}`);return gN(e,t)}class gM{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):re("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class gL{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class gF{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new r_,this.buffer=new Uint8Array,this.textDecoder=lL(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new gL(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function gB(e,t){return new gF(e,t)}class gj{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new gL(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new rE(rw,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function gU(e,t){return new gj(e,t)}class gV{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new rE(ru,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await pL(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new lw(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=rQ.fromPath(t);this.mutations.push(new lE(r,this.precondition(r)))}),await pM(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=ne.min();else throw rn(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new rE(rv,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?li.none():t.isEqual(ne.min())?li.exists(!1):li.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return li.exists(!0);if(t.isEqual(ne.min()))throw new rE(ru,"Can't update a document that doesn't exist.");return li.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class gq{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new p_(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new gV(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(sk(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e?.name==="FirebaseError"){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lA(t)}return!1}}let gz="FirestoreClient",g$=100,gK=11,gH=20,gG=22;class gW{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=t3.UNAUTHENTICATED,this.clientId=rL.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{t9(gz,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(t9(gz,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:g$}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new r_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=mS(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function gQ(e,t){e.asyncQueue.verifyOperationInProgress(),t9(gz,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await fo(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gJ(e,t){e.asyncQueue.verifyOperationInProgress();let r=await gX(e);t9(gz,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>mp(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>mp(t.remoteStore,r)),e._onlineComponents=t}function gY(e){return"FirebaseError"===e.name?e.code===ry||e.code===rS:!("u">typeof DOMException&&e instanceof DOMException)||e.code===gG||e.code===gH||e.code===gK}async function gX(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){t9(gz,"Using user provided OfflineComponentProvider");try{await gQ(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!gY(t))throw t;rt("Error using user provided cache. Falling back to memory cache: "+t),await gQ(e,new gk)}}else t9(gz,"Using default OfflineComponentProvider"),await gQ(e,new gR(void 0));return e._offlineComponents}async function gZ(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(t9(gz,"Using user provided OnlineComponentProvider"),await gJ(e,e._uninitializedComponentsProvider._online)):(t9(gz,"Using default OnlineComponentProvider"),await gJ(e,new gD))),e._onlineComponents}function g0(e){return gX(e).then(e=>e.localStore)}function g1(e){return gZ(e).then(e=>e.syncEngine)}function g2(e){return gZ(e).then(e=>e.datastore)}async function g3(e){let t=await gZ(e),r=t.eventManager;return r.onListen=mX.bind(null,t.syncEngine),r.onUnlisten=m2.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=mZ.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=m3.bind(null,t.syncEngine),r}function g6(e,t,r,n){let i=new gM(n),s=new mF(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>mR(await g3(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>mA(await g3(e),s))}}function g4(e,t){let r=new r_;return e.asyncQueue.enqueueAndForget(async()=>yn(await g0(e),t,r)),r.promise}function g5(e,t,r={}){let n=new r_;return e.asyncQueue.enqueueAndForget(async()=>yi(await g3(e),e.asyncQueue,t,r,n)),n.promise}function g8(e,t){let r=new r_;return e.asyncQueue.enqueueAndForget(async()=>ys(await g0(e),t,r)),r.promise}function g7(e,t,r={}){let n=new r_;return e.asyncQueue.enqueueAndForget(async()=>ya(await g3(e),e.asyncQueue,t,r,n)),n.promise}function g9(e,t,r){let n=new r_;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await g2(e);n.resolve(pF(i,t,r))}catch(e){n.reject(e)}}),n.promise}function ye(e,t){let r=new r_;return e.asyncQueue.enqueueAndForget(async()=>m6(await g1(e),t,r)),r.promise}function yt(e,t){let r=new gM(t);return e.asyncQueue.enqueueAndForget(async()=>mN(await g3(e),r)),()=>{r.mute(),e.asyncQueue.enqueueAndForget(async()=>mP(await g3(e),r))}}function yr(e,t,r){let n=new r_;return e.asyncQueue.enqueueAndForget(async()=>{let i=await g2(e);new gq(e.asyncQueue,i,r,t,n).run()}),n.promise}async function yn(e,t,r){try{let n=await fv(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new rE(rT,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=mS(n,`Failed to get document '${t} from cache`);r.reject(e)}}function yi(e,t,r,n,i){let s=new gM({next:o=>{s.mute(),t.enqueueAndForget(()=>mA(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new rE(rT,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new rE(rT,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new mF(os(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mR(e,a)}async function ys(e,t,r){try{let n=await fT(e,t,!0),i=new mK(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=mS(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function ya(e,t,r,n,i){let s=new gM({next:r=>{s.mute(),t.enqueueAndForget(()=>mA(e,a)),r.fromCache&&"server"===n.source?i.reject(new rE(rT,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new mF(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mR(e,a)}function yo(e,t,r,n){let i=yc(r,pS(t));e.asyncQueue.enqueueAndForget(async()=>{g_(await g1(e),i,n)})}function yl(e,t){return e.asyncQueue.enqueue(async()=>fP(await g0(e),t))}function yc(e,t){let r;return gB(gP(r="string"==typeof e?lM().encode(e):e),t)}function yu(e,t){return gU(e,t)}function yh(e,t){return e.asyncQueue.enqueue(async()=>fL(await g0(e),t))}function yd(e,t){return e.asyncQueue.enqueue(async()=>fF(await g0(e),t))}function yf(e){return e.asyncQueue.enqueue(async()=>fB(await g0(e)))}function yp(e,t){return e.timeoutSeconds===t.timeoutSeconds}function ym(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let yg="ComponentProvider",yy=new Map;function yv(e){let t=yy.get(e);t&&(t9(yg,"Removing Datastore"),yy.delete(e),t.terminate())}function yb(e,t,r,n,i){return new sT(e,t,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,ym(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,n)}let yS="firestore.googleapis.com",yw=!0,yT=5,yC=30,yE=!0;class y_{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new rE(ru,"Can't provide ssl option if host option is not set");this.host=yS,this.ssl=yw}else this.host=e.host,this.ssl=e.ssl??yw;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=hX;else if(e.cacheSizeBytes!==hY&&e.cacheSizeBytes<h1)throw new rE(ru,`cacheSizeBytes must be at least ${h1}`);else this.cacheSizeBytes=e.cacheSizeBytes;rY("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yE:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ym(e.experimentalLongPollingOptions??{}),yI(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yp(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yI(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rE(ru,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yT)throw new rE(ru,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yT})`);if(e.timeoutSeconds>yC)throw new rE(ru,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yC})`)}}class yk{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new y_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rE(ry,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rE(ry,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new y_(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=rP(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return yv(this),Promise.resolve()}}function yR(e,t,r,n={}){e=r3(e,yk);let i=W(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(Q(`https://${o}`),Y("Firestore",!0)),s.host!==yS&&s.host!==o&&rt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!eg(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=t3.MOCK_USER;else{t=J(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new rE(ru,"mockUserToken must contain 'sub' or 'user_id' field!");r=new t3(i)}e._authCredentials=new rR(new rI(t,r))}}class yA{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yA(this.firestore,e,this._query)}}class yx{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yD(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yx(this.firestore,e,this._key)}toJSON(){return{type:yx._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(r5(t,yx._jsonSchema))return new yx(e,r||null,new rQ(rH.fromString(t.referencePath)))}}yx._jsonSchemaVersion="firestore/documentReference/1.0",yx._jsonSchema={type:r4("string",yx._jsonSchemaVersion),referencePath:r4("string")};class yD extends yA{constructor(e,t,r){super(e,t,os(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new yx(this.firestore,null,new rQ(e))}withConverter(e){return new yD(this.firestore,e,this._path)}}function yO(e,t,...r){if(e=ex(e),rJ("collection","path",t),e instanceof yk){let n=rH.fromString(t,...r);return rZ(n),new yD(e,null,n)}{if(!(e instanceof yx)&&!(e instanceof yD))throw new rE(ru,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rH.fromString(t,...r));return rZ(n),new yD(e.firestore,null,n)}}function yN(e,t,...r){if(e=ex(e),1==arguments.length&&(t=rL.newId()),rJ("doc","path",t),e instanceof yk){let n=rH.fromString(t,...r);return rX(n),new yx(e,null,new rQ(n))}{if(!(e instanceof yx)&&!(e instanceof yD))throw new rE(ru,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rH.fromString(t,...r));return rX(n),new yx(e.firestore,e instanceof yD?e.converter:null,new rQ(n))}}function yP(e,t){return e=ex(e),t=ex(t),e instanceof yA&&t instanceof yA&&e.firestore===t.firestore&&oS(e._query,t._query)&&e.converter===t.converter}let yM="AsyncQueue";class yL{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new p_(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new r_;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(nk(e))t9(yM,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,re("INTERNAL UNHANDLED ERROR: ",yF(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=mb.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&rn(47125,{messageOrStack:yF(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function yF(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class yB{constructor(){this._progressObserver={},this._taskCompletionResolver=new r_,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class yj extends yk{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new yL,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new yL(e),this._firestoreClient=void 0,await e}}}function yU(e,t){let r="object"==typeof e?e:tA(),n="string"==typeof e?e:t||sC,i=tg(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=K("firestore");e&&yR(i,...e)}return i}function yV(e){if(e._terminated)throw new rE(ry,"The client has already been terminated.");return e._firestoreClient||yq(e),e._firestoreClient}function yq(e){let t=e._freezeSettings(),r=yb(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new gW(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&yz(e._componentsProvider))}function yz(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function y$(e,t){let r=yV(e=r3(e,yj)),n=new yB;return yo(r,e._databaseId,t,n),n}function yK(e,t){return yl(yV(e=r3(e,yj)),t).then(t=>t?new yA(e,null,t.query):null)}class yH{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class yG{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yG(so.fromBase64String(e))}catch(e){throw new rE(ru,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new yG(so.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yG._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(r5(e,yG._jsonSchema))return yG.fromBase64String(e.bytes)}}yG._jsonSchemaVersion="firestore/bytes/1.0",yG._jsonSchema={type:r4("string",yG._jsonSchemaVersion),bytes:r4("string")};class yW{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rE(ru,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rW(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class yQ{constructor(e){this._methodName=e}}class yJ{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rE(ru,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rE(ru,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rF(this._lat,e._lat)||rF(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:yJ._jsonSchemaVersion}}static fromJSON(e){if(r5(e,yJ._jsonSchema))return new yJ(e.latitude,e.longitude)}}yJ._jsonSchemaVersion="firestore/geoPoint/1.0",yJ._jsonSchema={type:r4("string",yJ._jsonSchemaVersion),latitude:r4("number"),longitude:r4("number")};class yY{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return fr(this._values,e._values)}toJSON(){return{type:yY._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(r5(e,yY._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new yY(e.vectorValues);throw new rE(ru,"Expected 'vectorValues' field to be a number array")}}}yY._jsonSchemaVersion="firestore/vectorValue/1.0",yY._jsonSchema={type:r4("string",yY._jsonSchemaVersion),vectorValues:r4("object")};let yX=/^__.*__$/;class yZ{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new lm(e,this.data,this.fieldMask,t,this.fieldTransforms):new ld(e,this.data,t,this.fieldTransforms)}}class y0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new lm(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function y1(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rn(40011,{dataSource:e})}}class y2{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new y2({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vp(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(y1(this.dataSource)&&yX.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class y3{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pS(e)}createContext(e,t,r,n=!1){return new y2({dataSource:e,methodName:t,targetDoc:r,path:rW.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function y6(e){let t=e._freezeSettings(),r=pS(e._databaseId);return new y3(e._databaseId,!!t.ignoreUndefinedProperties,r)}function y4(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);vu("Data must be an object, but it was:",l,n);let c=vi(n,l);if(s.merge)a=new si(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=vh(t,n,r);if(!l.contains(i))throw new rE(ru,`Field '${i}' is specified in your field mask but missing from your input data.`);vm(e,i)||e.push(i)}a=new si(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new yZ(new ag(c),a,o)}class y5 extends yQ{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof y5}}function y8(e,t,r){return new y2({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class y7 extends yQ{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=y8(this,e,!0),r=new o2(this._elements.map(e=>vn(e,t)));return new le(e.path,r)}isEqual(e){return e instanceof y7&&eg(this._elements,e._elements)}}class y9 extends yQ{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new o5(e.serializer,oQ(e.serializer,this._operand));return new le(e.path,t)}isEqual(e){return e instanceof y9&&this._operand===e._operand}}function ve(e,t,r,n){let i=e.createContext(1,t,r);vu("Data must be an object, but it was:",i,n);let s=[],a=ag.empty();return i3(n,(e,n)=>{let o=vf(t,e,r);n=ex(n);let l=i.childContextForFieldPath(o);if(n instanceof y5)s.push(o);else{let e=vn(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new y0(a,new si(s),i.fieldTransforms)}function vt(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[vh(t,n,r)],l=[i];if(s.length%2!=0)throw new rE(ru,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vh(t,s[e])),l.push(s[e+1]);let c=[],u=ag.empty();for(let e=o.length-1;e>=0;--e)if(!vm(c,o[e])){let t=o[e],r=l[e];r=ex(r);let n=a.childContextForFieldPath(t);if(r instanceof y5)c.push(t);else{let e=vn(r,n);null!=e&&(c.push(t),u.set(t,e))}}return new y0(u,new si(c),a.fieldTransforms)}function vr(e,t,r,n=!1){return vn(r,e.createContext(n?4:3,t))}function vn(e,t){if(vc(e=ex(e)))return vu("Unsupported field value:",t,e),vi(e,t);if(e instanceof yQ)return va(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vo(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vs(e,t)}function vi(e,t){let r={};return i4(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):i3(e,(e,n)=>{let i=vn(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function vs(e,t){let r=[],n=0;for(let i of e){let e=vn(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function va(e,t){if(!y1(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function vo(e,t){if(null===(e=ex(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return oQ(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=r9.fromDate(e);return{timestampValue:l8(t.serializer,r)}}else if(e instanceof r9){let r=new r9(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:l8(t.serializer,r)}}else if(e instanceof yJ)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof yG)return{bytesValue:l9(t.serializer,e._byteString)};else if(e instanceof yx){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:cn(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof yY)return vl(e,t);else if(un(e))return e._toProto(t.serializer);else throw t.createError(`Unsupported field value: ${r1(e)}`)}function vl(e,t){return{mapValue:{fields:{[sx]:{stringValue:sN},[sP]:{arrayValue:{values:(e instanceof yY?e.toArray():e).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return oG(t.serializer,e)})}}}}}}function vc(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof r9)&&!(e instanceof yJ)&&!(e instanceof yG)&&!(e instanceof yx)&&!(e instanceof yQ)&&!(e instanceof yY)&&!un(e)}function vu(e,t,r){if(!vc(r)||!r0(r)){let n=r1(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function vh(e,t,r){if((t=ex(t))instanceof yW)return t._internalPath;if("string"==typeof t)return vf(e,t);throw vp("Field path arguments must be of type string or ",e,!1,void 0,r)}let vd=RegExp("[~\\*/\\[\\]]");function vf(e,t,r){if(t.search(vd)>=0)throw vp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new yW(...t.split("."))._internalPath}catch(n){throw vp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function vp(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new rE(ru,o+e+l)}function vm(e,t){return e.some(e=>e.isEqual(t))}class vg{convertValue(e,t="none"){switch(sL(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sd(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sf(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return i3(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new yY(e.fields?.[sP].arrayValue?.values?.map(e=>sd(e.doubleValue)))}convertGeoPoint(e){return new yJ(sd(e.latitude),sd(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sS(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(sw(e));default:return null}}convertTimestamp(e){let t=sh(e);return new r9(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=rH.fromString(e);rs(ur(r),9688,{name:e});let n=new sE(r.get(1),r.get(3)),i=new rQ(r.popFirst(5));return n.isEqual(t)||re(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class vy extends vg{constructor(e){super(),this.firestore=e}convertBytes(e){return new yG(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yx(this.firestore,null,t)}}function vv(...e){return new y7("arrayUnion",e)}function vb(e){return new y9("increment",e)}let vS="@firebase/firestore",vw="4.10.0";function vT(e,t=!0){t4(tI),tm(new eD("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new yj(new rA(e.getProvider("auth-internal")),new rN(i,e.getProvider("app-check-internal")),s_(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),tO(vS,vw,e),tO(vS,vw,"esm2020")}class vC{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class vE{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new ag({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class v_{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yx(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(vh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vI extends v_{data(){return super.data()}}function vk(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rE(rS,"limitToLast() queries require specifying at least one orderBy() clause")}class vR{}class vA extends vR{}function vx(e,t,...r){let n=[];for(let i of(t instanceof vR&&n.push(t),v4(n=n.concat(r)),n))e=i._apply(e);return e}class vD extends vA{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vD(e,t,r)}_apply(e){let t=this._parse(e);return v1(e._query,t),new yA(e.firestore,e.converter,om(e._query,t))}_parse(e){let t=y6(e.firestore);return vW(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vO(e,t,r){let n=t,i=vh("where",e);return vD._create(i,n,r)}class vN extends vR{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vN(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:aD.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(v2(e._query,t),new yA(e.firestore,e.converter,om(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function vP(...e){return e.forEach(e=>v6("or",e)),vN._create("or",e)}function vM(...e){return e.forEach(e=>v6("and",e)),vN._create("and",e)}class vL extends vA{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vL(e,t)}_apply(e){let t=vQ(e._query,this._field,this._direction);return new yA(e.firestore,e.converter,og(e._query,t))}}function vF(e,t="asc"){let r=t,n=vh("orderBy",e);return vL._create(n,r)}class vB extends vA{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new vB(e,t,r)}_apply(e){return new yA(e.firestore,e.converter,oy(e._query,this._limit,this._limitType))}}function vj(e){return r6("limit",e),vB._create("limit",e,"F")}function vU(e){return r6("limitToLast",e),vB._create("limitToLast",e,"L")}class vV extends vA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vV(e,t,r)}_apply(e){let t=vG(e,this.type,this._docOrFields,this._inclusive);return new yA(e.firestore,e.converter,ov(e._query,t))}}function vq(...e){return vV._create("startAt",e,!0)}function vz(...e){return vV._create("startAfter",e,!1)}class v$ extends vA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new v$(e,t,r)}_apply(e){let t=vG(e,this.type,this._docOrFields,this._inclusive);return new yA(e.firestore,e.converter,ob(e._query,t))}}function vK(...e){return v$._create("endBefore",e,!1)}function vH(...e){return v$._create("endAt",e,!0)}function vG(e,t,r,n){if(r[0]=ex(r[0]),r[0]instanceof v_)return vJ(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=y6(e.firestore);return vY(e._query,e.firestore._databaseId,i,t,r,n)}}function vW(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new rE(ru,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){vZ(a,s);let t=[];for(let r of a)t.push(vX(n,e,r));o={arrayValue:{values:t}}}else o=vX(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&vZ(a,s),o=vr(r,t,a,"in"===s||"not-in"===s);return ax.create(i,s,o)}function vQ(e,t,r){if(null!==e.startAt)throw new rE(ru,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rE(ru,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new a_(t,r)}function vJ(e,t,r,n,i){if(!n)throw new rE(rd,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of oh(e))if(r.field.isKeyField())s.push(ae(t,n.key));else{let e=n.data.field(r.field);if(sv(e))throw new rE(ru,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new rE(ru,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new aS(s,i)}function vY(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rE(ru,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rE(ru,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!ou(e)&&-1!==l.indexOf("/"))throw new rE(ru,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(rH.fromString(l));if(!rQ.isDocumentKey(r))throw new rE(ru,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new rQ(r);o.push(ae(t,i))}else{let e=vr(r,n,l);o.push(e)}}return new aS(o,s)}function vX(e,t,r){if("string"==typeof(r=ex(r))){if(""===r)throw new rE(ru,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ou(t)&&-1!==r.indexOf("/"))throw new rE(ru,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(rH.fromString(r));if(!rQ.isDocumentKey(n))throw new rE(ru,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ae(e,new rQ(n))}if(r instanceof yx)return ae(e,r._key);throw new rE(ru,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${r1(r)}.`)}function vZ(e,t){if(!Array.isArray(e)||0===e.length)throw new rE(ru,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function v0(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function v1(e,t){let r=v3(e.filters,v0(t.op));if(null!==r)if(r===t.op)throw new rE(ru,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new rE(ru,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function v2(e,t){let r=e;for(let e of t.getFlattenedFilters())v1(r,e),r=om(r,e)}function v3(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function v6(e,t){if(!(t instanceof vD)&&!(t instanceof vN))throw new rE(ru,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function v4(e){let t=e.filter(e=>e instanceof vN).length,r=e.filter(e=>e instanceof vD).length;if(t>1||t>0&&r>0)throw new rE(ru,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function v5(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class v8 extends vg{constructor(e){super(),this.firestore=e}convertBytes(e){return new yG(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yx(this.firestore,null,t)}}function v7(e){return new vC("sum",vh("sum",e))}function v9(e){return new vC("avg",vh("average",e))}function be(){return new vC("count")}function bt(e,t){return e instanceof vC&&t instanceof vC&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function br(e,t){return yP(e.query,t.query)&&eg(e.data(),t.data())}function bn(e){return bi(e,{count:be()})}function bi(e,t){let r=r3(e.firestore,yj),n=yV(r),i=i6(t,(e,t)=>new yH(t,e.aggregateType,e._internalFieldPath));return g9(n,e._query,i).then(t=>bs(r,e,t))}function bs(e,t,r){return new vE(t,new vy(e),r)}class ba{constructor(e){this.kind="memory",this._onlineComponentProvider=gD.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new gR(void 0)}}toJSON(){return{kind:this.kind}}}class bo{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=bg(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class bl{constructor(){this.kind="memoryEager",this._offlineComponentProvider=gk.provider}toJSON(){return{kind:this.kind}}}class bc{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new gR(e)}}toJSON(){return{kind:this.kind}}}function bu(){return new bl}function bh(e){return new bc(e?.cacheSizeBytes)}function bd(e){return new ba(e)}function bf(e){return new bo(e)}class bp{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gD.provider,this._offlineComponentProvider={build:t=>new gA(t,e?.cacheSizeBytes,this.forceOwnership)}}}class bm{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gD.provider,this._offlineComponentProvider={build:t=>new gx(t,e?.cacheSizeBytes)}}}function bg(e){return new bp(e?.forceOwnership)}function by(){return new bm}let bv=lM();function bb(e){let t=JSON.stringify(e),r=bv.encode(t).byteLength;return`${r}${t}`}bb({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),bb({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),bb({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),bb({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),bb({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),bb({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),bb({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),bb({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let bS=1;class bw{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new r9(0,0),this.databaseId=e._databaseId,this.serializer=new l3(this.databaseId,!0),this.userDataReader=new y3(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?l7(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:ca(this.serializer,e.documentKey),readTime:i?l8(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new r9(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=cO(this.serializer,od(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:l8(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=vi(e.documentData,t);return{name:ca(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:l8(this.serializer,e.versionTime),createTime:l8(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=bv.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:l8(this.serializer,this.latestReadTime),version:bS,totalDocuments:this.documents.size,totalBytes:bv.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function bT(e,t,r,n){let i=new bw(e,rL.newId());return i.addBundleDocument(bE(n,r,t)),i.build()}function bC(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(bE(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},c=new bw(e,r);return c.addBundleQuery(l),c.build()}function bE(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}let b_="NOT SUPPORTED";class bI{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bk extends v_{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new bA(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(vh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new rE(ry,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=bk._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=bT(this._firestore,e,r,this.ref.path),t}}function bR(e,t,r){if(r5(t,bk._jsonSchema)){if(t.bundle===b_)throw new rE(ru,"The provided JSON object was created in a client environment, which is not supported.");let n=pS(e._databaseId),i=yu(t.bundle,n),s=i.getElements(),a=new mU(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);let o=a.documents;if(1!==o.length)throw new rE(ru,`Expected bundle data to contain 1 document, but it contains ${o.length} documents.`);let l=cm(n,o[0].document),c=new rQ(rH.fromString(t.bundleName));return new bk(e,new v8(e),c,l,new bI(!1,!1),r||null)}}bk._jsonSchemaVersion="firestore/documentSnapshot/1.0",bk._jsonSchema={type:r4("string",bk._jsonSchemaVersion),bundleSource:r4("string","DocumentSnapshot"),bundleName:r4("string"),bundle:r4("string")};class bA extends bk{data(e={}){return super.data(e)}}class bx{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new bI(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bA(this._firestore,this._userDataWriter,r.key,r,new bI(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rE(ru,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=bO(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new rE(ry,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=bx._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rL.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=bC(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function bD(e,t,r){if(r5(t,bx._jsonSchema)){if(t.bundle===b_)throw new rE(ru,"The provided JSON object was created in a client environment, which is not supported.");let n=pS(e._databaseId),i=yu(t.bundle,n),s=i.getElements(),a=new mU(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);if(1!==a.queries.length)throw new rE(ru,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let o=uw(a.queries[0].bundledQuery),l=a.documents,c=new mw;l.map(e=>{let t=cm(n,e.document);c=c.add(t)});let u=mC.fromInitialDocuments(o,c,o$(),!1,!1),h=new yA(e,r||null,o);return new bx(e,new v8(e),h,u)}}function bO(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new bA(e._firestore,e._userDataWriter,r.doc.key,r.doc,new bI(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new bA(e._firestore,e._userDataWriter,t.doc.key,t.doc,new bI(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:bN(t.type),doc:n,oldIndex:i,newIndex:s}})}}function bN(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rn(61501,{type:e})}}function bP(e,t){return e instanceof bk&&t instanceof bk?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof bx&&t instanceof bx&&e._firestore===t._firestore&&yP(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}bx._jsonSchemaVersion="firestore/querySnapshot/1.0",bx._jsonSchema={type:r4("string",bx._jsonSchemaVersion),bundleSource:r4("string","QuerySnapshot"),bundleName:r4("string"),bundle:r4("string")};let bM={maxAttempts:5};function bL(e){if(e.maxAttempts<1)throw new rE(ru,"Max attempts must be at least 1")}class bF{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=y6(e)}set(e,t,r){this._verifyNotCommitted();let n=bB(e,this._firestore),i=v5(n.converter,t,r),s=y4(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,li.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=bB(e,this._firestore);return i="string"==typeof(t=ex(t))||t instanceof yW?vt(this._dataReader,"WriteBatch.update",s._key,t,r,n):ve(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,li.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=bB(e,this._firestore);return this._mutations=this._mutations.concat(new lw(t._key,li.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rE(ry,"A write batch can no longer be used after commit() has been called.")}}function bB(e,t){if((e=ex(e)).firestore===t)return e;throw new rE(ru,"Provided document reference is from a different Firestore instance.")}class bj{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=y6(e)}get(e){let t=bB(e,this._firestore),r=new v8(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rn(24041);let n=e[0];if(n.isFoundDocument())return new v_(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new v_(this._firestore,r,t._key,null,t.converter);throw rn(18433,{doc:n})})}set(e,t,r){let n=bB(e,this._firestore),i=v5(n.converter,t,r),s=y4(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=bB(e,this._firestore);return i="string"==typeof(t=ex(t))||t instanceof yW?vt(this._dataReader,"Transaction.update",s._key,t,r,n):ve(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=bB(e,this._firestore);return this._transaction.delete(t._key),this}}class bU extends bj{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=bB(e,this._firestore),r=new vy(this._firestore);return super.get(e).then(e=>new bk(this._firestore,r,t._key,e._document,new bI(!1,!1),t.converter))}}function bV(e,t,r){e=r3(e,yj);let n={...bM,...r};return bL(n),yr(yV(e),r=>t(new bU(e,r)),n)}function bq(e){return bz(e,["next","error","complete"])}function bz(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}function b$(e){e=r3(e,yx);let t=r3(e.firestore,yj);return g5(yV(t),e._key).then(r=>b6(t,e,r))}function bK(e){e=r3(e,yx);let t=r3(e.firestore,yj),r=yV(t),n=new vy(t);return g4(r,e._key).then(r=>new bk(t,n,e._key,r,new bI(null!==r&&r.hasLocalMutations,!0),e.converter))}function bH(e){e=r3(e,yx);let t=r3(e.firestore,yj);return g5(yV(t),e._key,{source:"server"}).then(r=>b6(t,e,r))}function bG(e){e=r3(e,yA);let t=r3(e.firestore,yj),r=yV(t),n=new vy(t);return vk(e._query),g7(r,e._query).then(r=>new bx(t,n,e,r))}function bW(e){e=r3(e,yA);let t=r3(e.firestore,yj),r=yV(t),n=new vy(t);return g8(r,e._query).then(r=>new bx(t,n,e,r))}function bQ(e){e=r3(e,yA);let t=r3(e.firestore,yj),r=yV(t),n=new vy(t);return g7(r,e._query,{source:"server"}).then(r=>new bx(t,n,e,r))}function bJ(e,t,r){e=r3(e,yx);let n=r3(e.firestore,yj),i=v5(e.converter,t,r),s=y4(y6(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,li.none());return b3(n,[s])}function bY(e,t,r,...n){let i;e=r3(e,yx);let s=r3(e.firestore,yj),a=y6(s);return b3(s,[(i="string"==typeof(t=ex(t))||t instanceof yW?vt(a,"updateDoc",e._key,t,r,n):ve(a,"updateDoc",e._key,t)).toMutation(e._key,li.exists(!0))])}function bX(e){return b3(r3(e.firestore,yj),[new lw(e._key,li.none())])}function bZ(e,t){let r=r3(e.firestore,yj),n=yN(e),i=v5(e.converter,t);return b3(r,[y4(y6(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,li.exists(!1))]).then(()=>n)}function b0(e,...t){let r,n,i;e=ex(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||bq(t[a])||(s=t[a++]);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bq(t[a])){let e=t[a];t[a]=e.next?.bind(e),t[a+1]=e.error?.bind(e),t[a+2]=e.complete?.bind(e)}if(e instanceof yx)n=r3(e.firestore,yj),i=os(e._key.path),r={next:r=>{t[a]&&t[a](b6(n,e,r))},error:t[a+1],complete:t[a+2]};else{let s=r3(e,yA);n=r3(s.firestore,yj),i=s._query;let o=new vy(n);r={next:e=>{t[a]&&t[a](new bx(n,o,s,e))},error:t[a+1],complete:t[a+2]},vk(e._query)}return g6(yV(n),i,o,r)}function b1(e,t,...r){let n,i=ex(e),s=b4(t);if(s.error)throw new rE(ru,s.error);let a=0;if("object"!=typeof r[0]||bq(r[a])||(n=r[a++]),"QuerySnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bq(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return b8(i,s,n,e,r[a])}if("DocumentSnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bq(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return b5(i,s,n,e,r[a])}throw new rE(ru,`unsupported bundle source: ${s.bundleSource}`)}function b2(e,t){return yt(yV(e=r3(e,yj)),bq(t)?t:{next:t})}function b3(e,t){return ye(yV(e),t)}function b6(e,t,r){let n=r.docs.get(t._key),i=new vy(e);return new bk(e,i,t._key,n,new bI(r.hasPendingWrites,r.fromCache),t.converter)}function b4(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}function b5(e,t,r,n,i){let s,a=!1;return y$(e,t.bundle).then(()=>{a||(s=b0(new yx(e,i||null,rQ.fromPath(t.bundleName)),r||{},n))}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function b8(e,t,r,n,i){let s,a=!1;return y$(e,t.bundle).then(()=>yK(e,t.bundleName)).then(e=>{if(e&&!a){let t=e;i&&t.withConverter(i),s=b0(e,r||{},n)}}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function b7(e){return yV(e=r3(e,yj)),new bF(e,t=>b3(e,t))}function b9(e,t){let r=yV(e=r3(e,yj));return r._uninitializedComponentsProvider&&"memory"!==r._uninitializedComponentsProvider._offline.kind?yh(r,Se(t)):(rt("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function Se(e){let t="string"==typeof e?St(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=Sr(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=vf("setIndexConfiguration",Sr(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new nc(e,2)):"ASCENDING"===t.order?n.push(new nc(e,0)):"DESCENDING"===t.order&&n.push(new nc(e,1))}r.push(new nn(nn.UNKNOWN_ID,t,n,nh.empty()))}return r}function St(e){try{return JSON.parse(e)}catch(e){throw new rE(ru,"Failed to parse JSON: "+e?.message)}}function Sr(e,t){if("string"!=typeof e[t])throw new rE(ru,"Missing string value for: "+t);return e[t]}class Sn{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Si(e){e=r3(e,yj);let t=Sc.get(e);if(t)return t;let r=yV(e);if(r._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new Sn(e);return Sc.set(e,n),n}function Ss(e){Sl(e,!0)}function Sa(e){Sl(e,!1)}function So(e){yf(yV(e._firestore)).then(e=>t9("deleting all persistent cache indexes succeeded")).catch(e=>rt("deleting all persistent cache indexes failed",e))}function Sl(e,t){yd(yV(e._firestore),t).then(e=>t9(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>rt(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let Sc=new WeakMap;class Su{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Sh.instance.onExistenceFilterMismatch(e)}}class Sh{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return Sd||lP(Sd=new Sh),Sd}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let Sd=null;function Sf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}vT("node"),e.s(["AggregateField",()=>vC,"AggregateQuerySnapshot",()=>vE,"DocumentSnapshot",()=>bk,"PersistentCacheIndexManager",()=>Sn,"QueryCompositeFilterConstraint",()=>vN,"QueryConstraint",()=>vA,"QueryDocumentSnapshot",()=>bA,"QueryEndAtConstraint",()=>v$,"QueryFieldFilterConstraint",()=>vD,"QueryLimitConstraint",()=>vB,"QueryOrderByConstraint",()=>vL,"QuerySnapshot",()=>bx,"QueryStartAtConstraint",()=>vV,"SnapshotMetadata",()=>bI,"Transaction",()=>bU,"WriteBatch",()=>bF,"_TestingHooks",()=>Su,"addDoc",()=>bZ,"aggregateFieldEqual",()=>bt,"aggregateQuerySnapshotEqual",()=>br,"and",()=>vM,"average",()=>v9,"count",()=>be,"deleteAllPersistentCacheIndexes",()=>So,"deleteDoc",()=>bX,"disablePersistentCacheIndexAutoCreation",()=>Sa,"documentSnapshotFromJSON",()=>bR,"enablePersistentCacheIndexAutoCreation",()=>Ss,"endAt",()=>vH,"endBefore",()=>vK,"executeWrite",()=>b3,"getAggregateFromServer",()=>bi,"getCountFromServer",()=>bn,"getDoc",()=>b$,"getDocFromCache",()=>bK,"getDocFromServer",()=>bH,"getDocs",()=>bG,"getDocsFromCache",()=>bW,"getDocsFromServer",()=>bQ,"getPersistentCacheIndexManager",()=>Si,"limit",()=>vj,"limitToLast",()=>vU,"memoryEagerGarbageCollector",()=>bu,"memoryLocalCache",()=>bd,"memoryLruGarbageCollector",()=>bh,"onSnapshot",()=>b0,"onSnapshotResume",()=>b1,"onSnapshotsInSync",()=>b2,"or",()=>vP,"orderBy",()=>vF,"persistentLocalCache",()=>bf,"persistentMultipleTabManager",()=>by,"persistentSingleTabManager",()=>bg,"query",()=>vx,"querySnapshotFromJSON",()=>bD,"runTransaction",()=>bV,"setDoc",()=>bJ,"setIndexConfiguration",()=>b9,"snapshotEqual",()=>bP,"startAfter",()=>vz,"startAt",()=>vq,"sum",()=>v7,"updateDoc",()=>bY,"where",()=>vO,"writeBatch",()=>b7],92178),e.i(92178);let Sp=Sf,Sm=new ef("auth","Firebase",Sf()),Sg=new eq("@firebase/auth");function Sy(e,...t){Sg.logLevel<=o.WARN&&Sg.warn(`Auth (${tI}): ${e}`,...t)}function Sv(e,...t){Sg.logLevel<=o.ERROR&&Sg.error(`Auth (${tI}): ${e}`,...t)}function Sb(e,...t){throw SC(e,...t)}function SS(e,...t){return SC(e,...t)}function Sw(e,t,r){return new ef("auth","Firebase",{...Sp(),[t]:r}).create(t,{appName:e.name})}function ST(e){return Sw(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function SC(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return Sm.create(e,...t)}function SE(e,t,...r){if(!e)throw SC(t,...r)}function S_(e){let t="INTERNAL ASSERTION FAILED: "+e;throw Sv(t),Error(t)}function SI(e,t){e||S_(t)}function Sk(){return"http:"===SR()||"https:"===SR()}function SR(){return"u">typeof self&&self.location?.protocol||null}function SA(){return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Sk()||ei()||"connection"in navigator))||navigator.onLine}function Sx(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class SD{constructor(e,t){this.shortDelay=e,this.longDelay=t,SI(t>e,"Short delay should be less than long delay!"),this.isMobile=Z()||es()}get(){return SA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function SO(e,t){SI(e.emulator,"Emulator should always be set here");let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class SN{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void S_("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void S_("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void S_("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let SP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},SM=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],SL=new SD(3e4,6e4);function SF(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function SB(e,t,r,n,i={}){return Sj(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=ev({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return en()||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&W(e.emulatorConfig.host)&&(l.credentials="include"),SN.fetch()(await SV(e,e.config.apiHost,r,a),l)})}async function Sj(e,t,r){e._canInitEmulator=!1;let n={...SP,...t};try{let t=new Sz(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw S$(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw S$(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw S$(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw S$(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw Sw(e,a,r);Sb(e,a)}}catch(t){if(t instanceof ed)throw t;Sb(e,"network-request-failed",{message:String(t)})}}async function SU(e,t,r,n,i={}){let s=await SB(e,t,r,n,i);return"mfaPendingCredential"in s&&Sb(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function SV(e,t,r,n){let i=`${t}${r}?${n}`,s=e,a=s.config.emulator?SO(e.config,i):`${e.config.apiScheme}://${i}`;return SM.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function Sq(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Sz{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(SS(this.auth,"network-request-failed")),SL.get())})}}function S$(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=SS(e,t,n);return i.customData._tokenResponse=r,i}function SK(e){return void 0!==e&&void 0!==e.enterprise}class SH{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Sq(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function SG(e,t){return SB(e,"GET","/v2/recaptchaConfig",SF(e,t))}async function SW(e,t){return SB(e,"POST","/v1/accounts:delete",t)}async function SQ(e,t){return SB(e,"POST","/v1/accounts:lookup",t)}function SJ(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function SY(e,t=!1){let r=ex(e),n=await r.getIdToken(t),i=SZ(n);SE(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:SJ(SX(i.auth_time)),issuedAtTime:SJ(SX(i.iat)),expirationTime:SJ(SX(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function SX(e){return 1e3*Number(e)}function SZ(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return Sv("JWT malformed, contained fewer than 3 sections"),null;try{let e=B(r);if(!e)return Sv("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return Sv("Caught error parsing JWT payload as JSON",e?.toString()),null}}function S0(e){let t=SZ(e);return SE(t,"internal-error"),SE(void 0!==t.exp,"internal-error"),SE(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function S1(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof ed&&S2(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function S2({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class S3{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class S6{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=SJ(this.lastLoginAt),this.creationTime=SJ(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function S4(e){let t=e.auth,r=await e.getIdToken(),n=await S1(e,SQ(t,{idToken:r}));SE(n?.users.length,t,"internal-error");let i=n.users[0];e._notifyReloadListener(i);let s=i.providerUserInfo?.length?S7(i.providerUserInfo):[],a=S8(e.providerData,s),o=e.isAnonymous,l=!(e.email&&i.passwordHash)&&!a?.length,c=!!o&&l;Object.assign(e,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new S6(i.createdAt,i.lastLoginAt),isAnonymous:c})}async function S5(e){let t=ex(e);await S4(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function S8(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function S7(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function S9(e,t){let r=await Sj(e,{},async()=>{let r=ev({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await SV(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&W(e.emulatorConfig.host)&&(o.credentials="include"),SN.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function we(e,t){return SB(e,"POST","/v2/accounts:revokeToken",SF(e,t))}class wt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){SE(e.idToken,"internal-error"),SE(void 0!==e.idToken,"internal-error"),SE(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):S0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){SE(0!==e.length,"internal-error");let t=S0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(SE(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await S9(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new wt;return r&&(SE("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(SE("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(SE("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wt,this.toJSON())}_performRefresh(){return S_("not implemented")}}function wr(e,t){SE("string"==typeof e||void 0===e,"internal-error",{appName:t})}class wn{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new S3(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new S6(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await S1(this,this.stsTokenManager.getToken(this.auth,e));return SE(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return SY(this,e)}reload(){return S5(this)}_assign(e){this!==e&&(SE(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new wn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){SE(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await S4(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tS(this.auth.app))return Promise.reject(ST(this.auth));let e=await this.getIdToken();return await S1(this,SW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;SE(u&&p,e,"internal-error");let m=wt.fromJSON(this.name,p);SE("string"==typeof u,e,"internal-error"),wr(r,e.name),wr(n,e.name),SE("boolean"==typeof h,e,"internal-error"),SE("boolean"==typeof d,e,"internal-error"),wr(i,e.name),wr(s,e.name),wr(a,e.name),wr(o,e.name),wr(l,e.name),wr(c,e.name);let g=new wn({uid:u,auth:e,email:n,emailVerified:h,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:c});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new wt;n.updateFromServerResponse(t);let i=new wn({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await S4(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];SE(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?S7(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new wt;a.updateFromIdToken(r);let o=new wn({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new S6(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let wi=new Map;function ws(e){SI(e instanceof Function,"Expected a class definition");let t=wi.get(e);return t?SI(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,wi.set(e,t)),t}class wa{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}wa.type="NONE";let wo=wa;function wl(e,t,r){return`firebase:${e}:${t}:${r}`}class wc{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=wl(this.userKey,n.apiKey,i),this.fullPersistenceKey=wl("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await SQ(this.auth,{idToken:e}).catch(()=>void 0);return t?wn._fromGetAccountInfoResponse(this.auth,t,e):null}return wn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new wc(ws(wo),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||ws(wo),s=wl(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await SQ(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await wn._fromGetAccountInfoResponse(e,r,t)}else n=wn._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new wc(i,e,r)}}function wu(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(wp(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(wh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(wg(t))return"Blackberry";if(wy(t))return"Webos";if(wd(t))return"Safari";if((t.includes("chrome/")||wf(t))&&!t.includes("edge/"))return"Chrome";if(wm(t))return"Android";let r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if(n?.length===2)return n[1]}return"Other"}function wh(e=X()){return/firefox\//i.test(e)}function wd(e=X()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function wf(e=X()){return/crios\//i.test(e)}function wp(e=X()){return/iemobile/i.test(e)}function wm(e=X()){return/android/i.test(e)}function wg(e=X()){return/blackberry/i.test(e)}function wy(e=X()){return/webos/i.test(e)}function wv(e,t=[]){let r;switch(e){case"Browser":r=wu(X());break;case"Worker":r=`${wu(X())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${tI}/${n}`}class wb{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function wS(e,t={}){return SB(e,"GET","/v2/passwordPolicy",SF(e,t))}let ww=6;class wT{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??ww,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class wC{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new w_(this),this.idTokenSubscription=new w_(this),this.beforeStateQueue=new wb(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Sm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ws(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await wc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await SQ(this,{idToken:e}),r=await wn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tS(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(SE(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await S4(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Sx()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tS(this.app))return Promise.reject(ST(this));let t=e?ex(e):null;return t&&SE(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&SE(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tS(this.app)?Promise.reject(ST(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tS(this.app)?Promise.reject(ST(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ws(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new wT(await wS(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ef("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await we(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ws(e)||this._popupRedirectResolver;SE(t,this,"argument-error"),this.redirectPersistenceManager=await wc.create(this,[ws(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(SE(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return SE(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(tS(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Sy(`Error while retrieving App Check token: ${e.error}`),e?.token}}function wE(e){return ex(e)}class w_{constructor(e){this.auth=e,this.observer=null,this.addObserver=ew(e=>this.observer=e)}get next(){return SE(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class wI{constructor(){this.enterprise=new wk}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class wk{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let wR="recaptcha-enterprise",wA="NO_RECAPTCHA";class wx{constructor(e){this.type=wR,this.auth=wE(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{SG(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new SH(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;SK(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(wA)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new wI().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{!t&&SK(window.grecaptcha)?n(r,e,i):i(Error("RecaptchaVerifier is only supported in browser"))}).catch(e=>{i(e)})})}}async function wD(e,t,r,n=!1,i=!1){let s,a=new wx(e);if(i)s=wA;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function wO(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await wD(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await wD(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await wD(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await wD(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await wD(e,t,r,!1,!0);return n(e,i)}}function wN(e,t){let r=tg(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(eg(r.getOptions(),t??{}))return e;Sb(e,"already-initialized")}return r.initialize({options:t})}function wP(e,t){let r=t?.persistence||[],n=(Array.isArray(r)?r:[r]).map(ws);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t?.popupRedirectResolver)}function wM(e,t,r){let n=wE(e);SE(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=!!r?.disableWarnings,s=wL(t),{host:a,port:o}=wF(t),l=null===o?"":`:${o}`,c={url:`${s}//${a}${l}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){SE(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),SE(eg(c,n.config.emulator)&&eg(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=c,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,W(a)?(Q(`${s}//${a}${l}`),Y("Auth",!0)):i||wj()}function wL(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function wF(e){let t=wL(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:wB(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:wB(t)}}}function wB(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function wj(){"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}class wU{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return S_("not implemented")}_getIdTokenResponse(e){return S_("not implemented")}_linkToIdToken(e,t){return S_("not implemented")}_getReauthenticationResolver(e){return S_("not implemented")}}async function wV(e,t){return SB(e,"POST","/v1/accounts:signUp",t)}async function wq(e,t){return SU(e,"POST","/v1/accounts:signInWithPassword",SF(e,t))}async function wz(e,t){return SU(e,"POST","/v1/accounts:signInWithEmailLink",SF(e,t))}async function w$(e,t){return SU(e,"POST","/v1/accounts:signInWithEmailLink",SF(e,t))}class wK extends wU{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new wK(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new wK(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return wO(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",wq,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return wz(e,{email:this._email,oobCode:this._password});default:Sb(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return wO(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wV,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return w$(e,{idToken:t,email:this._email,oobCode:this._password});default:Sb(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function wH(e,t){return SU(e,"POST","/v1/accounts:signInWithIdp",SF(e,t))}let wG="http://localhost";class wW extends wU{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new wW(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Sb("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new wW(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return wH(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,wH(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,wH(e,t)}buildRequest(){let e={requestUri:wG,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ev(t)}return e}}function wQ(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wJ(e){let t=eb(eS(e)).link,r=t?eb(eS(t)).deep_link_id:null,n=eb(eS(e)).deep_link_id;return(n?eb(eS(n)).link:null)||n||r||t||e}class wY{constructor(e){const t=eb(eS(e)),r=t.apiKey??null,n=t.oobCode??null,i=wQ(t.mode??null);SE(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=wJ(e);try{return new wY(t)}catch{return null}}}class wX{constructor(){this.providerId=wX.PROVIDER_ID}static credential(e,t){return wK._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=wY.parseLink(t);return SE(r,"argument-error"),wK._fromEmailAndCode(e,r.code,r.tenantId)}}wX.PROVIDER_ID="password",wX.EMAIL_PASSWORD_SIGN_IN_METHOD="password",wX.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wZ{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class w0 extends wZ{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class w1 extends w0{constructor(){super("facebook.com")}static credential(e){return wW._fromParams({providerId:w1.PROVIDER_ID,signInMethod:w1.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return w1.credentialFromTaggedObject(e)}static credentialFromError(e){return w1.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return w1.credential(e.oauthAccessToken)}catch{return null}}}w1.FACEBOOK_SIGN_IN_METHOD="facebook.com",w1.PROVIDER_ID="facebook.com";class w2 extends w0{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return wW._fromParams({providerId:w2.PROVIDER_ID,signInMethod:w2.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return w2.credentialFromTaggedObject(e)}static credentialFromError(e){return w2.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return w2.credential(t,r)}catch{return null}}}w2.GOOGLE_SIGN_IN_METHOD="google.com",w2.PROVIDER_ID="google.com";class w3 extends w0{constructor(){super("github.com")}static credential(e){return wW._fromParams({providerId:w3.PROVIDER_ID,signInMethod:w3.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return w3.credentialFromTaggedObject(e)}static credentialFromError(e){return w3.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return w3.credential(e.oauthAccessToken)}catch{return null}}}w3.GITHUB_SIGN_IN_METHOD="github.com",w3.PROVIDER_ID="github.com";class w6 extends w0{constructor(){super("twitter.com")}static credential(e,t){return wW._fromParams({providerId:w6.PROVIDER_ID,signInMethod:w6.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return w6.credentialFromTaggedObject(e)}static credentialFromError(e){return w6.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return w6.credential(t,r)}catch{return null}}}w6.TWITTER_SIGN_IN_METHOD="twitter.com",w6.PROVIDER_ID="twitter.com";class w4{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?w5._fromServerResponse(e,t):"totpInfo"in t?w8._fromServerResponse(e,t):Sb(e,"internal-error")}}class w5 extends w4{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new w5(t)}}class w8 extends w4{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new w8(t)}}function w7(e,t){return SB(e,"POST","/v2/accounts/mfaEnrollment:start",SF(e,t))}function w9(e,t){return SB(e,"POST","/v2/accounts/mfaEnrollment:finalize",SF(e,t))}new WeakMap;var Te="@firebase/auth",Tt="1.12.0";class Tr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){SE(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Tn(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ti(e){tm(new eD("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;SE(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new wC(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wv(e)});return wP(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),tm(new eD("auth-internal",e=>new Tr(wE(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tO(Te,Tt,Tn(e)),tO(Te,Tt,"esm2020")}function Ts(e=tA()){let t=tg(e,"auth");if(t.isInitialized())return t.getImmediate();let r=wN(e),n=$("auth");return n&&wM(r,`http://${n}`),r}function Ta(e,t){return SB(e,"POST","/v2/accounts/mfaSignIn:finalize",SF(e,t))}SN.initialize(fetch,Headers,Response),Ti("Node"),SS("operation-not-supported-in-this-environment"),wC.prototype.setPersistence=async()=>{};class To{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return S_("unexpected MultiFactorSessionType")}}}class Tl{static assertionForEnrollment(e,t){return Tc._fromSecret(e,t)}static assertionForSignIn(e,t){return Tc._fromEnrollmentId(e,t)}static async generateSecret(e){let t=e;SE(void 0!==t.user?.auth,"internal-error");let r=await w7(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return Tu._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}Tl.FACTOR_ID="totp";class Tc extends To{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Tc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Tc(t,e)}async _finalizeEnroll(e,t,r){return SE(void 0!==this.secret,e,"argument-error"),w9(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){SE(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return Ta(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Tu{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Tu(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(Th(e)||Th(t))&&(r=!0),r&&(Th(e)&&(e=this.auth.currentUser?.email||"unknownuser"),Th(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Th(e){return void 0===e||e?.length===0}e.s([],43972),e.i(43972);let Td="@firebase/installations",Tf="0.6.19",Tp=1e4,Tm=`w:${Tf}`,Tg="FIS_v2",Ty="https://firebaseinstallations.googleapis.com/v1",Tv=36e5,Tb=new ef("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function TS(e){return e instanceof ed&&e.code.includes("request-failed")}function Tw({projectId:e}){return`${Ty}/projects/${e}/installations`}function TT(e){return{token:e.token,requestStatus:2,expiresIn:Tk(e.expiresIn),creationTime:Date.now()}}async function TC(e,t){let r=(await t.json()).error;return Tb.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function TE({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function T_(e,{refreshToken:t}){let r=TE(e);return r.append("Authorization",TR(t)),r}async function TI(e){let t=await e();return t.status>=500&&t.status<600?e():t}function Tk(e){return Number(e.replace("s","000"))}function TR(e){return`${Tg} ${e}`}async function TA({appConfig:e,heartbeatServiceProvider:t},{fid:r}){let n=Tw(e),i=TE(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({fid:r,authVersion:Tg,appId:e.appId,sdkVersion:Tm})},o=await TI(()=>fetch(n,a));if(o.ok){let e=await o.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:TT(e.authToken)}}throw await TC("Create Installation",o)}function Tx(e){return new Promise(t=>{setTimeout(t,e)})}function TD(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}let TO=/^[cdef][\w-]{21}$/,TN="";function TP(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=TM(e);return TO.test(t)?t:TN}catch{return TN}}function TM(e){return TD(e).substr(0,22)}function TL(e){return`${e.appName}!${e.appId}`}let TF=new Map;function TB(e,t){let r=TL(e);Tj(r,t),TU(r,t)}function Tj(e,t){let r=TF.get(e);if(r)for(let e of r)e(t)}function TU(e,t){let r=Tq();r&&r.postMessage({key:e,fid:t}),Tz()}let TV=null;function Tq(){return!TV&&"BroadcastChannel"in self&&((TV=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{Tj(e.data.key,e.data.fid)}),TV}function Tz(){0===TF.size&&TV&&(TV.close(),TV=null)}let T$="firebase-installations-database",TK=1,TH="firebase-installations-store",TG=null;function TW(){return TG||(TG=e8(T$,TK,{upgrade:(e,t)=>{0===t&&e.createObjectStore(TH)}})),TG}async function TQ(e,t){let r=TL(e),n=(await TW()).transaction(TH,"readwrite"),i=n.objectStore(TH),s=await i.get(r);return await i.put(t,r),await n.done,s&&s.fid===t.fid||TB(e,t.fid),t}async function TJ(e){let t=TL(e),r=(await TW()).transaction(TH,"readwrite");await r.objectStore(TH).delete(t),await r.done}async function TY(e,t){let r=TL(e),n=(await TW()).transaction(TH,"readwrite"),i=n.objectStore(TH),s=await i.get(r),a=t(s);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,a&&(!s||s.fid!==a.fid)&&TB(e,a.fid),a}async function TX(e){let t,r=await TY(e.appConfig,r=>{let n=T0(e,TZ(r));return t=n.registrationPromise,n.installationEntry});return r.fid===TN?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}function TZ(e){return T6(e||{fid:TP(),registrationStatus:0})}function T0(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Tb.create("app-offline"))};let r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=T1(e,r);return{installationEntry:r,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:T2(e)}:{installationEntry:t}}async function T1(e,t){try{let r=await TA(e,t);return TQ(e.appConfig,r)}catch(r){throw TS(r)&&409===r.customData.serverCode?await TJ(e.appConfig):await TQ(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function T2(e){let t=await T3(e.appConfig);for(;1===t.registrationStatus;)await Tx(100),t=await T3(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:r}=await TX(e);return r||t}return t}function T3(e){return TY(e,e=>{if(!e)throw Tb.create("installation-not-found");return T6(e)})}function T6(e){return T4(e)?{fid:e.fid,registrationStatus:0}:e}function T4(e){return 1===e.registrationStatus&&e.registrationTime+Tp<Date.now()}async function T5({appConfig:e,heartbeatServiceProvider:t},r){let n=T8(e,r),i=T_(e,r),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:Tm,appId:e.appId}})},o=await TI(()=>fetch(n,a));if(o.ok)return TT(await o.json());throw await TC("Generate Auth Token",o)}function T8(e,{fid:t}){return`${Tw(e)}/${t}/authTokens:generate`}async function T7(e,t=!1){let r,n=await TY(e.appConfig,n=>{if(!Cr(n))throw Tb.create("not-registered");let i=n.authToken;if(!t&&Cn(i))return n;if(1===i.requestStatus)return r=T9(e,t),n;{if(!navigator.onLine)throw Tb.create("app-offline");let t=Cs(n);return r=Ct(e,t),t}});return r?await r:n.authToken}async function T9(e,t){let r=await Ce(e.appConfig);for(;1===r.authToken.requestStatus;)await Tx(100),r=await Ce(e.appConfig);let n=r.authToken;return 0===n.requestStatus?T7(e,t):n}function Ce(e){return TY(e,e=>{if(!Cr(e))throw Tb.create("not-registered");return Ca(e.authToken)?{...e,authToken:{requestStatus:0}}:e})}async function Ct(e,t){try{let r=await T5(e,t),n={...t,authToken:r};return await TQ(e.appConfig,n),r}catch(r){if(TS(r)&&(401===r.customData.serverCode||404===r.customData.serverCode))await TJ(e.appConfig);else{let r={...t,authToken:{requestStatus:0}};await TQ(e.appConfig,r)}throw r}}function Cr(e){return void 0!==e&&2===e.registrationStatus}function Cn(e){return 2===e.requestStatus&&!Ci(e)}function Ci(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Tv}function Cs(e){let t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}function Ca(e){return 1===e.requestStatus&&e.requestTime+Tp<Date.now()}async function Co(e){let t=e,{installationEntry:r,registrationPromise:n}=await TX(t);return n?n.catch(console.error):T7(t).catch(console.error),r.fid}async function Cl(e,t=!1){let r=e;return await Cc(r),(await T7(r,t)).token}async function Cc(e){let{registrationPromise:t}=await TX(e);t&&await t}function Cu(e){if(!e||!e.options)throw Ch("App Configuration");if(!e.name)throw Ch("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw Ch(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function Ch(e){return Tb.create("missing-app-config-values",{valueName:e})}let Cd="installations",Cf="installations-internal",Cp=e=>{let t=e.getProvider("app").getImmediate(),r=Cu(t),n=tg(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},Cm=e=>{let t=tg(e.getProvider("app").getImmediate(),Cd).getImmediate();return{getId:()=>Co(t),getToken:e=>Cl(t,e)}};(function(){tm(new eD(Cd,Cp,"PUBLIC")),tm(new eD(Cf,Cm,"PRIVATE"))})(),tO(Td,Tf),tO(Td,Tf,"esm2020");let Cg="analytics",Cy="firebase_id",Cv="origin",Cb=6e4,CS="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Cw="https://www.googletagmanager.com/gtag/js",CT=new eq("@firebase/analytics"),CC=new ef("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function CE(e){if(!e.startsWith(Cw)){let t=CC.create("invalid-gtag-resource",{gtagURL:e});return CT.warn(t.message),""}return e}function C_(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function CI(e,t){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(e,t)),r}function Ck(e,t){let r=CI("firebase-js-sdk-policy",{createScriptURL:CE}),n=document.createElement("script"),i=`${Cw}?l=${e}&id=${t}`;n.src=r?r?.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function CR(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function CA(e,t,r,n,i,s){let a=n[i];try{if(a)await t[a];else{let e=(await C_(r)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){CT.error(e)}e("config",i,s)}async function Cx(e,t,r,n,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let n=await C_(r);for(let r of e){let e=n.find(e=>e.measurementId===r),i=e&&t[e.appId];if(i)s.push(i);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",n,i||{})}catch(e){CT.error(e)}}function CD(e,t,r,n){return async function(i,...s){try{if("event"===i){let[n,i]=s;await Cx(e,t,r,n,i)}else if("config"===i){let[i,a]=s;await CA(e,t,r,n,i,a)}else if("consent"===i){let[t,r]=s;e("consent",t,r)}else if("get"===i){let[t,r,n]=s;e("get",t,r,n)}else if("set"===i){let[t]=s;e("set",t)}else e(i,...s)}catch(e){CT.error(e)}}}function CO(e,t,r,n,i){let s=function(){window[n].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=CD(s,e,t,r),{gtagCore:s,wrappedGtag:window[i]}}function CN(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(Cw)&&t.src.includes(e))return t;return null}let CP=30,CM=1e3;class CL{constructor(e={},t=CM){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let CF=new CL;function CB(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Cj(e){let{appId:t,apiKey:r}=e,n={method:"GET",headers:CB(r)},i=CS.replace("{app-id}",t),s=await fetch(i,n);if(200!==s.status&&304!==s.status){let e="";try{let t=await s.json();t.error?.message&&(e=t.error.message)}catch(e){}throw CC.create("config-fetch-failed",{httpStatus:s.status,responseMessage:e})}return s.json()}async function CU(e,t=CF,r){let{appId:n,apiKey:i,measurementId:s}=e.options;if(!n)throw CC.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:n};throw CC.create("no-api-key")}let a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new C$;return setTimeout(async()=>{o.abort()},void 0!==r?r:Cb),CV({appId:n,apiKey:i,measurementId:s},a,o,t)}async function CV(e,{throttleEndTimeMillis:t,backoffCount:r},n,i=CF){let{appId:s,measurementId:a}=e;try{await Cq(n,t)}catch(e){if(a)return CT.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:s,measurementId:a};throw e}try{let t=await Cj(e);return i.deleteThrottleMetadata(s),t}catch(c){let t=c;if(!Cz(t)){if(i.deleteThrottleMetadata(s),a)return CT.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${t?.message}]`),{appId:s,measurementId:a};throw c}let o=503===Number(t?.customData?.httpStatus)?eA(r,i.intervalMillis,CP):eA(r,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+o,backoffCount:r+1};return i.setThrottleMetadata(s,l),CT.debug(`Calling attemptFetch again in ${o} millis`),CV(e,l,n,i)}}function Cq(e,t){return new Promise((r,n)=>{let i=setTimeout(r,Math.max(t-Date.now(),0));e.addEventListener(()=>{clearTimeout(i),n(CC.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function Cz(e){if(!(e instanceof ed)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class C${constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function CK(e,t,r,n,i){if(i&&i.global)return void e("event",r,n);{let i=await t;e("event",r,{...n,send_to:i})}}async function CH(e,t,r,n){if(n&&n.global){let t={};for(let e of Object.keys(r))t[`user_properties.${e}`]=r[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:r})}function CG(e){i=e}function CW(e){n=e}async function CQ(){if(!el())return CT.warn(CC.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await ec()}catch(e){return CT.warn(CC.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}async function CJ(e,t,r,s,a,o,l){let c=CU(e);c.then(t=>{r[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&CT.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>CT.error(e)),t.push(c);let u=CQ().then(e=>e?s.getId():void 0),[h,d]=await Promise.all([c,u]);CN(o)||Ck(o,h.measurementId),i&&(a("consent","default",i),CG(void 0)),a("js",new Date);let f=l?.config??{};return f[Cv]="firebase",f.update=!0,null!=d&&(f[Cy]=d),a("config",h.measurementId,f),n&&(a("set",n),CW(void 0)),h.measurementId}class CY{constructor(e){this.app=e}_delete(){return delete CX[this.app.options.appId],Promise.resolve()}}let CX={},CZ=[],C0={},C1="dataLayer",C2="gtag",C3=!1;function C6(){let e=[];if(ei()&&e.push("This is a browser extension environment."),eu()||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),r=CC.create("invalid-analytics-context",{errorInfo:t});CT.warn(r.message)}}function C4(e,t,r){C6();let n=e.options.appId;if(!n)throw CC.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)CT.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw CC.create("no-api-key");if(null!=CX[n])throw CC.create("already-exists",{id:n});if(!C3){CR(C1);let{wrappedGtag:e,gtagCore:t}=CO(CX,CZ,C0,C1,C2);a=e,s=t,C3=!0}return CX[n]=CJ(e,CZ,C0,t,s,C1,r),new CY(e)}function C5(e,t,r){e=ex(e),CH(a,CX[e.app.options.appId],t,r).catch(e=>CT.error(e))}function C8(e,t,r,n){e=ex(e),CK(a,CX[e.app.options.appId],t,r,n).catch(e=>CT.error(e))}let C7="@firebase/analytics",C9="0.10.19";!function(){function e(e){try{let t=e.getProvider(Cg).getImmediate();return{logEvent:(e,r,n)=>C8(t,e,r,n),setUserProperties:(e,r)=>C5(t,e,r)}}catch(e){throw CC.create("interop-component-reg-failed",{reason:e})}}tm(new eD(Cg,(e,{options:t})=>C4(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),tm(new eD("analytics-internal",e,"PRIVATE")),tO(C7,C9),tO(C7,C9,"esm2020")}();let Ee={apiKey:"AIzaSyBTnObqmItsT-FfO_hqxVcfTMeQWPYmTLI",authDomain:"start-ups-64204.firebaseapp.com",projectId:"start-ups-64204",storageBucket:"start-ups-64204.firebasestorage.app",messagingSenderId:"33627840663",appId:"1:33627840663:web:d3b4a10bd1efe3954d49d2",measurementId:"G-PS9X8L7S98"},Et=tx().length?tA():tk(Ee),Er=yU(Et);Ts(Et);let En={saveUserProfile:async(e,t)=>{try{if(!e)return console.error("saveUserProfile: Missing userId"),!1;let r=yN(Er,"users",e);return await bJ(r,{...t,updatedAt:r9.now()},{merge:!0}),!0}catch(e){return console.error("Error saving profile:",e),!1}},getUserProfile:async e=>{try{let t=yN(Er,"users",e),r=await b$(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error fetching profile:",e),null}},getAllUsers:async()=>{try{let e=vx(yO(Er,"users"),vj(50));return(await bG(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching all users:",e),[]}},getUserByReferralCode:async e=>{try{let t=vx(yO(Er,"users"),vO("referralCode","==",e.toUpperCase()),vj(1)),r=await bG(t);if(!r.empty){let e=r.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error fetching referrer:",e),null}},updateWallet:async(e,t,r)=>{try{let n=yN(Er,"users",e),i={amount:t,type:t>0?"credit":"debit",description:r,date:new Date().toISOString()};return await bY(n,{walletBalance:vb(t),walletHistory:vv(i)}),!0}catch(e){return console.error("Error updating wallet:",e),!1}},saveNiche:async(e,t)=>{try{return await bZ(yO(Er,"users",e,"niches"),{...t,createdAt:r9.now()}),t.name&&await En.saveUserProfile(e,{onboarding:{interests:[t.name]}}),!0}catch(e){return console.error("Error saving niche:",e),!1}},checkNameUnique:async e=>{try{let t=vx(yO(Er,"globalUsedChannelNames"),vO("name","==",e.toLowerCase()));return(await bG(t)).empty}catch(e){return console.error("Error checking name:",e),!0}},lockChannelName:async(e,t)=>{try{return await bZ(yO(Er,"globalUsedChannelNames"),{name:t.toLowerCase(),usedBy:e,createdAt:r9.now()}),!0}catch(e){return console.error("Error locking name:",e),!1}},logEarnings:async(e,t,r)=>{try{await bZ(yO(Er,"users",e,"earningsHistory"),{amount:t,source:r,date:new Date().toISOString()});let n=yN(Er,"users",e);return await bJ(n,{earnings:{total:vb(t)}},{merge:!0}),!0}catch(e){return console.error("Error logging earnings:",e),!1}},saveSavedItem:async(e,t)=>{try{return await bZ(yO(Er,"users",e,"savedItems"),{...t,savedAt:r9.now()}),!0}catch(e){return console.error("Error saving item:",e),!1}},deleteSavedItem:async(e,t)=>{try{let r=yN(Er,"users",e,"savedItems",t);return await bX(r),!0}catch(e){return console.error("Error deleting saved item:",e),!1}},updateUserSubscription:async(e,t,r="active")=>{try{let n=yN(Er,"users",e);return await bY(n,{plan:t,subscriptionStatus:r,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating subscription:",e),!1}},getSavedItems:async e=>{try{let t=vx(yO(Er,"users",e,"savedItems"));return(await bG(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching saved items:",e),[]}},getTrends:async()=>{let e=vx(yO(Er,"trends"));return(await bG(e)).docs.map(e=>({id:e.id,...e.data()}))},addTrend:async e=>{let t=yO(Er,"trends");await bZ(t,{...e,timestamp:r9.now()})},getChannels:async e=>{try{let t=vx(yO(Er,"users",e,"channels"));return(await bG(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching channels:",e),[]}},addChannel:async(e,t)=>{try{return await bZ(yO(Er,"users",e,"channels"),{...t,createdAt:r9.now()}),!0}catch(e){return console.error("Error adding channel:",e),!1}},getChannel:async(e,t)=>{try{let r=yN(Er,"users",e,"channels",t),n=await b$(r);if(n.exists())return{id:n.id,...n.data()};return null}catch(e){return console.error("Error fetching channel:",e),null}},updateChannel:async(e,t,r)=>{try{let n=yN(Er,"users",e,"channels",t);return await bY(n,{...r,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating channel:",e),!1}},deleteChannel:async(e,t)=>{try{let r=yN(Er,"users",e,"channels",t);return await bY(r,{status:"deleted",deletedAt:r9.now()}),!0}catch(e){return console.error("Error deleting channel:",e),!1}},getTools:async(e=!1)=>{try{let t;return t=e?vx(yO(Er,"tools"),vO("isPublic","==",!0)):vx(yO(Er,"tools")),(await bG(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting tools:",e),[]}},getTool:async e=>{try{let t=yN(Er,"tools",e),r=await b$(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error fetching tool:",e),null}},createTool:async e=>{try{return(await bZ(yO(Er,"tools"),{...e,createdAt:r9.now(),updatedAt:r9.now()})).id}catch(e){throw console.error("Error creating tool:",e),e}},updateTool:async(e,t)=>{try{let r=yN(Er,"tools",e);return await bY(r,{...t,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating tool:",e),!1}},deleteTool:async e=>{try{let t=yN(Er,"tools",e);return await bY(t,{deleted:!0,deletedAt:r9.now()}),!0}catch(e){return console.error("Error deleting tool:",e),!1}},toggleToolLock:async(e,t,r)=>{try{let n=yN(Er,"tools",e);return await bY(n,{locked:t,lockReason:r||"",updatedAt:r9.now()}),!0}catch(e){return console.error("Error toggling tool lock:",e),!1}},getGuides:async(e=!1)=>{try{let t;return t=e?vx(yO(Er,"guides"),vO("isPublic","==",!0)):vx(yO(Er,"guides")),(await bG(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching guides:",e),[]}},getGuide:async e=>{try{let t=yN(Er,"guides",e),r=await b$(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error fetching guide:",e),null}},createGuide:async e=>{try{return(await bZ(yO(Er,"guides"),{...e,createdAt:r9.now(),updatedAt:r9.now()})).id}catch(e){throw console.error("Error creating guide:",e),e}},updateGuide:async(e,t)=>{try{let r=yN(Er,"guides",e);return await bY(r,{...t,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating guide:",e),!1}},deleteGuide:async e=>{try{let t=yN(Er,"guides",e);return await bY(t,{deleted:!0,deletedAt:r9.now()}),!0}catch(e){return console.error("Error deleting guide:",e),!1}},toggleGuidePremium:async(e,t)=>{try{let r=yN(Er,"guides",e);return await bY(r,{premium:t,updatedAt:r9.now()}),!0}catch(e){return console.error("Error toggling guide premium:",e),!1}},getCoupons:async()=>{try{let e=vx(yO(Er,"coupons"));return(await bG(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching coupons:",e),[]}},createCoupon:async e=>{try{return await bZ(yO(Er,"coupons"),{...e,createdAt:r9.now(),usageCount:0}),!0}catch(e){return console.error("Error creating coupon:",e),!1}},deleteCoupon:async e=>{try{return await bX(yN(Er,"coupons",e)),!0}catch(e){return console.error("Error deleting coupon:",e),!1}},toggleCouponStatus:async(e,t)=>{try{return await bY(yN(Er,"coupons",e),{active:t}),!0}catch(e){return console.error("Error toggling coupon:",e),!1}},incrementCouponUsage:async e=>{try{let t=vx(yO(Er,"coupons"),vO("code","==",e)),r=await bG(t);if(!r.empty){let e=r.docs[0].ref;await bY(e,{usageCount:vb(1)})}}catch(e){console.error("Error incrementing coupon:",e)}},getCouponByCode:async e=>{try{let t=vx(yO(Er,"coupons"),vO("code","==",e),vj(1)),r=await bG(t);if(!r.empty)return{id:r.docs[0].id,...r.docs[0].data()};return null}catch(e){return console.error("Error fetching coupon by code:",e),null}},getAdminStats:async()=>{try{let e=(await bG(yO(Er,"users"))).docs.map(e=>e.data()),t=e.length,r=e.filter(e=>"pro"===e.plan||"pro_plus"===e.plan).length,n=e.reduce((e,t)=>"pro"===t.plan?e+259:"pro_plus"===t.plan?e+599:e,0);return{totalUsers:t,activeSubs:r,revenue:n,contentGen:0}}catch(e){return console.error("Error getting admin stats:",e),{totalUsers:0,activeSubs:0,revenue:0,contentGen:0}}},getHelpArticles:async()=>{try{return(await bG(yO(Er,"helpArticles"))).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting help articles:",e),[]}},getHelpArticle:async e=>{try{let t=yN(Er,"helpArticles",e),r=await b$(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error getting help article:",e),null}},createHelpArticle:async e=>{try{return(await bZ(yO(Er,"helpArticles"),{...e,views:0,helpful:0,notHelpful:0,createdAt:r9.now(),updatedAt:r9.now()})).id}catch(e){return console.error("Error creating help article:",e),null}},updateHelpArticle:async(e,t)=>{try{let r=yN(Er,"helpArticles",e);return await bY(r,{...t,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating help article:",e),!1}},deleteHelpArticle:async e=>{try{let t=yN(Er,"helpArticles",e);return await bX(t),!0}catch(e){return console.error("Error deleting help article:",e),!1}},incrementHelpfulCount:async(e,t)=>{try{let r=yN(Er,"helpArticles",e);return await bY(r,{[t]:vb(1)}),!0}catch(e){return console.error("Error incrementing helpful count:",e),!1}},getBlogs:async e=>{try{let t=vx(yO(Er,"blogs"));return e?.category&&(t=vx(t,vO("category","==",e.category))),e?.published!==void 0&&(t=vx(t,vO("published","==",e.published))),(await bG(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting blogs:",e),[]}},getBlogBySlug:async e=>{try{let t=vx(yO(Er,"blogs"),vO("slug","==",e),vj(1)),r=await bG(t);if(!r.empty){let e=r.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting blog by slug:",e),null}},getBlog:async e=>{try{let t=yN(Er,"blogs",e),r=await b$(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error getting blog:",e),null}},createBlog:async e=>{try{return(await bZ(yO(Er,"blogs"),{...e,views:0,createdAt:r9.now(),updatedAt:r9.now(),publishedAt:e.published?r9.now():null})).id}catch(e){return console.error("Error creating blog:",e),null}},updateBlog:async(e,t)=>{try{let r=yN(Er,"blogs",e);return await bY(r,{...t,updatedAt:r9.now()}),!0}catch(e){return console.error("Error updating blog:",e),!1}},deleteBlog:async e=>{try{let t=yN(Er,"blogs",e);return await bX(t),!0}catch(e){return console.error("Error deleting blog:",e),!1}},incrementBlogViews:async e=>{try{let t=yN(Er,"blogs",e);return await bY(t,{views:vb(1)}),!0}catch(e){return console.error("Error incrementing blog views:",e),!1}},bulkImportBlogs:async e=>{let t=0,r=0;for(let n of e)try{await bZ(yO(Er,"blogs"),{...n,views:0,createdAt:r9.now(),updatedAt:r9.now(),publishedAt:n.published?r9.now():null}),t++}catch(e){console.error("Error importing blog:",e),r++}return{success:t,failed:r}}};async function Ei(e){try{let{amount:t,coupon:r}=await e.json(),n=t,i=0;if(r){let e=await En.getCouponByCode(r.toUpperCase());if(e&&e.active)if("percent"===e.discountType){let r=t*e.discountValue/100;i=r,n=t-r}else"flat"===e.discountType&&(i=e.discountValue,n=Math.max(0,t-i))}let s=`order_${Date.now()}_${Math.random().toString(36).substring(7)}`;return A.NextResponse.json({id:s,currency:"INR",amount:100*n,originalAmount:t,discount:i})}catch(e){return console.error("Error creating order:",e),A.NextResponse.json({error:"Internal Server Error"},{status:500})}}e.s(["POST",()=>Ei],38347);var Es=e.i(38347);let Ea="standalone",Eo=new d.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/create-order/route",pathname:"/api/create-order",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/create-order/route.ts",nextConfigOutput:Ea,userland:Es}),{workAsyncStorage:El,workUnitAsyncStorage:Ec,serverHooks:Eu}=Eo;function Eh(){return(0,p.patchFetch)({workAsyncStorage:El,workUnitAsyncStorage:Ec})}async function Ed(e,t,r){Eo.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/create-order/route";n=n.replace(/\/index$/,"")||"/";let i=!1,s=await Eo.prepare(e,t,{srcPage:n,multiZoneDraftMode:i});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:a,params:o,nextConfig:l,parsedUrl:c,isDraftMode:u,prerenderManifest:h,routerServerContext:d,isOnDemandRevalidate:p,revalidateOnlyGenerated:A,resolvedPathname:x,clientReferenceManifest:D,serverActionsManifest:O}=s,N=(0,v.normalizeAppPath)(n),P=!!(h.dynamicRoutes[N]||h.routes[x]),M=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,c,!1):t.end("This page could not be found"),null);if(P&&!u){let e=!!h.routes[x],t=h.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(l.experimental.adapterPath)return await M();throw new k.NoFallbackError}}let L=null;!P||Eo.isDev||u||(L="/index"===(L=x)?"/":L);let F=!0===Eo.isDev||!P,B=P&&!F;O&&D&&(0,y.setManifestsSingleton)({page:n,clientReferenceManifest:D,serverActionsManifest:O});let j=e.method||"GET",U=(0,g.getTracer)(),V=U.getActiveScopeSpan(),q={params:o,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!l.experimental.authInterrupts},cacheComponents:!!l.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,m.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:l.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,i)=>Eo.onRequestError(e,t,n,i,d)},sharedContext:{buildId:a}},z=new b.NodeNextRequest(e),$=new b.NodeNextResponse(t),K=S.NextRequestAdapter.fromNodeNextRequest(z,(0,S.signalFromNodeResponse)(t));try{let i=async e=>Eo.handle(K,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==w.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${n}`)}),s=!!(0,m.getRequestMeta)(e,"minimalMode"),a=async a=>{var o,c;let m=async({previousCacheEntry:o})=>{try{if(!s&&p&&A&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=q.renderOpts.collectedTags;if(!P)return await (0,C.sendResponse)(z,$,n,q.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[I.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=I.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,i=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=I.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){if(null==o?void 0:o.isStale){let r=!1;await Eo.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,T.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:p})},r,d)}throw t}},g=await Eo.handleResponse({req:e,nextConfig:l,cacheKey:L,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:p,revalidateOnlyGenerated:A,responseGenerator:m,waitUntil:r.waitUntil,isMinimalMode:s});if(!P)return null;if((null==g||null==(o=g.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(c=g.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",p?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),u&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,E.fromNodeOutgoingHttpHeaders)(g.value.headers);return s&&P||y.delete(I.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,_.getCacheControlHeader)(g.cacheControl)),await (0,C.sendResponse)(z,$,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};V?await a(V):await U.withPropagatedContext(e.headers,()=>U.trace(w.BaseServerSpan.handleRequest,{spanName:`${j} ${n}`,kind:g.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},a))}catch(t){if(!(t instanceof k.NoFallbackError)){let r=!1;await Eo.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,T.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:p})},r,d)}if(P)throw t;return await (0,C.sendResponse)(z,$,new Response(null,{status:500})),null}}e.s(["handler",()=>Ed,"patchFetch",()=>Eh,"routeModule",()=>Eo,"serverHooks",()=>Eu,"workAsyncStorage",()=>El,"workUnitAsyncStorage",()=>Ec],97407)}];

//# sourceMappingURL=node_modules_97f9fd3b._.js.map